"use strict";(self.webpackChunk_tc_server_webrtc_client=self.webpackChunk_tc_server_webrtc_client||[]).push([[896],{76054:function(e,t,n){n.d(t,{A:function(){return i}});const r=/^(?:#(.+?):)?(?:\\(.+?)\\)?(.+?)(?:@(.+?)(?:\/(.+?))?(?:#(.+?))?)?$/;class i{type;prefix;id;host;randomValue;serviceType;constructor(e){if(this.id="",this.type=null,this.prefix=null,this.host=null,this.randomValue=null,this.serviceType=null,void 0!==e)if(e instanceof i)this.fill(e);else if(!i.fromString(this,e))throw"Invalid CallId!"}equals(e){return this.type===e.type&&this.prefix===e.prefix&&this.id===e.id&&this.host===e.host&&this.randomValue===e.randomValue&&this.serviceType===e.serviceType}fill(e){this.type=e.type,this.prefix=e.prefix,this.id=e.id,this.host=e.host,this.randomValue=e.randomValue,this.serviceType=e.serviceType}static fromString(e,t){let n=r.exec(t);return null!==n&&(e.type=void 0!==n[1]?n[1]:null,e.prefix=void 0!==n[2]?n[2]:null,e.id=void 0!==n[3]?n[3]:"",e.host=void 0!==n[4]?n[4]:null,e.randomValue=void 0!==n[5]?n[5]:null,e.serviceType=void 0!==n[6]?n[6]:null,!0)}toString(){let e="";return null!==this.type&&(e+="#"+this.type+":"),null!==this.prefix&&(e+="\\"+this.prefix+"\\"),e+=this.id,null!==this.host&&(e+="@"+this.host),null!==this.randomValue&&(e+="/"+this.randomValue),null!==this.serviceType&&(e+="#"+this.serviceType),e}}},96638:function(e,t,n){n.d(t,{A:function(){return a}});var r,i,s=n(76054);class a{constructor(e){o.set(this,e)}get trueconfId(){return c(this).trueConfId}get callId(){let e=c(this);return e.callId||(e.callId=new s.A(e.trueConfId)),e.callId}get data(){let e=c(this);return e.dataMap?e.dataMap:e.dataMap=new Map}getId(){return c(this).login}getServerName(){return c(this).serverName}getDisplayName(){return c(this).displayName}getType(){return c(this).type}getTrueconfId(){return c(this).trueConfId}static get TYPE(){return r}static get LOGIN_TYPE(){return i}}!function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.USER=1]="USER",e[e.GUEST=2]="GUEST",e[e.SIP=3]="SIP",e[e.TELEPHONE=4]="TELEPHONE",e[e.H323=5]="H323"}(r||(r={})),function(e){e[e.COMMON=1]="COMMON",e[e.AUTO_GENERATED=2]="AUTO_GENERATED"}(i||(i={}));const o=new WeakMap;function c(e){let t=o.get(e);if(!t)throw new TypeError("Illegal invocation");return t}},150:function(e,t,n){n.d(t,{A:function(){return a}});var r=n(96638),i=n(63119),s=n(76054);class a extends i.A{constructor(){let e={};super(e),c.set(this,{usersInstances:{},usersObjects:{},eventTargetFriendlyMethods:e})}hasUser(e){return l(this).usersInstances.hasOwnProperty(e)}getUser(e,t){let n=l(this);if(n.usersInstances.hasOwnProperty(e))return t&&o(this,n,e,t),n.usersInstances[e];let i=this.getUserObject(e,t);n.usersObjects[e]=i;let s=new r.A(i);return n.usersInstances[e]=s,s}getUserInstanceFromObject(e){let t=l(this);if(t.usersInstances.hasOwnProperty(e.trueConfId))return t.usersInstances[e.trueConfId];{let n=new r.A(e);return t.usersInstances[e.trueConfId]=n,n}}hasUserObject(e){return l(this).usersObjects.hasOwnProperty(e)}getUserObject(e,t){let n=l(this);if(n.usersObjects.hasOwnProperty(e))return t&&o(this,n,e,t),n.usersObjects[e];let i=function(e){let t=new s.A;if(!s.A.fromString(t,e))return!1;let n=r.A.TYPE.UNKNOWN,i=r.A.LOGIN_TYPE.COMMON;if(null===t.type)n=r.A.TYPE.USER;else{switch(t.type.toLowerCase()){case"guest2":n=r.A.TYPE.GUEST;break;case"guest":n=r.A.TYPE.GUEST,i=r.A.LOGIN_TYPE.AUTO_GENERATED;break;case"sip":n=r.A.TYPE.SIP;break;case"h323":n=r.A.TYPE.H323;break;case"tel":n=r.A.TYPE.TELEPHONE}}return{login:t.id,serverName:t.host?t.host:"",type:n,loginType:i}}(e);if(!i)throw"Invalid TrueConfId!";let{login:a,serverName:c,type:u,loginType:d}=i,h={trueConfId:e,login:a,serverName:c,type:u,loginType:d,displayName:null!=t?t:e};return n.usersObjects[e]=h,h}refreshUserDisplayName(e,t){let n=l(this);n.usersObjects.hasOwnProperty(e)&&o(this,n,e,t)}clearAll(){let e=l(this);e.usersObjects={},e.usersInstances={}}}function o(e,t,n,r){let i=t.usersObjects[n];null!=r&&i.displayName!==r&&(t.eventTargetFriendlyMethods.fireEvent("userDisplayNameChange",{user:e.getUserInstanceFromObject(i),oldDisplayName:i.displayName,newDisplayName:r}),i.displayName=r)}const c=new WeakMap;function l(e){let t=c.get(e);if(!t)throw new TypeError("Illegal invocation");return t}},89767:function(e,t,n){var r;n.d(t,{$:function(){return r}}),function(e){e[e.POSITIVE=0]="POSITIVE",e[e.EXCEED_PINNED_LIMIT=2]="EXCEED_PINNED_LIMIT",e[e.NEGATIVE=3]="NEGATIVE",e[e.PARTICIPANT_ABSENT=5]="PARTICIPANT_ABSENT"}(r||(r={}))},62258:function(e,t,n){n.d(t,{A:function(){return a}});var r,i,s=n(96638);class a extends s.A{static get PARTICIPANT_ROLE(){return r}static get PARTICIPANT_ROLE_CHANGE_ANSWER(){return i}constructor(e,t){super(e),c.set(this,t)}get role(){return o(this).role}get isIncomplete(){return o(this).isIncomplete}get isOperator(){return o(this).isOperator}get isOnPodium(){return o(this).isOnPodium}get isInWaitingRoom(){return o(this).isInWaitingRoom}get conferenceEntity(){return o(this).conferenceEntity}get isPinned(){return o(this).isPinned}get isTranslator(){return o(this).isTranslator}hasLeaderRole(){return o(this).role===a.PARTICIPANT_ROLE.LEADER}hasCommonRole(){let e=o(this).role;return e===a.PARTICIPANT_ROLE.COMMON||e===a.PARTICIPANT_ROLE.EQUAL}hasRemarkRole(){return o(this).role===a.PARTICIPANT_ROLE.REMARK}}function o(e){let t=c.get(e);if(!t)throw new TypeError("Illegal invocation");return t}!function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.EQUAL=0]="EQUAL",e[e.COMMON=1]="COMMON",e[e.LEADER=2]="LEADER",e[e.PODIUM=3]="PODIUM",e[e.REPORTER=4]="REPORTER",e[e.REMARK=5]="REMARK"}(r||(r={})),function(e){e[e.POSITIVE=0]="POSITIVE",e[e.COMMON=1]="COMMON",e[e.ROLE_BUSY=2]="ROLE_BUSY",e[e.NEGATIVE=3]="NEGATIVE",e[e.PATRICIPANT_BUSY=4]="PATRICIPANT_BUSY",e[e.PARTICIPANT_ABSENT=5]="PARTICIPANT_ABSENT"}(i||(i={}));const c=new WeakMap},74344:function(e,t,n){n.d(t,{A:function(){return i}});var r=n(33121);class i{iceServerList;simulcastConfig;isRtxEnabledValue;constructor(e,t,n=!1){this.iceServerList=e,this.simulcastConfig=t,this.isRtxEnabledValue=n}isRtxEnabled(){return this.isRtxEnabledValue}getPoliteness(){return!0}getIceGatheringConfiguration(){return Promise.resolve({policy:r.G0.ALL,transport:r.ns.ALL})}getIceServerList(){return Promise.resolve(this.iceServerList)}getSimulcastConfig(){return this.simulcastConfig}}},81871:function(e,t,n){n.d(t,{A:function(){return r}});class r{static get TYPE(){return i}constructor(e){s.set(this,e)}get deviceType(){return a(this).type}get id(){return a(this).id}get label(){return a(this).label||null}}var i;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CAMERA=1]="CAMERA",e[e.MICROPHONE=2]="MICROPHONE",e[e.SCREEN=3]="SCREEN",e[e.SPEAKERS=4]="SPEAKERS"}(i||(i={}));let s=new WeakMap;function a(e){let t=s.get(e);if(!t)throw new Error("Illegal invocation!");return t}},63119:function(e,t,n){n.d(t,{A:function(){return i}});var r=n(86148);class i{constructor(e){a.set(this,{listeners:{}}),void 0!==e&&(e.fireEvent=(e,t)=>this.fireEvent(e,t),e.addFireCallback=(e,t)=>this.addFireCallback(e,t),e.removeFireCallback=(e,t)=>{this.removeFireCallback(e,t)},e.fireCallbackList=(e,t,n)=>{this.fireCallbackList(e,t,n)})}addEventListener(e,t,n){if(!(t instanceof Function))throw new Error("Invalid argument");let i=o(this).listeners;i.hasOwnProperty(e)||(i[e]=[]);let a={mode:r.p.ASYNC,priority:0};n&&(void 0!==n.mode&&(a.mode=n.mode),void 0!==n.priority&&(a.priority=n.priority));let c={callback:t,configuration:a};return i[e].push(c),i[e].sort(s),this}removeEventListener(e,t){let n=o(this).listeners;if(!n.hasOwnProperty(e))return!1;let r=n[e];if(0===r.length)return!1;let i=0;for(;i<r.length&&r[i].callback!==t;)i++;return i!==r.length&&(r.splice(i,1),!0)}clearEventListeners(){return o(this).listeners={},!0}countListeners(e){return Object.keys(o(this).listeners).length}addFireCallback(e,t){let n=o(this);n.fireCallbackList||(n.fireCallbackList=new Map);let r=n.fireCallbackList.get(e);r||(r=new Set,n.fireCallbackList.set(e,r)),r.add(t)}removeFireCallback(e,t){let n=o(this);if(!n.fireCallbackList)return;let r=n.fireCallbackList.get(e);r&&(r.delete(t),0==r.size&&n.fireCallbackList.delete(e),0===n.fireCallbackList.size&&delete n.fireCallbackList)}fireCallbackList(e,t,n){let r=o(this);if(!r.fireCallbackList)return;let i=r.fireCallbackList.get(e);if(i)for(let e of i)e(t,n)}fireEvent(e,t){let n=o(this);n.listeners[e]&&function(e,t,n){for(let i of t)i.configuration.mode&r.p.SYNC?i.callback.call(e,n):window.setTimeout((()=>i.callback.call(e,n)),0)}(this,n.listeners[e],t)}}function s(e,t){return(e.configuration.mode&r.p.SYSTEM)>(t.configuration.mode&r.p.SYSTEM)?-1:(e.configuration.mode&r.p.SYSTEM)<(t.configuration.mode&r.p.SYSTEM)?1:e.configuration.priority===t.configuration.priority?0:e.configuration.priority>t.configuration.priority?-1:1}const a=new WeakMap;function o(e){let t=a.get(e);if(!t)throw new TypeError("Illegal invocation");return t}},86148:function(e,t,n){var r;n.d(t,{p:function(){return r}}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC",e[e.SYSTEM=2]="SYSTEM"}(r||(r={}))},26518:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(9214),i=n(79986),s=n(24966);function a(e){let t=[];if(void 0===e.turnHost||void 0===e.turnPassword||void 0===e.turnUser)for(let e of r.A)t.push(e.toEntity());else{let n=new i.A(e.turnUser,e.turnPassword),a=s.A.fromURL(e.turnHost,n);if("number"==typeof a){console.error("Invalid ICE-server URL:",e.turnHost,a);for(let e of r.A)t.push(e.toEntity())}else t.push(a.toEntity())}return t}},27062:function(e,t,n){n.d(t,{A:function(){return r}});class r{static get DEFAULT_SECURE_PORT(){return 443}static get DEFAULT_PORT(){return 80}host;port;secure;path;constructor(e="localhost",t=null,n=null,r=""){this.host=e,this.port=t,this.secure=n,this.path=r}clone(){return new r(this.host,this.port,this.secure,this.path)}static createFromCurrentContext(){let e=r.isCurrentContextSecure();return new r(document.location.hostname,document.location.port?Number.parseInt(document.location.port):e?r.DEFAULT_SECURE_PORT:r.DEFAULT_PORT,e)}static isCurrentContextSecure(){return"https:"===document.location.protocol}}},29054:function(e,t,n){n.d(t,{A:function(){return r}});class r{userId;constructor(e){this.userId=e}static get READY_STATE(){return s}static get ERROR_CODE(){return a}static get PROTOCOL_TYPE(){return i}}var i,s,a;!function(e){e[e.WEB_SOCKET=0]="WEB_SOCKET"}(i||(i={})),function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(s||(s={})),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.TIMEOUT=2]="TIMEOUT",e[e.ALREADY_CONNECTED=3]="ALREADY_CONNECTED"}(a||(a={}))},58237:function(e,t,n){n.d(t,{A:function(){return o}});var r=n(27062),i=n(29054);const s=/([^:]+)(?::([\s\S]*))?/,a={WS:"ws",WSS:"wss"};class o extends i.A{constructor(e,t,n,r){super(n),t=T(t),e.addEventListener("message",l),e.addEventListener("close",m),e.addEventListener("error",E),I.set(e,this),S.set(this,{connectionParams:t,webSocket:e,signalingCallbacks:r,latency:10,connectionId:null,pingPongTimeoutId:null,lastPingRequestTime:0,messageCallbacks:{common:{},command:{},internal:{}}})}static checkConnection(e){return c(e).then((e=>(e.close(),!0))).catch((()=>!1))}static connect(e,t,n){return c(e=T(e)).then((r=>new o(r,e,t,n)))}get readyState(){let e=v(this).webSocket;return e?e.readyState:o.READY_STATE.CLOSED}get latency(){return v(this).latency}get type(){return i.A.PROTOCOL_TYPE.WEB_SOCKET}get connection(){let e=v(this).connectionParams;return new r.A(e.host,e.port,e.secure,e.path)}get connectionId(){let e=v(this);return e.connectionId||(e.connectionId=C(e.connectionParams,this.userId)),e.connectionId}static makeConnectionId(e,t){return C(e,t)}close(){let e=v(this);if(null===e.webSocket)return Promise.reject("WebSocket is closed");if(e.webSocket.readyState!==i.A.READY_STATE.OPEN)throw Promise.reject("WebSocket has readyState : "+e.webSocket.readyState);return e.webSocket.close(),e.webSocket=null,Promise.resolve()}addMessagesCallback(e,t,n){f(v(this).messageCallbacks.common,e,t,n)}addInternalMessagesCallback(e,t){f(v(this).messageCallbacks.internal,e,t)}addCommandMessagesCallback(e,t,n){f(v(this).messageCallbacks.command,e,t,n)}removeMessagesCallback(e,t){g(v(this).messageCallbacks.common,e,t)}removeInternalMessagesCallback(e,t){g(v(this).messageCallbacks.internal,e,t)}removeCommandMessagesCallback(e,t){g(v(this).messageCallbacks.command,e,t)}sendMessage(e){let t=v(this).webSocket;return null===t||t.readyState!==o.READY_STATE.OPEN?Promise.reject("webSocket not open"):e instanceof Object?(t.send(JSON.stringify(e)),Promise.resolve(e)):Promise.reject("Invalid data")}sendCommandMessage(e,t,n){let r=v(this).webSocket;if(null===r||r.readyState!==o.READY_STATE.OPEN)return Promise.reject("webSocket not open");let i={to:t,method:"command",CID:e,command:n};return r.send(JSON.stringify(i)),Promise.resolve(n)}sendInternalMessage(e){return d(e,e.method,v(this).messageCallbacks.internal)}sendFakeIncomingMessage(e,t){return d(e,t,v(this).messageCallbacks.common)}enableLatencyObserver(){return null===v(this).pingPongTimeoutId&&(p(this),!0)}disableLatencyObserver(){let e=v(this);return null!==e.pingPongTimeoutId&&(clearTimeout(e.pingPongTimeoutId),e.pingPongTimeoutId=null,!0)}}function c(e){return new Promise(((t,n)=>{let r,s;try{s=new WebSocket(((o=e).secure?a.WSS:a.WS)+"://"+o.host+":"+o.port+"/"+o.path)}catch(e){return n(e)}var o;function c(){clearTimeout(r),s.removeEventListener("error",l),s.removeEventListener("open",u)}function l(){c(),n(i.A.ERROR_CODE.UNKNOWN)}function u(){c(),t(s)}r=window.setTimeout((()=>{c(),s.close(),n(i.A.ERROR_CODE.TIMEOUT)}),5e3),s.addEventListener("error",l),s.addEventListener("open",u)}))}function l(e){let t=function(e){if("string"!=typeof e)return null;let t;try{t=JSON.parse(e)}catch(e){return null}let n=t.method?"method":t.Method?"Method":null;if(null===n)return null;return t.method=t[n].charAt(0).toLowerCase()+t[n].slice(1),t}(e.data);if(!t)return;let n=I.get(this);n&&u.call(n,t)}function u(e){let t=v(this);t.signalingCallbacks.message.call(this,{protocol:this,message:e}),h(t.messageCallbacks.common,e.method,e),"command"===e.method&&function(e,t){let n=t.commnad?t.commnad:t.command?t.command:null;if(!n)return;let r=n.match(s);if(!r)return;let i=r[1],a=r[2];!function(e,t,n,r){if(!e[t])return;window.setTimeout((()=>{for(let i of e[t])i.callable(t,n,r,i.data)}),0)}(e.messageCallbacks.command,i,t.from,a)}(t,e)}function d(e,t,n){return e instanceof Object?new Promise((r=>{window.setTimeout((()=>{h(n,t,e),r(e)}),0)})):Promise.reject("Invalid data")}function h(e,t,n){if(e[t])for(let r of e[t])window.setTimeout((()=>r.callable(n,r.data)),0)}function f(e,t,n,r){e[n]||(e[n]=[]);let i={callable:t};void 0!==r&&(i.data=r),e[n].push(i)}function g(e,t,n){if(!e[n])return;let r=e[n],i=null;for(let e=0;e<r.length;e++)if(r[e].callable===t){i=e;break}null!==i&&(r.splice(i,1),0===r.length&&delete e[n])}function p(e){e.sendMessage({method:"ping"}).then((()=>{v(e).lastPingRequestTime=Date.now()}))}function m(){let e=I.get(this);if(!e)return;let t=v(e);t.messageCallbacks.command={},t.messageCallbacks.common={},t.messageCallbacks.internal={},t.signalingCallbacks.close.call(e,{protocol:e}),e.disableLatencyObserver()}function E(){let e=I.get(this);e&&v(e).signalingCallbacks.error.call(e,{protocol:o,errorCode:i.A.ERROR_CODE.UNKNOWN})}function T(e){let t=e.clone();return t.path=t.path?t.path:"websocket/",t}function C(e,t){return(e.secure?a.WSS:a.WS)+"://"+t+"@"+e.host+":"+e.port+"/"+e.path}const S=new WeakMap,I=new WeakMap;function v(e){let t=S.get(e);if(!t)throw new TypeError("Illegal invocation");return t}},7607:function(e,t,n){n.d(t,{A:function(){return r}});class r{onIncomingCall(e,t,n){}onCallSuccess(e){}onCallFail=function(e,t){};onDisconnected=function(e){};onHangUp=function(e){};onRemoteHangUp=function(e,t){};onVadStateChange(e){}onServerRecordingStateChange(e){}onStopContentSharing(e){}onInterpretingLanguages(e,t){}onUpdateFlatVolume(e,t){}}var i;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BY_STREAMS=1]="BY_STREAMS",e[e.BY_PART_LEAVE=2]="BY_PART_LEAVE",e[e.BY_DELETE=3]="BY_DELETE",e[e.BY_REJECT=4]="BY_REJECT",e[e.BY_EXPIR=5]="BY_EXPIR",e[e.BY_SERVER_RESTART=6]="BY_SERVER_RESTART",e[e.BY_PART_ACCDEN=7]="BY_PART_ACCDEN",e[e.BY_CREATE_NEW=8]="BY_CREATE_NEW",e[e.BY_LOW_RESOURCES=9]="BY_LOW_RESOURCES",e[e.BY_HUNGUP=10]="BY_HUNGUP",e[e.BY_INVITE_REJECT=11]="BY_INVITE_REJECT",e[e.BY_INVITE_NOT_FOUND=12]="BY_INVITE_NOT_FOUND",e[e.BY_INVITE_OFFLINE=13]="BY_INVITE_OFFLINE",e[e.BY_INVITE_BUSY=14]="BY_INVITE_BUSY",e[e.BY_ADMIN=15]="BY_ADMIN",e[e.BY_ANOTHER_ACCEPT=16]="BY_ANOTHER_ACCEPT",e[e.BY_ANOTHER_REJECT=17]="BY_ANOTHER_REJECT",e[e.BY_FREE_LIC_CONF_SLOT=18]="BY_FREE_LIC_CONF_SLOT"}(i||(i={}))},9214:function(e,t,n){var r=n(89369),i=n(79986);const s=[new r.vM("stun.l.google.com",19302),new r.uS("turn.trueconf.ru",r.uS.DEFAULT_PORT,new i.A("trial","R45f5gEd7foz")),new r.uS("turn.trueconf.com",r.uS.DEFAULT_PORT,new i.A("trialuser","U77aiewbgF5e"))];t.A=s},82611:function(e,t,n){n.d(t,{A:function(){return i}});var r=n(2004);class i{canPlay;promiseCallbackList=null;element;constructor(e){this.element=e,this.canPlay=!e.paused,e.addEventListener("canplay",(()=>this.onCanPlay()))}play(){return this.element.paused?this.canPlay?this.element.play():new Promise(((e,t)=>{null===this.promiseCallbackList&&(this.promiseCallbackList=[]),this.promiseCallbackList.push({resolve:e,reject:t})})):Promise.resolve()}async onCanPlay(){this.canPlay=!0,null!==this.promiseCallbackList&&this.tryToPlay().then((()=>this.processPlayResult(!0))).catch((()=>this.processPlayResult(!1)))}processPlayResult(e){if(null!==this.promiseCallbackList&&0!=this.promiseCallbackList.length)for(let t of this.promiseCallbackList)e?t.resolve():t.reject();else this.promiseCallbackList=null}async tryToPlay(e=0){return this.element.play().catch((async t=>{if(console.error("Cannot play element",t,"attempt number",e),e>=5)throw t;return await(0,r.IP)(200),this.tryToPlay(e++)}))}}},2004:function(e,t,n){n.d(t,{cY:function(){return r},IP:function(){return a}});class r{static create(){let e={};return new Promise((t=>{e.promise=new Promise(((n,r)=>{e.resolve=n,e.reject=r,t(e)}))}))}static createSync="withResolvers"in Promise?Promise.withResolvers.bind(Promise):r.createSyncImpl;static createSyncImpl(){let e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e}}class i extends Error{name="TCException";constructor(e,t){super(e,{cause:t}),2===arguments.length&&void 0!==t&&void 0===this.cause&&(this.cause=t)}}class s extends i{name="TCAbortedException";constructor(e,t){super(e,t)}}!function(){try{return function(){let e;window?e=window.queueMicrotask.bind(window):self?e=self.queueMicrotask.bind(self):globalThis&&(e=globalThis.queueMicrotask.bind(globalThis));if(e)return e;throw new Error}()}catch(e){return function(e){Promise.resolve().then(e).catch((e=>setTimeout((()=>{throw e}),0)))}}}();Symbol.iterator;async function a(e,t){const n=await r.create(),i=globalThis.setTimeout((()=>{n.resolve()}),e);return t&&function(e,t,n){if(e.aborted)return void t.reject(new s);const r=()=>{t.reject(new s)};e.addEventListener("abort",r),t.promise.catch((()=>{globalThis.clearTimeout(n)})),t.promise.finally((()=>{e.removeEventListener("abort",r)}))}(t,n,function(e){return function(e){return void 0!==e[Symbol.toPrimitive]}(e)?e[Symbol.toPrimitive]():e}(i)),n.promise}Symbol.for("AsyncMethodCallQueue"),Symbol.for("AsyncMethodQueueGroupResolver");var o=n(23067);o.cP},23067:function(e,t,n){n.d(t,{o4:function(){return o},cP:function(){return l}});Symbol("clone");Symbol("equals"),Symbol("compareTo");Symbol("compare");Symbol("instance");const r={application:{"octet-stream":["bin"],javascript:["js"],xml:["xml"],json:["json"],"x-bzip":["bz"],"x-bzip2":["bz2","boz"],msword:["doc","dot"],"vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"vnd.ms-fontobject":["eot"],gzip:["gz"],"java-archive":["jar"],"vnd.oasis.opendocument.presentation":["odp"],"vnd.oasis.opendocument.spreadsheet":["ods"],"vnd.oasis.opendocument.text":["odt"],pdf:["pdf"],"vnd.ms-powerpoint":["ppt","pps","pot"],"vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"vnd.rar":["rar"],"x-rar-compressed":["rar"],rtf:["rtf"],"x-tar":["tar"],"vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],zip:["zip"],"x-7z-compressed":["7z"],"vnd.microsoft.portable-executable":["exe","dll"],"application/vnd.android.package-archive":["apk"]},audio:{aac:["aac","adts"],aiff:["aff","aif","aiff"],alac:["m4a","caf"],amr:["amr"],"x-ape":["ape"],flac:["flac"],"x-flac":["flac"],mp4:["m4a","mp4","mpg4"],midi:["midi","mid"],"x-midi":["midi","mid"],mpeg:["mp3","mpga","mp2","mp2a","m2a","m3a"],ogg:["ogg","oga","opus"],opus:["opus","ogg"],wav:["wav","wave"],"x-ms-wma":["wma"],webm:["webm","weba"]},image:{jpeg:["jpeg","jpg"],gif:["gif"],png:["png"],"x-exr":["exr"],webp:["webp"],"vnd.radiance":["hdr","pic","rgbe","xyze"],heif:["heif","hif"],heic:["heic","hif"],avif:["avif","heif","heifs","hif"],tiff:["tif","tiff"],bmp:["bmp","dib"],"vnd.adobe.photoshop":["psd","psb"],"vnd.microsoft.icon":["ico"],"svg+xml":["svg"],"image/x-adobe-dng":["dng"]},video:{webm:["webm"],"x-matroska":["mkv","mk3d","mks"],"x-flv":["flv"],ogg:["ogv"],"x-msvideo":["avi"],mp2t:["ts","tsv","tsa","m2t"],quicktime:["mov","movie","qt","qtvr"],"x-ms-wmv":["wmv"],mp4:["mp4","mp4v","mpg4"],mpeg:["mpg","mpeg","mpe","m1v","m2v"],"3gpp":["3gp","3gpp"]},text:{plain:["txt"],css:["css"],csv:["csv"],html:["html"],calendar:["ics"],javascript:["js","mjs","cjs"]}},i={bin:"application/octet-stream",js:"application/javascript",json:"application/json",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",zip:"application/zip","7z":"application/x-7z-compressed",aac:"audio/aac",flac:"audio/flac",m4a:"audio/mp4",midi:"audio/midi",mp3:"audio/mpeg",wav:"audio/wav",jpg:"image/jpeg",gif:"image/gif",png:"image/png",webp:"image/webp",heif:"image/heif",heic:"image/heif",svg:"image/svg+xml",dng:"image/x-adobe-dng",webm:"video/webm",mkv:"video/x-matroska",mp4:"video/mp4",txt:"text/plain",csv:"text/csv"};function s(e,t){return r.hasOwnProperty(e)&&r[e].hasOwnProperty(t)?r[e][t]:null}class a{static FULL_MIME_STRING_REGEXP=/^(.+?)\/(.+?)(?:\u0020*;\u0020*(.+)|$)/;static MIME_PARAMS_REGEXP=/\u0020*(.*?)=(.+?)\u0020*(?:;|$)/g;static defaultMimeTypeInstance=null;type;subtype;params;constructor(e,t,n=null){this.type=e.toLowerCase(),this.subtype=t,this.params=n}static getDefault(){return null===a.defaultMimeTypeInstance&&(a.defaultMimeTypeInstance=new a("application","octet-stream")),a.defaultMimeTypeInstance}static parse(e){let t=e.match(a.FULL_MIME_STRING_REGEXP);if(null===t)throw new TypeError("Invalid mime type!");let[,n,r,i]=t;return void 0===i?new a(n,r):new a(n,r,this.parseParamsString(i))}static parseParamsString(e){let t,n=[],r=e.matchAll(a.MIME_PARAMS_REGEXP);for(;!(t=r.next()).done;)n.push([t.value[1],t.value[2]]);return n}static fromFileExtension(e){let t=function(e){"."===e[0]&&(e=e.slice(1)),e=e.toLowerCase();let t=i[e];if(void 0!==t)return t;for(let t in r)for(let n in r[t])if(-1!==r[t][n].indexOf(e))return t+"/"+n;return null}(e);if(null===t)return a.getDefault();let n=t.indexOf("/");if(-1===n)throw new TypeError("Invalid mime type!");return new a(t.slice(0,n),t.slice(n+1))}getPreferredFileExtension(){return function(e,t){let n=s(e,t);return n&&n[0]?n[0]:null}(this.type,this.subtype)}getFileExtensions(){return s(this.type,this.subtype)}isApplication(){return"application"===this.type}isAudio(){return"audio"===this.type}isFont(){return"font"===this.type}isExample(){return"example"===this.type}isImage(){return"image"===this.type}isMessage(){return"message"===this.type}isModel(){return"model"===this.type}isMultipart(){return"multipart"===this.type}isText(){return"text"===this.type}isVideo(){return"video"===this.type}getType(){return this.type}getSubtype(){return this.subtype}getParameters(){return this.params}toString(){return this.type+"/"+this.subtype+this.paramsToString()}paramsToString(){if(!this.params)return"";let e="";for(let t of this.params)e+="; "+t[0]+"="+t[1];return e}}class o{value;constructor(e){this.value=e}static async fromBlob(e){let t=await e.arrayBuffer();return o.fromArrayBuffer(t)}static fromArrayBuffer(e){return o.fromTypedArray(new Uint8Array(e))}static fromTypedArray(e){let t="";e instanceof Uint8Array||(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength));let n=e.byteLength;for(let r=0;r<n;r++)t+=String.fromCharCode(e[r]);let r=globalThis.btoa(t);return new o(r)}getValue(){return this.value}toBlob(e){e||(e=a.getDefault().toString());let t=this.toArrayBuffer(),n={};return void 0!==e&&(n.type=e),new Blob([t],n)}toArrayBuffer(){return this.toUint8Array().buffer}toUint8Array(){let e=globalThis.atob(this.value),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n}toString(){return this.value}}Error;new TextDecoder("utf-8");class c{static alphabet="0123456789abcdef";static encodeLookup=[];static decodeLookup=[];static{for(let e=0;e<256;e++)this.encodeLookup[e]=this.alphabet[e>>4&15]+this.alphabet[15&e],e<16&&(e<10?this.decodeLookup[48+e]=e:this.decodeLookup[87+e]=e)}static binary2HexString(e){const t=e.length;let n="",r=0;for(;r<t;)n+=this.encodeLookup[e[r++]];return n}static hexString2Binary(e){const t=(e=e.toLowerCase()).length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=this.decodeLookup[e.charCodeAt(s++)]<<4|this.decodeLookup[e.charCodeAt(s++)];return r}constructor(){}}Symbol("lazyProperties");class l{observerList;notifyObservers=this.notifyNothing;constructor(){}get numObservers(){return void 0!==this.observerList?this.observerList.length:0}addObserver(e){void 0===this.observerList?(this.observerList=[e],this.notifyObservers=this.notifySingleObserver):-1===this.observerList.indexOf(e)&&(this.observerList.push(e),this.notifyObservers=this.notifyObserverList)}removeObserver(e){if(void 0===this.observerList)return;if(1===this.observerList.length)return this.observerList=void 0,void(this.notifyObservers=this.notifyNothing);const t=this.observerList.indexOf(e);-1!=t&&this.observerList.splice(t,1)}hasObserver(e){return void 0!==this.observerList&&-1!==this.observerList.indexOf(e)}notifySingleObserver(e){this.observerList[0].call(this,e)}notifyObserverList(e){for(let t of this.observerList)t.call(this,e)}notifyNothing(e){}}var u,d,h;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.IA32=1]="IA32",e[e.X86_64=2]="X86_64",e[e.ARM=3]="ARM",e[e.ARM64=4]="ARM64",e[e.MIPS=5]="MIPS"}(u||(u={})),function(e){e.fromName=function(t){return/win/i.test(t)?e.WINDOWS:/linux/i.test(t)?e.LINUX:/mac|darwin/i.test(t)?e.MAC:/ios|iphone|ipad/i.test(t)?e.IOS:/Android/i.test(t)?e.ANDROID:/Chrome|Chromium/i.test(t)?e.CHROME_OS:/FreeBSD/i.test(t)?e.FREE_BSD:/OpenBSD/i.test(t)?e.OPEN_BSD:/Solaris/i.test(t)?e.SOLARIS:/Fuchsia/i.test(t)?e.FUCHSIA:e.UNKNOWN}}(d||(d={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WINDOWS=1]="WINDOWS",e[e.LINUX=2]="LINUX",e[e.MAC=3]="MAC",e[e.IOS=4]="IOS",e[e.ANDROID=5]="ANDROID",e[e.CHROME_OS=6]="CHROME_OS",e[e.FREE_BSD=7]="FREE_BSD",e[e.OPEN_BSD=8]="OPEN_BSD",e[e.SOLARIS=9]="SOLARIS",e[e.FUCHSIA=10]="FUCHSIA"}(d||(d={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BROWSER=1]="BROWSER",e[e.NODE=2]="NODE",e[e.DENO=3]="DENO"}(h||(h={}))},9242:function(e,t,n){function r(e){let t=[];function n(e){for(let n=0;n<t.length;n++)t[n].apply(this,e)}this.addObserver=function(e){if(e instanceof Function==!1)throw new Error("Invalid observer!");-1===t.indexOf(e)&&t.push(e)},this.removeObserver=function(e){let n=0;return-1!==(n=t.indexOf(e))&&(t.splice(n,1),!0)},this.hasObserver=function(e){return-1!==t.indexOf(e)},function(){e.observer=t,e.notifyObservers=n}.call(this)}function i(e,t=200){const n=this;let i,s,a,o={};r.call(this,o);let c=0,l=0,u=0,d=0,h=0,f=0;function g(e){l++;let t=e.inputBuffer.getChannelData(0);for(let e=0;e<d;e++){let n=u*e;h+=t[n]*t[n]}if(l===c){let e=function(){let e=Math.sqrt(h/(d*c));f=(f+e)/2;let t=20*Math.log10(f+1.52*1e-5)+96-35;t<0&&(t=0);return t*(100/61)}();o.notifyObservers.call(n,[e]),h=0,l=0}}this.start=function(){a.onaudioprocess=g,s.connect(a),a.connect(i.destination)},this.stop=function(){s.disconnect(a),a.disconnect(i.destination)},function(){i=new AudioContext;let n=new MediaStream;n.addTrack(e),s=i.createMediaStreamSource(n),a=i.createScriptProcessor(0,1,1);let r=i.sampleRate/1e3*t;if(c=Math.floor(r/a.bufferSize),c<1)throw new Error("Delay is too small!");u=a.bufferSize/128*c,d=Math.floor(a.bufferSize/u),0===d&&(d=1)}.call(this)}n.d(t,{A:function(){return a}}),i.prototype=Object.create(r.prototype);n(31456);var s=n(82611);function a(e,t,n,r){let a,o,c;Object.defineProperty(this,"volumeObserver",{get:function(){return o||(o=new i(e)),o}}),Object.defineProperty(this,"volume",{get:()=>a.volume,set:e=>a.volume=e}),this.setOutputDevice=function(e){a.setSinkId&&a.setSinkId(e.deviceId),r&&r(e)},this.pause=function(){a.pause()},this.resume=function(){a.play()},this.play=function(){return c.play()},function(){let r;n&&(r=n.values().next().value),r||(r=new MediaStream,r.addTrack(e)),a=document.createElement("audio"),a.autoplay=!0,a.srcObject=r,c=new s.A(a),t.appendChild(a)}.call(this)}},53044:function(e,t,n){n.d(t,{A:function(){return r}});n(33087),n(9242);function r(){this.onDeviceCaptured=function(e){},this.onDeviceReleased=function(e){},this.onDeviceMuted=function(e){},this.onDeviceUnmuted=function(e){},this.onDevicePlayerCreated=function(e,t){}}},33087:function(e,t,n){function r(e,t){let n;this.pause=function(){n.pause()},this.resume=function(){n.play()},function(){let r=new MediaStream;r.addTrack(e),n=document.createElement("video"),n.addEventListener("canplaythrough",(()=>n.play())),n.autoplay=!0,n.srcObject=r,t.appendChild(n)}.call(this)}n.d(t,{A:function(){return s}});var i=n(9242);n(31456),n(49387);function s(e,t,n){const s=this;let a,o;function c(){"ended"===t.readyState?l():o=setTimeout(c,1e3)}function l(){n&&(n("onDeviceReleased",s),n=null),a&&(clearTimeout(o),a.call(s),a=null)}this.track=t,this.deviceInfo=e,this.type=e.type,this.pause=function(){t.enabled&&"ended"!==t.readyState&&(t.enabled=!1,n("onDeviceMuted",s))},this.resume=function(){t.enabled||"ended"===t.readyState||(t.enabled=!0,n("onDeviceUnmuted",s))},this.release=function(){return"ended"===t.readyState?Promise.resolve(s):new Promise((e=>{o=setTimeout(c,1e3),a=e,t.stop(),s.audioTrack&&"ended"!==s.audioTrack.readyState&&s.audioTrack.stop()}))},this.createPlayer=function(e){let a;switch(t.kind){case"video":a=new r(t,e);break;case"audio":a=new i.A(t,e);break;default:throw"Unknown track type"}return n("onDevicePlayerCreated",s,a),a},t.addEventListener("ended",l)}},25502:function(e,t,n){n.d(t,{A:function(){return i}});var r=n(49387);n(33087);function i(e){const t=this;let n=[],i=[];function s(t){return t===r.A.TYPE.CAMERA?i:t===r.A.TYPE.MICROPHONE?n:e}this.numDevices=0,this.numCameras=0,this.numMicrophones=0,this.getDevices=function(e){let t=[];for(let n of s(e))t.push(n);return t},this.getTracks=function(e){let t=[];for(let n of s(e))t.push(n.track);return t},this.pause=function(e){for(let t of s(e))t.track.enabled=!1},this.resume=function(e){for(let t of s(e))t.track.enabled=!0},this.release=function(e){let t=[];for(let n of s(e))t.push(n.release());return Promise.all(t)},function(){t.numDevices=e.length;for(let t of e)t.type===r.A.TYPE.CAMERA?i.push(t):t.type===r.A.TYPE.MICROPHONE&&n.push(t);t.numMicrophones=n.length,t.numCameras=i.length,Object.freeze(t)}.call(this)}},96315:function(e,t,n){n.d(t,{A:function(){return me}});var r,i=n(71583),s=n(81871);class a{canSendVideo;canSendAudio;canDesktopSharing;canSendChatMessages;canSendFile;constructor(e){this.canSendVideo=!!(e&r.VIDEO_SEND),this.canSendAudio=!!(e&r.AUDIO_SEND),this.canSendChatMessages=!!(e&r.CHAT_SEND),this.canDesktopSharing=!!(e&r.DS_ALLOWED),this.canSendFile=!!(e&r.FT_SEND)}}!function(e){e[e.NONE=0]="NONE",e[e.CHAT_SEND=1]="CHAT_SEND",e[e.CHAT_RECV=2]="CHAT_RECV",e[e.SS_SEND=4]="SS_SEND",e[e.SS_RECV=8]="SS_RECV",e[e.WB_SEND=16]="WB_SEND",e[e.WB_RECV=32]="WB_RECV",e[e.FT_SEND=64]="FT_SEND",e[e.FT_RECV=128]="FT_RECV",e[e.DS_ALLOWED=256]="DS_ALLOWED",e[e.REC_ALLOWED=512]="REC_ALLOWED",e[e.AUDIO_SEND=1024]="AUDIO_SEND",e[e.AUDIO_RCV=2048]="AUDIO_RCV",e[e.VIDEO_SEND=4096]="VIDEO_SEND",e[e.VIDEO_RCV=8192]="VIDEO_RCV",e[e.ALL=4294967295]="ALL"}(r||(r={}));var o=n(89859),c=n(79363);function l(){this.onLayoutChange=function(e,t,n,r){}}var u=n(82611);function d(e,t,n,r,i){const s=4e3,a=100,d=1e3/15;var h,f=this;let g=!1;var p,m,E=[],T={},C={},S=[],I={},v=0,A=0,R=null,L=0,N={clientWidth:-1,clientHieght:-1,renderWidth:-1,renderHeight:-1,offsetX:-1,offsetY:-1,aspectRatio:16/9},O=!1;let y;function P(){var e=h.videoWidth/h.videoHeight;N.aspectRatio=e,O=!0,requestAnimationFrame((function e(){N.clientWidth===h.clientWidth&&N.clientHeight===h.clientHeight||U(),v>0&&function(){var e=Date.now();for(var t in I)for(var n=0;n<I[t].length;n++){var r=I[t][n];if(!(r.paused||r.lastRepaintTime+d>e)){r.lastRepaintTime=e,C[t].needRefreshRealLayoutRect&&(x(C[t].real,T[t].layout),C[t].needRefreshRealLayoutRect=!1);var i=C[t].real;r.context.drawImage(h,i.x,i.y,i.width,i.height,0,0,i.width,i.height)}}}(),O&&requestAnimationFrame(e)}))}function w(e,t,n,r){g=!e,R&&clearTimeout(R);var i=Date.now(),o=!1,c=R=setTimeout((function(){o=!0,R=null,b(t,n,r)}),a);(function(){if(L+s>=Date.now())return Promise.resolve(A);return Promise.resolve(100)})().then((e=>{if(!o&&c===R){clearTimeout(R),R=null;var s=e-(Date.now()-i);s<0&&(s=0),R=setTimeout((()=>{R=null,b(t,n,r)}),s)}}))}function b(e,t,n){p=e,m=t,S=[];var r={};o.A.runListenersWithArgs(f,E,"onServerRefreshLayout",[]);for(var i=0;i<n.length;i++){var s=n[i];T.hasOwnProperty(s.id)?k(s):_(s),s.priority&&S.push(s.id),r[s.id]=!0}for(var a in T)if(r[a]){var c="onLayoutChange";C[a]||(c="onParticipantJoined",C[a]={real:{},scaled:{},needRefreshRealLayoutRect:!0}),F(C[a].scaled,T[a].layout)&&(o.A.runListenersWithArgs(f,E,c,[a,T[a].user,C[a].scaled,T[a].hasPriority],!1),C[a].needRefreshRealLayoutRect=!0)}else{if(delete T[a],delete C[a],I[a])for(i=I[a].length-1;i>=0;i--)I[a][i].onStop();o.A.runListenersWithArgs(f,E,"onParticipantLeft",[a])}r=null}function _(e){T[e.id]={},T[e.id].layout={},D(T[e.id].layout,e.rect),T[e.id].hasPriority=e.priority;var t=n.getUser(e.id);T[e.id].user=t}function k(e){D(T[e.id].layout,e.rect),T[e.id].hasPriority=e.priority}function D(e,t){e.x=t[0],e.y=t[1],e.width=t[2]-t[0],e.height=t[3]-t[1]}function M(){if(O){var e=h.videoWidth/h.videoHeight;N.aspectRatio!==e&&(N.aspectRatio=e),U(!0)}}function U(e){for(var t in N.clientWidth=h.clientWidth,N.clientHeight=h.clientHeight,N.offsetX=0,N.offsetY=0,N.renderWidth=h.clientWidth,N.renderHeight=h.clientHeight,h.clientWidth/h.clientHeight>=N.aspectRatio?(N.renderWidth=h.clientHeight*N.aspectRatio,N.offsetX=(h.clientWidth-N.renderWidth)/2):(N.renderHeight=h.clientWidth/N.aspectRatio,N.offsetY=(h.clientHeight-N.renderHeight)/2),T){F(C[t].scaled,T[t].layout)&&o.A.runListenersWithArgs(f,E,"onLayoutChange",[t,T[t].user,C[t].scaled,T[t].hasPriority],!1),e&&(C[t].needRefreshRealLayoutRect=!0)}}function x(e,t){var n=p/h.videoWidth,r=m/h.videoHeight;return B(e,t.x/n,t.y/r,t.width/n,t.height/r)}function F(e,t){var n=p/N.renderWidth,r=0;176===h.videoHeight&&(r=4*(N.renderHeight/h.videoHeight));var i=m/(N.renderHeight+r),s=N.offsetX+t.x/n,a=N.offsetY+t.y/i,o=t.width/n,c=t.height/i;return 176===h.videoHeight&&a+c>N.renderHeight&&(c-=a+c-N.renderHeight),B(e,s,a,o,c)}function B(e,t,n,r,i){return(e.x!==t||e.y!==n||e.width!==r||e.height!==i)&&(e.x=t,e.y=n,e.width=r,e.height=i,!0)}function V(e){var t=!0;function n(){var n;(t=!1,I.hasOwnProperty(e.userId))&&(-1!==(n=I[e.userId].indexOf(e))&&(I[e.userId].splice(n,1),0===I[e.userId].length&&(delete I[e.userId],v--)))}this.pause=function(){e.data.paused=!0},this.resume=function(){e.data.paused=!1},this.stop=function(){t&&n()},this.getCanvasElement=function(){return e.canvas},this.getCanvasRenderingContext=function(){return e.context},function(){e.onStop=n}.call(this)}this.setPriority=function(e,n){if(!T.hasOwnProperty(e))throw"Unknow user '"+e+"'";var r=S.indexOf(e);n!==(-1!==r)&&(n?(1===S.length&&S.splice(0,1),S.push(e),t.setPriorityLayout(S)):(S.splice(r,1),0===S.length?t.setUniformLayout():t.setPriorityLayout(S)))},this.canManageLayout=function(){return g},this.play=function(){return y.play()},this.swap=function(e,n){if(!T.hasOwnProperty(e)||!T.hasOwnProperty(n))throw"Unknow user";t.swapLayouts(e,n)},this.refreshLayout=function(){t.sendLayoutRequest()},this.createSnapShot=function(e){if(!T.hasOwnProperty(e))throw"User not found!";C[e].needRefreshRealLayoutRect&&(x(C[e].real,T[e].layout),C[e].needRefreshRealLayoutRect=!1);var t=C[e].real,n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(h,t.x,t.y,t.width,t.height,0,0,t.width,t.height),n},this.captureStream=function(e){if(!T.hasOwnProperty(e))throw"User not found!";C[e].needRefreshRealLayoutRect&&(x(C[e].real,T[e].layout),C[e].needRefreshRealLayoutRect=!1);var t=C[e].real,n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d"),i={canvas:n,context:r,userId:e,lastRepaintTime:0};return I.hasOwnProperty(e)||(I[e]=[],v++),I[e].push(i),new V(i)},this.getUserCapturedStreams=function(e){if(!T.hasOwnProperty(e))return[]},this.isPriorityUser=function(e){return-1!==S.indexOf(e)},this.addLayoutListener=function(e){o.A.addListener(c.A,E,e)},this.removeLayoutListener=function(e){return o.A.removeListener(E,e)},function(){if("ended"===!e.readyState)throw"Track with id "+e.id+" has been ended!";var n;!function(){let t=new MediaStream;t.addTrack(e),(h=document.createElement("video")).autoplay=!0,h.playsInline=!0,h.controls=!1,h.addEventListener("resize",M),h.addEventListener("canplay",P),h.srcObject=t,i.appendChild(h),y=new u.A(h)}(),(n=new l).onLayoutChange=w,t.addSignalingListener(n),f.refreshLayout()}.call(this)}d.PRIORITY_LAYOUT_POSITION={CORNER:0,TOP:1,LEFT:2,OVERLAY:3},Object.freeze(d.PRIORITY_LAYOUT_POSITION);var h=n(9242);function f(){this.onJoinResponse=function(e,t,n){},this.onMediaConnection=function(e,t,n){},this.onConferenceDeleted=function(e,t,n){},this.onMediaFilter=function(e,t){},this.onVadStateChange=function(e){},this.onDeviceState=function(e,t,n){},this.onServerRecordingState=function(e,t){},this.onStopContentSharing=function(e,t){},this.onInterpretingChannels=function(e,t){},this.onUpdateFlatVolume=function(e,t){}}var g=n(49387);function p(e,t,n){let r=this,i=[],s="";function a(e){switch(e.type){case g.A.TYPE.CAMERA:return"camera";case g.A.TYPE.MICROPHONE:return"microphone";case g.A.TYPE.SPEAKER:return"speaker";case g.A.TYPE.SCREEN:return"desktop"}}this.sendJoinRequest=function(e){l({method:"join",conferenceId:n,Password:void 0===e?"":e.toString(),simulcastSupported:!0})},this.connectToMediaSrv=function(){l({method:"connectMedia",streamConferenceId:s,type:1})},this.sendHangUpRequest=function(e){l({method:"hangup",result:e,conferenceId:n})},this.sendDeviceList=function(e,t){let n=[];for(let e of t)n.push({id:e.deviceId,Name:e.label});"speaker"===e&&n.push({id:"default",Name:"Default device"}),l({method:"DevicesList",Type:e,list:n})},this.sendFakeScreenDevices=function(){this.sendDeviceList("desktop",[{deviceId:"screen",label:"screen"}])},this.sendVolumeLevels=function(e,t,n){l({method:"AudioLevel",Conference:s,VadVersion:1,AudioStatTm:Math.round(performance.timeOrigin+performance.now()),AudioStatInterval:n,AudioLevelValue:t,AudioVadValue:e})},this.sendVadStateChange=function(e){l({method:"VadStateChange",Conference:s,UserName:t.getTrueconfId(),VadSelectorEnabled:e})},this.sendCurrentDevice=function(e){var t={method:"DeviceChanged",Type:a(e),id:e.deviceId,Name:e.label};"desktop"===t.Type&&(t.id="screen",t.Name="screen"),l(t)},this.sendNoneDevice=function(e){l({method:"DeviceChanged",Type:a(e),id:"",Name:""})},this.sendDeviceState=function(e){l({method:"DeviceState",Type:a(e.deviceInfo),id:e.deviceInfo.deviceId,Name:e.deviceInfo.label,Mute:!e.track.enabled})},this.sendVideoSource=function(e){l({method:"VideoSourceType",Type:e,Conference:s})},this.sendMicrophoneVolume=function(e,t){l({method:"DeviceState",Type:"microphone",id:e,Volume:t})},this.addSignalingListener=function(e){o.A.addListener(f,i,e)},this.removeSignalingListener=function(e){return o.A.removeListener(i,e)},this.destruct=function(){e.removeMessagesCallback(c.conferenceStateChange.handle,"conferenceStateChange"),e.removeMessagesCallback(u,"listenersFltr"),i=null,t=null,e=null};const c={conferenceStateChange:{handle:function(e){e.conference.hasOwnProperty("message")&&c.conferenceStateChange.hasOwnProperty(e.conference.message)&&c.conferenceStateChange[e.conference.message](e.conference,e.commands,e)},deleteConference:function(e){o.A.runListenersWithArgs(r,i,"onConferenceDeleted",[e.conferenceId,e.streamConferenceId,e.lastRejectReason,e.terminationCause])},joinResponse:function(e,t,n){s=e.streamConferenceId,o.A.runListenersWithArgs(r,i,"onJoinResponse",[e,t,n])}}};function l(n){n.CID=t.CID,e.sendMessage(n)}function u(e){o.A.runListenersWithArgs(r,i,"onMediaFilter",[!!(256&e.MediaFiltr),!!(512&e.MediaFiltr)])}function d(e){o.A.runListenersWithArgs(r,i,"onMediaConnection",[e.result,e.type,e.connectionId])}function h(e){o.A.runListenersWithArgs(r,i,"onVadStateChange",[e.VadSelectorEnabled??!1,e.VadParametricEnabled??!1])}function p(e){o.A.runListenersWithArgs(r,i,"onDeviceState",[e.id,e.Type,e.Volume])}function m(e){o.A.runListenersWithArgs(r,i,"onServerRecordingState",[e.Conference,e.RecordingState])}function E(e){o.A.runListenersWithArgs(r,i,"onStopContentSharing",[e.Conference,e.From])}function T(e){o.A.runListenersWithArgs(r,i,"onInterpretingChannels",[e.Conference,e.Channels])}function C(e){o.A.runListenersWithArgs(r,i,"onUpdateFlatVolume",[e.Conference,e.Volume])}(function(){e.addMessagesCallback(c.conferenceStateChange.handle,"conferenceStateChange"),e.addMessagesCallback(u,"listenersFltr"),e.addMessagesCallback(d,"connectMedia"),e.addMessagesCallback(h,"vadStateChange"),e.addMessagesCallback(p,"setDeviceState"),e.addMessagesCallback(m,"updateConfRecordingState"),e.addMessagesCallback(T,"interpretingChannels"),e.addMessagesCallback(E,"stopContentSharing"),e.addMessagesCallback(C,"updateFlatVolume")}).call(this),Object.freeze(this)}function m(e,t,n){var r=this,i=[];function s(n){n.method="ManageLayout",n.CID=e.CID,t.sendMessage(n)}function a(){t.addMessagesCallback((function(e){if("layout"===e.type)!function(e){o.A.runListenersWithArgs(r,i,"onLayoutChange",[!(n<22)&&e.fixed,e.width,e.height,e.list])}(e)}),"webrtc")}this.setUniformLayout=function(){s({func:m.LAYOUT_COMMAND_UNIFORM})},this.setPriorityLayout=function(e){var t=m.LAYOUT_COMMAND_ONE_PRIORITY;e.length>=2&&(t=m.LAYOUT_COMMAND_TWO_PRIORITY),s({func:t,UserName:e})},this.swapLayouts=function(e,t){s({func:"Swap",UserName:[e,t]})},this.setPriorityLayoutPosition=function(e){s({func:"PriorityType",type:e})},this.sendLayoutRequest=function(){s({func:"Get"})},this.getProtocol=function(){return t},this.addSignalingListener=function(e){o.A.addListener(l,i,e)},this.removeSignalingListener=function(e){return o.A.removeListener(i,e)},this.destruct=function(){i=[],t.removeListener(undefined),t=null},function(){a(),Object.freeze(this)}.call(this)}function E(){this.onSessionDescription=function(e,t){},this.onNegotiationNeeded=function(){},this.onIceCandidate=function(e,t,n){},this.onRestrictBitrate=function(e){}}m.LAYOUT_COMMAND_UNIFORM="SetP0",m.LAYOUT_COMMAND_ONE_PRIORITY="SetP1",m.LAYOUT_COMMAND_TWO_PRIORITY="SetP2";n(58237);function T(e,t,n){let r=this,i=[];this.sendIceCandidate=function(e){c({candidate:e.toString(),sdpMLineIndex:e.mLineIndex,sdpMid:e.mId,type:"candidate",my_peer_id:t.getTrueconfId(),conf_id:n.streamId})},this.sendSessionDescription=function(e,r){c({type:e.type,sdp:e.sdp,conf_id:n.streamId,browser:navigator.userAgent,my_peer_id:t.getTrueconfId(),trueconf_id:r})},this.sendNegotiationNeeded=function(){throw"Only for P2P conferences"},this.addSignalingListener=function(e){o.A.addListener(E,i,e)},this.removeSignalingListener=function(e){return o.A.removeListener(i,e)};let s={answer:function(e){o.A.runListenersWithArgs(r,i,"onSessionDescription",[e.type,e.sdp])},offer:function(e){o.A.runListenersWithArgs(r,i,"onSessionDescription",[e.type,e.sdp])},candidate:function(e){o.A.runListenersWithArgs(r,i,"onIceCandidate",[e.candidate,e.sdpMid,e.sdpMLineIndex])},candidate_complete:function(e){},negotiation:function(){o.A.runListeners(r,i,"onNegotiationNeeded")},restrictBitrate:function(e){o.A.runListenersWithArgs(r,i,"onRestrictBitrate",[e.bitrateConfigs])}};function a(e){s.hasOwnProperty(e.type)&&s[e.type].call(r,e)}function c(n){n.CID=t.CID,n.method="webrtc",e.sendMessage(n)}(function(){e.addMessagesCallback(a,"webrtc")}).call(this),Object.freeze(this)}var C=n(35782);class S{constructor(e){I.set(this,e)}get id(){return v(this).cid}get callId(){return v(this).callId}get streamId(){return v(this).streamId}get topic(){return v(this).topic}get type(){return v(this).type}get chatId(){return v(this).chatId}get subType(){return v(this).subType}get ownerTrueConfId(){return v(this).ownerTrueConfId}}const I=new WeakMap;function v(e){let t=I.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class A extends S{constructor(e){super(e)}}var R=n(63119);class L extends R.A{constructor(e,t){let n={};super(n),O.set(this,{participantList:t,conferenceEntity:e,eventTarget:n}),t.addConferenceParticipantEventCallback(e,n.fireEvent)}get size(){let{participantList:e,conferenceEntity:t}=N(this);return e.count(t)}has(e){let{participantList:t,conferenceEntity:n}=N(this);return t.has(n,e)}get(e){let{participantList:t,conferenceEntity:n}=N(this);return t.getParticipant(n,e)}getTrueConfIdList(){let{participantList:e,conferenceEntity:t}=N(this);return e.getTrueConfIdList(t)}getList(){let{participantList:e,conferenceEntity:t}=N(this),n=e.getConferenceParticipantList(t);if(!n)throw"Conference not found!";return n}getOperatorList(){let{participantList:e,conferenceEntity:t}=N(this),n=e.operatorList.get(t.streamId);if(!n)throw"Conference not found!";return new Set(n)}getClientParticipant(){let{participantList:e,conferenceEntity:t}=N(this);return e.clientParticipantList.get(t.streamId)}kick(e){let{participantList:t,conferenceEntity:n}=N(this);return t.kick(n,e)}invite(e){throw"Not implemented yet!"}async setPinned(e,t){let{participantList:n,conferenceEntity:r}=N(this);return n.setPinned(r,e,t)}async setWaitingRoomState(e,t){const{participantList:n,conferenceEntity:r}=N(this);return n.setWaitingRoomState(r,e,t)}async stopContentSharing(e){let{participantList:t,conferenceEntity:n}=N(this);return t.stopContentSharing(n,e)}listenToChannel(e){let{participantList:t,conferenceEntity:n}=N(this);return t.listenToChannel(n,e)}translateToChannel(e){let{participantList:t,conferenceEntity:n}=N(this);return t.translateToChannel(n,e)}}function N(e){let t=O.get(e);if(!t)throw new TypeError("Illegal invocation");return t}const O=new WeakMap;var y,P=n(66231),w=n(32935),b=(n(24966),n(11363));!function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC",e[e.SYSTEM=2]="SYSTEM"}(y||(y={}));var _=n(58701);new WeakMap,new WeakMap;class k extends Error{constructor(e,t,n=null){super(t),this.name=e,this.throwable=n}get cause(){return this.throwable}}class D extends k{constructor(e,t=null){super("TCIllegalStateException",e,t)}}class M extends k{constructor(e,t=null){super("TCInterruptedException",e,t)}}class U{static queue(e){U.queueMicrotaskMethod(e)}}U.queueMicrotaskMethod=function(){try{return function(){let e;window?e=window.queueMicrotask.bind(window):self?e=self.queueMicrotask.bind(self):globalThis&&(e=globalThis.queueMicrotask.bind(globalThis));if(e)return e;throw new Error}()}catch(e){return function(e){Promise.resolve().then(e).catch((e=>setTimeout((()=>{throw e}),0)))}}}();class x{static create(){let e={};return new Promise((t=>{e.promise=new Promise(((n,r)=>{e.resolve=n,e.reject=r,t(e)}))}))}}Symbol.for("AsyncMethodCallQueue"),Symbol.for("AsyncMethodQueueGroupResolver");class F{constructor(e){this.eventNames=e}getEventNames(){return this.eventNames}}class B extends F{constructor(e){super([e.getEventName()]),this.rule=e}static createInstance(e){return new B(e[0])}getSuitableRule(e,t){if(e!==this.rule.getEventName())throw new TypeError;return t[this.rule.getPropertyName()]===this.rule.getEventValue()?this.rule:null}}class V extends F{constructor(e,t){super(t),this.ruleList=e}static createInstance(e){let t=new Map,n=[];for(let r of e){let e=r.getEventName(),i=t.get(e);if(void 0===i)t.set(e,this.createSingleRuleBucket(r)),n.push(e);else if(i.isSingleBucket){let n=this.upgradeSingleRuleBucketToBulk(i);t.set(e,n)}else i.ruleList.push(r)}return new V(t,n)}getSuitableRule(e,t){let n=this.ruleList.get(e);return void 0===n?null:n.comparator(n,t)}static createSingleRuleBucket(e){return{rule:e,isSingleBucket:!0,comparator:W}}static upgradeSingleRuleBucketToBulk(e){return{ruleList:[e.rule],isSingleBucket:!1,comparator:Y}}}function W(e,t){return t[e.rule.getPropertyName()]===e.rule.getEventValue()?e.rule:null}function Y(e,t){for(let n of e.ruleList){if(t[n.getPropertyName()]===n.getEventValue())return n}return null}class j{constructor(e,t){this.event=e,this.rule=t}getEvent(){return this.event}getEventName(){return this.rule.getEventName()}getRule(){return this.rule}}class H{constructor(e,t,n){this.eventName=e,this.propertyName=t,this.eventValue=n}getEventName(){return this.eventName}getPropertyName(){return this.propertyName}getEventValue(){return this.eventValue}}class q extends H{constructor(e,t,n,r=null){super(e,t,n),this.exceptionCallback=r}getExceptionCallback(){return this.exceptionCallback}}var G;!function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED",e[e.INTERRUPTED=3]="INTERRUPTED"}(G||(G={}));class K{constructor(e,t,n){this.currentState=G.PENDING,this.eventEmitter=e,this.deferred=n,this.ruleList=t,this.onEvent=this.onEvent.bind(this);for(let n of t.getEventNames())e.addEventListener(n,this.onEvent)}static async createInstance(e,t){let n,r=await x.create();if(0===t.length)throw new TypeError;return n=1===t.length?B.createInstance(t):V.createInstance(t),new K(e,n,r)}getPromise(){return this.deferred.promise}getCurrentState(){return this.currentState}interrupt(){!function(e){if(e!==G.PENDING)throw new D}(this.currentState),this.unbindEventListeners(),this.deferred.reject(new M)}onEvent(e,t){let n=this.ruleList.getSuitableRule(t,e);if(null!==n)if(this.unbindEventListeners(),n instanceof q){let r=n.getExceptionCallback(),i=null===r?new j(e,n):r(e,t,n);this.deferred.reject(i),this.setState(G.REJECTED)}else this.deferred.resolve(new j(e,n)),this.setState(G.RESOLVED)}setState(e){this.currentState=e}unbindEventListeners(){for(let e of this.ruleList.getEventNames())this.eventEmitter.removeEventListener(e,this.onEvent)}}class z{constructor(e,t=y.ASYNC){this.eventTargetCallbackList=void 0,this.eventListenerList={},this.defaultListenerMode=t,void 0!==e&&(e.fireEvent=(e,t)=>this.fireEvent(e,t),e.addFireCallback=(e,t)=>this.addFireCallback(e,t),e.removeFireCallback=(e,t)=>{this.removeFireCallback(e,t)},e.fireCallbackList=(e,t,n)=>{this.fireCallbackList(e,t,n)})}addEventListener(e,t,n){if(!(t instanceof Function))throw new Error("Invalid argument");this.eventListenerList.hasOwnProperty(e)||(this.eventListenerList[e]=[]);let r={mode:this.defaultListenerMode,priority:0};n&&(void 0!==n.mode&&(r.mode=n.mode),void 0!==n.priority&&(r.priority=n.priority));let i={callback:t,configuration:r};return this.eventListenerList[e].push(i),this.eventListenerList[e].sort(J),this}removeEventListener(e,t){if(!this.eventListenerList.hasOwnProperty(e))return!1;let n=this.eventListenerList[e];if(0===n.length)return!1;let r=0;for(;r<n.length&&n[r].callback!==t;)r++;return r!==n.length&&(n.splice(r,1),!0)}clearEventListeners(){return this.eventListenerList={},!0}countListeners(e){return Object.keys(this.eventListenerList).length}createEventFilter(e){return K.createInstance(this,e)}addFireCallback(e,t){this.eventTargetCallbackList||(this.eventTargetCallbackList=new Map);let n=this.eventTargetCallbackList.get(e);n||(n=new Set,this.eventTargetCallbackList.set(e,n)),n.add(t)}removeFireCallback(e,t){if(!this.eventTargetCallbackList)return;let n=this.eventTargetCallbackList.get(e);n&&(n.delete(t),0==n.size&&this.eventTargetCallbackList.delete(e),0===this.eventTargetCallbackList.size&&delete this.eventTargetCallbackList)}fireCallbackList(e,t,n){if(!this.eventTargetCallbackList)return;let r=this.eventTargetCallbackList.get(e);if(r)for(let e of r)e(t,n)}fireEvent(e,t){_.QZ.getLogger("Event","TCEventTarget").info("event ("+this.constructor.name+"): ",e,t),this.eventListenerList[e]&&function(e,t,n,r){for(let i of t)i.configuration.mode&y.SYNC?i.callback.call(e,r,n):window.setTimeout((()=>i.callback.call(e,r,n)),0)}(this,this.eventListenerList[e],e,t)}}function J(e,t){return(e.configuration.mode&y.SYSTEM)>(t.configuration.mode&y.SYSTEM)?-1:(e.configuration.mode&y.SYSTEM)<(t.configuration.mode&y.SYSTEM)?1:e.configuration.priority===t.configuration.priority?0:e.configuration.priority>t.configuration.priority?-1:1}var Q,X=n(58012);X.c;!function(e){e[e.OK=0]="OK",e[e.WAIT_DESTRUCTION=1]="WAIT_DESTRUCTION",e[e.DESTRUCTED=2]="DESTRUCTED"}(Q||(Q={}));X.c;var $=n(33121),Z=n(31728);const ee=[{frameSize:2073600,k:2.4},{frameSize:921600,k:2.1},{frameSize:230400,k:1.8},{frameSize:57600,k:1.5}];class te{sourceSimulcastConfigList;constructor(){this.sourceSimulcastConfigList=new Map}static fromBitrateList(e,t){let n=new te;if(!t){for(let t of e){let e=n.makeOneLayerConfig(t);n.addSimulcastConfig(t.sourceType,e)}return n}for(let t of e){n.sortLayerListByFrameSize(t),t.layerList.length>3&&(t.layerList=t.layerList.slice(t.layerList.length-3));let e=[];for(let r=0;r<t.layerList.length;r++){let i=t.layerList[r],s=t.layerList[r+1],a=n.getBitrateCoefficientByFrameSize(i.frameSize),o={layerId:String(r),active:!0,numTemporalLayers:2,dimensionConfiguration:{idealFs:i.frameSize,maxFs:1.3*i.frameSize,minFs:s?1.3*s.frameSize:0,maxHeight:8192,maxWidth:8192},bitrateConfiguration:{maxBitrate:i.maxBitrate*a,idealBitrate:i.maxBitrate,minBitrate:i.minBitrate},frameRateConfiguration:{maxFrameRate:i.framerate,minFrameRate:i.framerate,idealFrameRate:i.framerate}};r===t.layerList.length-1&&(o.bitrateConfiguration.maxBitrate=i.maxBitrate<t.minBitrate?i.maxBitrate:t.minBitrate),e.push(o)}n.checkTotalBitrate(e,t.totalBitrate),n.addSimulcastConfig(t.sourceType,new ne(!0,e))}return n}addSimulcastConfig(e,t){this.sourceSimulcastConfigList.set(e,t)}getSimulcastConfigBySourceType(e){return this.sourceSimulcastConfigList.get(e)??null}makeOneLayerConfig(e){let t=e.maxFrameSize,n=e.minBitrate,r=[],i=new ne(!1,r),s=null;for(let r of e.layerList)if(!(r.maxBitrate>n||r.frameSize>t)){s=r;break}if(!s&&e.layerList.length>0&&(s=e.layerList[e.layerList.length-1],s.frameSize=s.frameSize>t?t:s.frameSize,s.maxBitrate=s.maxBitrate>n?n:s.maxBitrate),!s)return i;let a=this.getBitrateCoefficientByFrameSize(s.frameSize);return r.push({active:!0,numTemporalLayers:2,layerId:void 0,frameRateConfiguration:{maxFrameRate:s.framerate,idealFrameRate:s.framerate,minFrameRate:s.framerate},bitrateConfiguration:{maxBitrate:s.maxBitrate*a,minBitrate:s.minBitrate,idealBitrate:s.maxBitrate},dimensionConfiguration:{maxFs:s.frameSize,idealFs:s.frameSize,minFs:0,maxHeight:8192,maxWidth:8192}}),i}sortLayerListByFrameSize(e){for(let t=0;t<e.layerList.length-1;t++)for(let t=0;t<e.layerList.length-1;t++)if(e.layerList[t].frameSize<e.layerList[t+1].frameSize){let n=e.layerList[t];e.layerList[t]=e.layerList[t+1],e.layerList[t+1]=n}}getBitrateCoefficientByFrameSize(e){for(let t=0;t<ee.length;t++){let n=ee[t];if(!(e<n.frameSize))return n.k}return 1}checkTotalBitrate(e,t){let n=0,r=0;for(let t of e)t.active&&(n+=t.bitrateConfiguration.maxBitrate,r+=t.bitrateConfiguration.maxBitrate-t.bitrateConfiguration.minBitrate);let i=n-t;if(!(i<0)){if(i>r)for(let r of e)if(r.active&&(n-=r.bitrateConfiguration.maxBitrate,r.active=!1,n<t))return;this.decreaseBitrateForLayers(e,i)}}decreaseBitrateForLayers(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(!r.active)continue;let i=r.bitrateConfiguration.maxBitrate-r.bitrateConfiguration.minBitrate>t?r.bitrateConfiguration.maxBitrate-t:r.bitrateConfiguration.minBitrate;if(t-=r.bitrateConfiguration.maxBitrate-i,r.bitrateConfiguration.maxBitrate=i,t<0)return}}}class ne{isEnabled;layers;constructor(e,t){this.isEnabled=e,this.layers=t}get enabled(){return this.isEnabled}get layerList(){return this.layers}}class re extends z{constructor(e,t="default",n=!1){super(),this.handler=e,this.label=t;let r=new E;r.onIceCandidate=(e,t,n)=>{this.fireEvent("remoteIceCandidate",{iceCandidate:{candidateString:e,mId:t,mLineIndex:n}})},r.onSessionDescription=(e,t)=>{let n=new RTCSessionDescription({type:e,sdp:t}),r=new Z.A(Z.A.TYPE.SDP,n);this.fireEvent("remoteCapabilities",{capabilities:r})},r.onRestrictBitrate=e=>{let t=te.fromBitrateList(e,n);this.fireEvent("restrictBitrate",t)},e.addSignalingListener(r)}getId(){return this.label}getRemoteCapabilities(){throw"Not implement(getRemoteCapabilities)"}getRemoteIceCandidateList(){throw"Not implement(getRemoteCapabilities)"}sendLocalCapabilities(e){return this.handler.sendSessionDescription(e.capabilities),Promise.resolve()}sendLocalIceCandidate(e){return this.handler.sendIceCandidate($.Zo.fromEntity(e)),Promise.resolve()}stop(){throw"Not implement(stop)"}restartIce(){throw"Not implement(restartIce)"}}var ie,se=n(74344),ae=(n(9214),n(79986),n(50660)),oe=n(2004);class ce extends ae.O{messagePort;messageAsyncQueue;constructor(e){super(),this.messagePort=e,this.onOriginalPortMessage=this.onOriginalPortMessage.bind(this),this.messagePort.onmessage=this.onOriginalPortMessage,this.messageAsyncQueue=new Map}async sendCommand(e,t,n={}){let r={command:e,value:t},i=await oe.cY.create();return this.messagePort.postMessage(r,n),this.messageAsyncQueue.set(e,i),i.promise}answerCommand(e,t,n={}){let r={command:e,value:t};this.messagePort.postMessage(r,n)}onOriginalPortMessage(e){let t=this.messageAsyncQueue.get(e.data.command);t?t.resolve(e.data.value):this.emitEvent(e.data.command,e.data.value)}}!function(e){e[e.MAIN=0]="MAIN",e[e.WORKER=1]="WORKER"}(ie||(ie={}));class le extends ae.O{messagePort;originalWorkletNode;constructor(e,t){super(),this.originalWorkletNode=new AudioWorkletNode(e,"TCAudioWorkletProcessor",t),this.messagePort=new ce(this.originalWorkletNode.port),this.onAudioInfo=this.onAudioInfo.bind(this),this.messagePort.addEventListener("onAudioInfo",this.onAudioInfo)}get node(){return this.originalWorkletNode}static async createInstance(e,t,n){return t.audioWorklet.addModule(e).then((()=>new le(t,n))).catch((e=>{throw console.error(e),e}))}destruct(){this.messagePort.sendCommand("stop",!1),this.messagePort.removeEventListener("onAudioInfo",this.onAudioInfo)}setDenoiseStatus(e){return this.messagePort.sendCommand("setDenoiseStatus",e)}setBufferSize(e){return this.messagePort.sendCommand("setBufferSize",e)}setSampleBuffer(e){return this.messagePort.sendCommand("setSampleBuffer",e)}onAudioInfo(e){this.emitEvent("audioInfo",e)}}var ue,de,he=n(82770),fe=n(35247);class ge extends ae.O{scriptProcessor;static wasmInitialized=!1;audioProcessingStruct;sampleBuffer;lastHasVoice=!1;lastCallbackTime=-1;interval;constructor(e){super(),this.scriptProcessor=e,this.audioProcessingStruct=he.Pw.new(!1),this.sampleBuffer=(new fe.nQ).setBufferSize(1e3).setEqualizer(new fe.wz).setPlaybackMode(fe.I8.SMOOTH).build(),this.onAudioProcess=this.onAudioProcess.bind(this),this.scriptProcessor.addEventListener("audioprocess",this.onAudioProcess),this.interval=setInterval((()=>{-1!==this.lastCallbackTime&&(this.scriptProcessor.context.currentTime-this.lastCallbackTime<1e3||(clearInterval(this.interval),this.emitEvent("needReinit",null)))}),2e3)}static async createInstance(e,t){return ge.wasmInitialized?new ge(e):(0,he.Ay)(t).then((()=>(ge.wasmInitialized=!0,new ge(e))))}get node(){return this.scriptProcessor}setBufferSize(e){return this.sampleBuffer.setBufferSize(e)}destruct(){clearInterval(this.interval),this.scriptProcessor.removeEventListener("audioprocess",this.onAudioProcess),this.audioProcessingStruct.free()}onAudioProcess(e){return this.lastCallbackTime=this.scriptProcessor.context.currentTime,this.process(e.inputBuffer.getChannelData(0),e.outputBuffer.getChannelData(0),{})}process(e,t,n){let r=this.audioProcessingStruct.get_audio_info(e);if(this.sampleBuffer?this.sampleBuffer.pushSamples(this.scriptProcessor.context.sampleRate,this.lastHasVoice,e,t):t.set(e),0!==r.samples_processed){let e={samples_processed:r.samples_processed,voice_levels:r.voice_levels,volume_levels:r.volume_levels};this.emitEvent("audioInfo",e);let t=0;for(let e of r.voice_levels)t+=e;this.lastHasVoice=t/r.voice_levels.length>.6}r.free()}}!function(e){e[e.DISABLED=0]="DISABLED",e[e.RECORDING=1]="RECORDING",e[e.PAUSED=2]="PAUSED"}(ue||(ue={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CAMERA=1]="CAMERA",e[e.DESKTOP=2]="DESKTOP",e[e.APPLICATION=3]="APPLICATION",e[e.IMAGE=4]="IMAGE",e[e.VIDEOFILE=5]="VIDEOFILE"}(de||(de={}));var pe=n(26518);function me(e,t,n,r,c,l,u,E,S,I,v,R){const N=this,O=15e3;let y,_,k,D,M,U,x=null,F=me.CONFERENCE_STATE.WAIT_JOIN,B=me.PEER_CONNECTION_CLOSE_REASON.END_CONFERENCE,V=!1,W=null,Y=null,j=null,H=!1,q=!1,G=1,K=0,z=!1,J=!1,Q=!1,X=!1,$=!1,Z=null,ee=null,te=new Te(((e,t)=>{if(null!==W&&(null!==e&&W.mediaTransceiver.removeTrackById(e.id),null!==t)){let e=new w.A(t);W.mediaTransceiver.addTrack(e)}}),((e,t)=>{let n=1e3*(57600/te.audioContext.sampleRate).toFixed(1);D.sendVolumeLevels(e,t,n)})),ne=!0,ie=!0;function ae(){clearTimeout(x),function(){if(F!==me.CONFERENCE_STATE.WAIT_JOIN)return;Object.freeze(this),F=me.CONFERENCE_STATE.JOINED,u.onCallSuccess.call(N,N),c.setConferenceStarted(N),(0,g.A)().then((e=>{F!==me.CONFERENCE_STATE.WAIT_JOIN&&F!==me.CONFERENCE_STATE.JOINED||(e.addListener(Fe),Be())})),D.sendFakeScreenDevices()}()}function ce(e){u.onCallFail.call(me,t.callId,e)}function le(){if(W=null,V){F===me.CONFERENCE_STATE.JOINED&&u.onDisconnected.call(me,t.callId)}else!function(){switch(B){case me.PEER_CONNECTION_CLOSE_REASON.CONNECTION_TIMEOUT:ce(i.A.REJECT_CAUSE.REJECTED_BY_TIMEOUT);break;case me.PEER_CONNECTION_CLOSE_REASON.CRITICAL_ERROR:ce(i.A.REJECT_CAUSE.CONNECTION_ERROR)}}()}function ue(e){clearTimeout(x),F!==me.CONFERENCE_STATE.JOINED&&V||N.hangUp(),c.removeConference(t.callId),Y&&(c.removeListener(Y),Y=null),D.destruct(),te.destruct(),W&&(B=e,W.disconnect())}function he(e){clearTimeout(x),x=setTimeout((function(){ue(me.PEER_CONNECTION_CLOSE_REASON.CONNECTION_TIMEOUT)}),e)}async function fe(){await async function(){if(W)throw new Error("tcPeerConn not null!");let e=(0,pe.Z)(R),t=new re(k,"default",$),n=await oe.cY.create();async function r(i){t.removeEventListener("restrictBitrate",r);let s=!o.A.browser.isFirefox()||"1"===localStorage.getItem("rtxEnabled"),a=new se.A(e,i,s),c=new P.ke;try{W=await c.create(t,a)}catch(e){console.error(e)}n.resolve()}t.addEventListener("restrictBitrate",r),await n.promise,function(){let e=c.getLocalTracks();for(let t of e){if(c.attachLocalTrackToConference(N,t,ge,(()=>{})))if("audio"===t.kind)te.addTrack(t);else{if(ve(t)){let e=new w.A(t,P.$U.Tg.CAMERA);W.mediaTransceiver.addTrack(e)}let e=c.getDeviceForTrack(t);e&&(D.sendCurrentDevice(e.deviceInfo),D.sendDeviceState(e))}ie?te.changeAudioDelay(0):te.changeAudioDelay(Ee)}Re(),Y=new C.A,Y.onLocalTrackAdded=function(e,t,n){Re();let r=c.getDeviceForTrack(e);if(r&&(D.sendCurrentDevice(r.deviceInfo),D.sendDeviceState(r),"audio"===e.kind&&D.sendMicrophoneVolume(r.deviceInfo.deviceId,50),"video"===e.kind)){let e=n===g.A.SOURCE_TYPE.SYSTEM?de.DESKTOP:de.CAMERA;D.sendVideoSource(e)}if(c.attachLocalTrackToConference(N,e,ge,(()=>{})))if("audio"===e.kind)te.addTrack(e,n===g.A.SOURCE_TYPE.SYSTEM);else if(ve(e)){let t=new w.A(e,n===g.A.SOURCE_TYPE.SYSTEM?P.$U.Tg.DESKTOP_SHARING:P.$U.Tg.CAMERA);W.mediaTransceiver.addTrack(t)}},Y.onLocalTrackRemoved=function(e,t,n){Re(),n?D.sendNoneDevice(n):console.error("device for track",e,"not found!"),"audio"===e.kind?te.removeTrack(e):W.mediaTransceiver.removeTrackById(e.id)},Y.onTrackStateChange=function(e){Re();let t=c.getDeviceForTrack(e);t&&D.sendDeviceState(t)},c.addListener(Y)}(),W.capabilitiesManager.addEventListener("capabilities",(e=>{})),W.iceTransport.iceGatherer.addEventListener("localCandidate",(e=>{})),W.mediaTransceiver.addEventListener("track",Ae),W.addEventListener("connectionStateChange",(()=>{let e=W.connectionState;e!==P.m8.CONNECTION_STATE.CONNECTED||V?e!==P.m8.CONNECTION_STATE.FAILED||V?e!==P.m8.CONNECTION_STATE.CLOSED&&e!==P.m8.CONNECTION_STATE.FAILED||le():ce(i.A.REJECT_CAUSE.CONNECTION_ERROR):(V=!0,ae())}))}(),he(O)}function ge(e,t){return{}}function Ce(e,t){return new d(e,j,n,null,t)}function Se(e,t,n){return new h.A(e,t,n,Ie)}function Ie(e){D.sendCurrentDevice(e)}function ve(e){return"video"===e.kind&&ne||"audio"===e.kind&&ie}function Ae(e){let t,{track:n,streams:r}=e;"video"===n.kind?t=Ce:"audio"===n.kind&&(t=Se),c.addRemoteTrack(n,ge,t,r,N)}function Re(){let t=c.getLocalTracks(),n={};for(let e of t){let t=c.isSystemTrack(e)?"system_"+e.kind:e.kind;n.hasOwnProperty(t)||(n[t]={total:0,enabled:0,muted:0}),n[t].total++,e.enabled&&n[t].enabled++,e.muted&&n[t].muted++}e.sendInternalMessage({method:"localTracksCount",tracks:n})}async function Le(e,n,r){var s;e.lastRejectReason!==i.A.REJECT_CAUSE.JOIN_OK?(s=e.lastRejectReason,ue(),u.onCallFail.call(i.A,t.callId,s)):(!async function(e,t,n){if(_.subType=e.subtype,_.chatId=e.chatId,_.streamId=e.streamConferenceId,_.cid=e.conferenceId,_.ownerTrueConfId=e.owner,_.topic=e.topic,_.type=e.type,t&&t instanceof Array)for(let e of t)switch(e){case"remote:mic_off":H=!0;break;case"remote:cam_off":q=!0}l.set(e.streamConferenceId,_),N.participants=new L(y,E),n&&E.setWebClientUserWaitingStatus(y,n);U=new a(e.cmr_flags);c.addConference(N)}(e,n,r.WRState),G=r.VadVersion??0,J=r.VadSelectorEnabled,z=r.VadParametricEnabled,K=r.RecordingState,Q=r.UseTranslation,X=r.IsTranslator,function(e){let t={},n=localStorage.getItem("overrideSimulcastConfig");if(null!==n)try{t=JSON.parse(n)}catch{console.error("Unable to parse overrideSimulcastConfig!")}t=Object.assign({},e,t),$=t.Enabled}(void 0!==r.Scalability?r.Scalability:{Enabled:!1}),te.setVadEnabledFlag(J||z),await fe(),D.connectToMediaSrv())}function Ne(e,t,n){if(1!==t||!e)return F=me.CONFERENCE_STATE.WAIT_HANGUP,ue(me.PEER_CONNECTION_CLOSE_REASON.CRITICAL_ERROR),ce(i.A.REJECT_CAUSE.CONNECTION_ERROR),void W?.disconnect()}function Oe(e,t){let n=ne;ne=t,ie=e,n!==t&&(t?function(){let e=c.getLocalTracks();for(let t of e)if("video"===t.kind&&c.attachLocalTrackToConference(N,t,ge,(()=>{}))){let e=new w.A(t,P.$U.Tg.CAMERA);W.mediaTransceiver.addTrack(e)}}():function(){let e=c.getConferenceMedia(N).getLocalTracks();for(let t of e)"video"===t.kind&&(c.detachLocalTrackFromConference(N,t),W.mediaTransceiver.removeTrackById(t.id))}()),te.onSenderStatus(e)}function ye(e,n,r,i){let s=F!==me.CONFERENCE_STATE.WAIT_HANGUP;F=me.CONFERENCE_STATE.FINISHED,(0,g.A)().then((e=>e.removeListener(Fe))),V&&(s?u.onRemoteHangUp.call(me,t.callId,n,i):u.onHangUp.call(me,t.callId,n),ue(me.PEER_CONNECTION_CLOSE_REASON.END_CONFERENCE))}function Pe(e){let n=e.deviceType===s.A.TYPE.CAMERA?"video":"audio";c.changeConferenceTracksStatus(t.callId,n,e.state)}function we(e){c.setRemoteDeviceChange(e)}function be(e,t){J=e,z=e,te.setVadEnabledFlag(e||t),u.onVadStateChange.call(me,e)}function _e(e,t){y.streamId===e&&u.onStopContentSharing.call(me,t)}function ke(e,t){K=t,u.onServerRecordingStateChange.call(me,t)}function De(e,t,n){"microphone"===t&&void 0!==n&&(te.setVolume(n),D.sendMicrophoneVolume(e,n))}function Me(e,t){Q&&(Z=t,u.onInterpretingLanguages.call(me,e,t))}function Ue(e,t){Q&&(ee=t,u.onUpdateFlatVolume.call(me,e,t))}this.participants=null,this.roleManager=null,Object.defineProperty(this,"state",{get:()=>F}),Object.defineProperty(this,"id",{get:()=>t.callId}),this.getParams=function(){return y},this.getChatId=()=>y.chatId,this.getId=function(){return y.id},this.getParticipants=function(){return N.participants},this.getPermissions=function(){return U},this.getRecordingState=function(){return K},this.getConnectionInfo=function(){return W.stats.getConnectionInfo()},this.hangUp=function(e=!1){F=me.CONFERENCE_STATE.WAIT_HANGUP,D.sendHangUpRequest(e)},this.getInitialMediaState=function(){return{video:q,audio:H}},this.isVadSelectorSupported=function(){return y.subType===i.A.CONFERENCE_SUBTYPE.ROLE_BASED&&0!==G},this.isVadSelectorEnabled=function(){return this.isVadSelectorSupported()&&J},this.setVadSelectorEnabled=function(e){if(!this.isVadSelectorSupported()&&y.ownerTrueConfId!==r.getTrueconfId())throw new Error("Can't change vad selector");e!==J&&(J=e,D.sendVadStateChange(e))},this.isUseTranslation=function(){return Q},this.isTranslator=function(){return X},this.getInterpretingChannels=function(){return Z},this.getInterpretingFlatVolume=function(){return ee};let xe=!0;const Fe=new b.A;function Be(){(0,g.A)().then((e=>[e.getCameras(),e.getMicrophones(),e.getSpeakers()])).then((([e,t,n])=>{D.sendDeviceList("camera",e),D.sendDeviceList("microphone",t),D.sendDeviceList("speaker",n)}))}Fe.onDevicesListUpdated=Be,function(){D=new p(e,r,t.callId),M=new f,M.onConferenceDeleted=ye,M.onJoinResponse=Le,M.onServerRecordingState=ke,M.onMediaConnection=Ne,M.onMediaFilter=Oe,M.onVadStateChange=be,M.onDeviceState=De,M.onInterpretingChannels=Me,M.onStopContentSharing=_e,M.onUpdateFlatVolume=Ue,D.addSignalingListener(M),j=new m(r,e,v),I.addEventListener("remoteDeviceControl",Pe),I.addEventListener("remoteDeviceChange",we),v>19||E.addEventListener("broadcasterListUpdate",(()=>{let e=E.clientParticipantList.get(_.streamId);if(!e)throw"Participant not found!";let t=c.getConferenceMedia(N);if(xe!==e.isOnPodium)if(xe=e.isOnPodium,xe){te.changeAudioDelay(0);let e=c.getLocalTracks();for(let n of e)if(!t.hasTrack(n)&&c.attachLocalTrackToConference(N,n,ge,(()=>{})))if("audio"===n.kind)te.addTrack(n);else{let e=new w.A(n,P.$U.Tg.CAMERA);W.mediaTransceiver.addTrack(e)}}else{te.changeAudioDelay(Ee);let e=t.getLocalTracks();for(let t of e)c.detachLocalTrackFromConference(N,t),t.kind,W.mediaTransceiver.removeTrackById(t.id)}})),_={cid:t.callId,streamId:"",topic:"",type:i.A.CONFERENCE_TYPE.TCP,subType:i.A.CONFERENCE_SUBTYPE.UNKNOWN},y=new A(_),k=new T(e,r,y),t.canOffering?t.isP2P?he(2e3):D.sendJoinRequest(t.password):he(O)}.call(this)}me.PEER_CONNECTION_CLOSE_REASON={CRITICAL_ERROR:1,CONNECTION_TIMEOUT:2,END_CONFERENCE:3},me.CONFERENCE_STATE={FINISHED:1,WAIT_JOIN:2,JOINED:3,WAIT_HANGUP:4};const Ee=1e3;class Te{constructor(e,t){this.callback=e,this.sendVadsCallback=t,this.vads=[],this.outputVads=[],this.senderEnabled=!1,this.voiceVolumes=[],this.vadEnabled=!1;let n=44100;o.A.browser.isFirefox()?n=void 0:o.A.browser.isSamsungBrowser()&&(n=16e3),this.audioContext=new AudioContext({sampleRate:n}),this.gain=this.audioContext.createGain(),this.dstNode=this.audioContext.createMediaStreamDestination(),this.gain.connect(this.dstNode),this.dstTrack=this.dstNode.stream.getTracks()[0],this.onAudioInfo=this.onAudioInfo.bind(this),this.srcNodeList=new Map,this.trackList=new Set,this.onReinitContextNeeded=this.onReinitContextNeeded.bind(this),this.reinitContextCounter=0,this.audioDelay=Ee,this.onContextStateChanged=this.onContextStateChanged.bind(this),this.audioContext.addEventListener("statechange",this.onContextStateChanged)}createAudioProcessingNode(){this.workletNode||(o.A.browser.isIOS()||o.A.browser.isSafari()||o.A.browser.isSamsungBrowser()?this.workletNode=Ce.then((async e=>{let t=this.audioContext.createScriptProcessor(1024,1,1),n=await ge.createInstance(t,e);return n.addEventListener("audioInfo",this.onAudioInfo),n.addEventListener("needReinit",this.onReinitContextNeeded),n})):this.workletNode=Ce.then((async e=>{let t=await le.createInstance("/webrtc/audioworklet.bundle-5.4.3.10.js",this.audioContext,{processorOptions:{wasmModule:e},outputChannelCount:[1]});return t.addEventListener("audioInfo",this.onAudioInfo),t})))}setVolume(e){let t=2*e/100;this.gain.gain.value=t}async onReinitContextNeeded(){if(3===this.reinitContextCounter)return void console.error("More than 3 reinitialization of AudioContext");++this.reinitContextCounter;let e=[...this.trackList.values()];for(let t of e)this.removeTrack(t);await this.audioContext.close(),this.workletNode=null,this.audioContext=new AudioContext({sampleRate:44100}),this.audioContext.addEventListener("statechange",this.onContextStateChanged),this.gain=this.audioContext.createGain(),this.dstNode=this.audioContext.createMediaStreamDestination(),this.dstTrack=this.dstNode.stream.getTracks()[0],this.vadEnabled&&this.createAudioProcessingNode();for(let t of e)this.addTrack(t);this.vadEnabled?this.workletNode.then((e=>{e.node.connect(this.dstNode),this.gain.connect(e.node),e.setBufferSize(this.senderEnabled?0:Ee)})):this.gain.connect(this.dstNode)}setVadEnabledFlag(e){!0===e&&!1===this.vadEnabled&&(this.createAudioProcessingNode(),this.workletNode.then((e=>{this.rebindAudioNodes(this.dstNode,e.node),e.node.connect(this.dstNode),this.changeAudioDelay(this.audioDelay)}))),!1===e&&!0===this.vadEnabled&&this.workletNode.then((e=>{this.rebindAudioNodes(e.node,this.dstNode),e.node.disconnect(this.dstNode),this.changeAudioDelay(this.audioDelay)})),this.vadEnabled=e}changeAudioDelay(e){this.audioDelay=e,this.vadEnabled&&this.workletNode.then((t=>{t.setBufferSize(e)}))}rebindAudioNodes(e,t){for(let{node:n,isSystem:r}of this.srcNodeList.values())r&&(n.disconnect(e),n.connect(t));this.gain.disconnect(e),this.gain.connect(t)}onSenderStatus(e){this.senderEnabled!==e&&(!1===this.senderEnabled&&!0===e?(this.changeAudioDelay(0),0!==this.trackList.size&&this.callback(null,this.dstTrack)):(this.changeAudioDelay(Ee),0!==this.trackList.size&&this.callback(this.dstTrack,null)),this.senderEnabled=e)}addTrack(e,t=!1){this.trackList.has(e)||this.addToMixer(e,t).then((()=>{this.trackList.add(e),1===this.trackList.size&&this.senderEnabled&&this.callback(null,this.dstTrack)}))}removeTrack(e){this.trackList.delete(e),this.removeFromMixer(e).then((()=>{0===this.trackList.size&&this.callback(this.dstTrack,null)}))}addToMixer(e,t){let n=new MediaStream;n.addTrack(e);let r=this.audioContext.createMediaStreamSource(n);this.srcNodeList.set(e.id,{node:r,isSystem:t});let i=t?this.dstNode:this.gain;return this.vadEnabled?this.workletNode.then((e=>(i=t?e.node:this.gain,r.connect(i),this.audioContext.resume().catch((e=>{console.error("Unable to start audio mixer",e)}))))):(r.connect(i),this.audioContext.resume().catch((e=>{console.error("Unable to start audio mixer",e)})))}removeFromMixer(e){let t=this.srcNodeList.get(e.id);if(t){if(this.srcNodeList.delete(e.id),!this.vadEnabled){let e=t.isSystem?this.dstNode:this.gain;return Promise.resolve(t.node.disconnect(e))}return this.workletNode.then((e=>{let n=t.isSystem?e.node:this.gain;t.node.disconnect(n)}))}}onAudioInfo(e){for(let t of e.volume_levels)this.voiceVolumes.push(t);for(let t of e.voice_levels)this.vads.push(t);if(10===this.outputVads.length){let e=this.calcVoices();this.voiceVolumes=[],this.sendVadsCallback(this.outputVads,e),this.outputVads=[]}if(this.vads.length<12)return;let t=0;for(let e=0;e<12;e++){let e=this.vads.shift()>.6;this.smooth(e)&&++t}this.outputVads.push(t)}onContextStateChanged(){if("interrupted"===this.audioContext.state)return this.audioContext.resume()}overhang=0;numSpeechFrames=0;max_speech_frames_10ms=6;overhead_low_10ms=6;overhead_high_10ms=9;maxSpeechFrames=Math.trunc(48e3*this.max_speech_frames_10ms/48e3+.5);overhangLow=Math.trunc(48e3*this.overhead_low_10ms/48e3+.5);overhangHigh=Math.trunc(48e3*this.overhead_high_10ms/48e3+.5);smooth(e){return e?(this.numSpeechFrames++,this.numSpeechFrames>this.maxSpeechFrames?(this.numSpeechFrames=this.maxSpeechFrames,this.overhang=this.overhangHigh):this.overhang=this.overhangLow):(this.overhang>0&&(e=!0,this.overhang--),this.numSpeechFrames=0),e}calcVoices(){let e=0,t=[],n=Math.floor(this.voiceVolumes.length/10);for(let r=0;r<10;r++){let r=0,i=e+n;for(;e<i;e++){r+=this.voiceVolumes[e]}t.push(Math.trunc(r/n))}return t}destruct(){this.trackList.clear(),this.srcNodeList.clear(),this.audioContext.close(),this.workletNode&&this.workletNode.then((e=>{(o.A.browser.isIOS()||o.A.browser.isSafari())&&e.removeEventListener("needReinit",this.onReinitContextNeeded),e.removeEventListener("audioInfo",this.onAudioInfo),e.destruct()}))}}const Ce=(async()=>(0,he.DE)().catch((e=>{throw console.error(e),e})))()},71583:function(e,t,n){n.d(t,{A:function(){return Ve}});var r=n(89859),i=n(7607);function s(e){var t=new Map,n=new Set,r=new Set,i=new WeakMap,s=!1;Object.defineProperty(this,"id",{get:()=>e}),this.setTrackStatsBuilder=function(e,n){t.get(e).statsBuilder=n},this.setStarted=function(e){s=e},this.isStarted=function(){return s},this.getTrackStatsBuilder=function(e){return t.get(e).statsBuilder},this.getTrackStatsObserver=function(e){if(i.has(e))return i.get(e);let n=t.get(e),r=n.statsBuilder(e,n.isRemote);return i.set(e,r),r},this.setTrackPlayerBuilder=function(e,n){t.get(e).playerBuilder=n},this.getTrackPlayerBuilder=function(e){return t.get(e).playerBuilder},this.addTrack=function(e,i){t.has(e)||(t.set(e,{isRemote:i,broadcast:!1,playerBuilder:null}),(i?n:r).add(e))},this.setTrackBroadcast=function(e,n){t.get(e).broadcast=n},this.getTracksMap=function(){return t},this.getRemoteTracks=function(){return n},this.isRemoteTrack=function(e){return t.get(e).isRemote},this.hasTrack=function(e){return t.has(e)},this.getLocalTracks=function(){return r},this.removeTrack=function(e){let i=t.get(e).isRemote;t.delete(e),i?n.delete(e):r.delete(e)},this.onTrackStateChange=e=>{}}var a=n(35782),o=n(33087),c=n(25502),l=n(22774),u=n(53044),d=n(49387),h=n(31456),f=n(81871);function g(e){const t=this;let n=new Set,i=new Map,f=new Set,g=new Map,p=new Map,m=new Map,E={video:{local:0,remote:0},audio:{local:0,remote:0}},T={},C=[];function S(e,t,n){let r=e.getTracks();for(let i of r)I(i,t,[e],n)}function I(e,t,r,i){let s,a=t?f:n,o=!a.has(e);return o?(a.add(e),s=new Set,p.set(e,s),m.set(e,new Set),E[e.kind][t?"remote":"local"]++):s=p.get(e),function(e,t){for(let n of t)e.add(n)}(s,r),o&&i&&i(e,s),s}function v(e,t,r){(t?f:n).delete(e);let s=p.get(e);i.delete(e),p.delete(e),m.delete(e),E[e.kind][t?"remote":"local"]--,r(e,s)}function A(e){let t=p.get(e);return t||[]}function R(e,t){let n=[];for(let r of e)r.kind===t&&n.push(r);return n}function L(e,t){for(let n of e)n.enabled=t}function N(e){if(!n.has(e.track))return;let i=m.get(e.track);if(i){for(let t of i){let n=T[t];n&&n.onTrackStateChange(e.track)}r.A.runListeners(t,C,"onTrackStateChange",e.track)}}this.getDeviceForTrack=function(e){return g.get(e)},this.addDevice=function(e){if(e instanceof o.A)e=[e];else{if(!(e instanceof c.A))return;e=e.getDevices()}let n=new MediaStream;for(let s of e)n.addTrack(s.track),I(s.track,!1,[n],((e,n)=>{let i=s.type===d.A.TYPE.SCREEN?d.A.SOURCE_TYPE.SYSTEM:d.A.SOURCE_TYPE.USER;g.set(s.track,s),r.A.runListeners(t,C,"onLocalTrackAdded",e,n,i)})),s.type===d.A.TYPE.SCREEN&&s.audioTrack&&(n.addTrack(s.audioTrack),I(s.audioTrack,!1,[n],((e,n)=>{g.set(s.audioTrack,s),i.set(s.audioTrack,d.A.SYSTEM_TRACK_KIND.SCREEN_AUDIO),r.A.runListeners(t,C,"onLocalTrackAdded",s.audioTrack,n,d.A.SOURCE_TYPE.SYSTEM)})))},this.removeDevice=function(e){e instanceof o.A&&(g.delete(e.track),t.removeLocalTrack(e.track,e),e.type===d.A.TYPE.SCREEN&&e.audioTrack&&(g.delete(e.audioTrack),i.delete(e.audioTrack),t.removeLocalTrack(e.audioTrack,e)))},this.addLocalStream=function(e){return!!function(e){return e instanceof MediaStream}(e)&&(S(e,!1,((e,n)=>r.A.runListeners(t,C,"onLocalTrackAdded",e,n,d.A.SOURCE_TYPE.USER))),!0)},this.addLocalStreams=function(e){for(var n of e)t.addLocalStream(n)},this.addLocalTrack=function(e,...n){I(e,!1,n,((e,n)=>r.A.runListeners(t,C,"onLocalTrackAdded",e,n,d.A.SOURCE_TYPE.USER)))},this.removeLocalTrack=function(e,n){v(e,!1,((e,i)=>r.A.runListeners(t,C,"onLocalTrackRemoved",e,i,n)))},this.removeLocalStream=function(e){!function(e,t,n){let r=e.getTracks();for(let e of r)v(e,t,n)}(e,!0,((e,n)=>r.A.runListeners(t,C,"onLocalTrackRemoved",e,n)))},this.hasLocalTracks=function(e){return 0!==function(e,t){if(e)return E[e]&&t&&E[e][t]?t?E[e][t]:E[e].local+E[e].remote:0;return E.audio.local+E.video.local+E.audio.remote+E.video.remote}(e,"local")},this.getLocalTracks=function(){return[...n]},this.getSystemTracks=function(){return[...i.keys()]},this.isSystemTrack=function(e){return i.has(e)},this.setLocalVideoMuted=function(e){L(R(n,"video"),e)},this.setLocalAudioMuted=function(e){L(R(n,"video"),e)},this.createTrackPlayer=function(e,t,n){let r=t.id;if(!T[r])throw"Unknown conference!";let i=T[r];if(!i.hasTrack(e))throw"Track not in a conference!";let s=p.get(e),a=i.getTrackPlayerBuilder(e);if(!a)throw"No builder found!";return a(e,n,s)},this.getTrackStatsObserver=function(e,t){let n=t.id;if(!T[n])throw"Unknown conference!";let r=T[n];if(!r.hasTrack(e))throw"Track not in a conference!";return r.getTrackStatsObserver(e)},e.addRemoteTrack=function(e,n,i,s,a){if(!T[a.id])throw"Unknown conference!";I(e,!0,s);let o=T[a.id];o.addTrack(e,!0),o.setTrackStatsBuilder(e,n),o.setTrackPlayerBuilder(e,i),o.isStarted()&&(r.A.runListeners(t,C,"onRemoteTrackAdded",e,s,a,a),r.A.runListeners(t,C,"onRemoteTrackOnline",e,s,a))},e.setConferenceStarted=function(e){if(!T[e.id])throw"Unknown conference!";let n=T[e.id];n.setStarted(!0);for(let i of n.getRemoteTracks())r.A.runListeners(t,C,"onRemoteTrackAdded",i,A(i),e,e);for(let[i,s]of n.getTracksMap()){let n="on"+(s.isRemote?"Remote":"Local")+"TrackOnline";r.A.runListeners(t,C,n,i,A(i),e)}},e.addRemoteStreams=function(e,n){let i=n.getId();if(!T[i])throw"Unknown conference!";for(let i of e)S(i,!0,(e=>{r.A.runListeners(t,C,"onRemoteTrackAdded",e,A(e),n,n)}))},e.removeRemoteTrack=function(e,n){T[n.id]&&(T[n.id].removeTrack(e),r.A.runListeners(t,C,"onRemoteTrackRemoved",e,A(e),n,n),p.remove(e))},e.attachLocalTrackToConference=function(e,t,r,i,s=!1){var a=e.id;if(!T[a]||!n.has(t))return!1;var o=T[a],c=m.get(t);return o.addTrack(t,!1),o.setTrackStatsBuilder(t,r),o.setTrackPlayerBuilder(t,i),c.has(a)||c.add(a),!0},e.detachLocalTrackFromConference=function(e,t){let r=e.id;if(!T[r]||!n.has(t))return!1;let i=T[r],s=m.get(t);return i.removeTrack(t),s.has(r)&&s.delete(r),!0},e.getConferenceMedia=function(e){return T[e.id]},e.addConference=function(e,t){if(!T[e.id]){var n=new s(e.id);T[e.id]=n}return T[e.id]},e.removeConference=function(t){if(T[t.id]){T[t.id].setStarted(!1);var n=T[t.id].getRemoteTracks();for(let r of n)e.removeRemoteTrack(r,t);delete T[t.id]}},e.changeConferenceTracksStatus=function(e,t,r){for(let e of n)if(e.kind===t)if(g.has(e)){let t=g.get(e);r?t.resume():t.pause()}else e.enabled=r},e.setRemoteDeviceChange=function(e){if("none"!==e.deviceId&&""!==e.deviceId){let n=new h.A(e);r.A.runListeners(t,C,"onRemoteDeviceChange",n)}else r.A.runListeners(t,C,"onRemoteDeviceDisabled",e.kind)},e.getTrackStreams=A,this.addListener=function(e){r.A.addListener(a.A,C,e)},this.removeListener=function(e){r.A.removeListener(C,e)},function(){Object.assign(e,t),d.A.isSupported()&&function(){let e=l.A.getInstance(),t=new u.A;t.onDeviceMuted=N,t.onDeviceUnmuted=N,e.addDeviceListener(t)}()}.call(this)}var p=n(96315);function m(){}m.prototype=Object.create(g.prototype);n(150),n(58237);class E{constructor(){let e={defaultICEServersLocation:"ru",useDefaultStunServers:!0,useDefaultTurnServers:!0};T.set(this,e)}get defaultICEServersLocation(){return C(this).defaultICEServersLocation}set defaultICEServersLocation(e){if(!e||"string"!=typeof e||2!==e.length)throw"Only ISO 3166-1 Alpha-2 values supported!";C(this).defaultICEServersLocation=e}get useDefaultStunServers(){return C(this).useDefaultStunServers}set useDefaultStunServers(e){C(this).useDefaultStunServers=!!e}get useDefaultTurnServers(){return C(this).useDefaultTurnServers}set useDefaultTurnServers(e){C(this).useDefaultTurnServers=!!e}getIceServers(){let e=C(this);return e.iceServers?[...e.iceServers]:[]}addIceServer(){}removeIceServer(){}}const T=new WeakMap;function C(e){let t=T.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class S{constructor(){this.connectionConfig=new E}}class I extends Map{callbacksList;constructor(e){super(e),this.callbacksList={delete:[],set:[]}}set(e,t){return super.set(e,t),this.runCallbackList(this.callbacksList.set,e),this}delete(e){let t=super.delete(e);return t&&this.runCallbackList(this.callbacksList.delete,e),t}clear(){let e=[...this.keys()];super.clear();for(let t of e)this.runCallbackList(this.callbacksList.delete,t)}addEventListener(e,t){this.callbacksList[e].push(t)}runCallbackList(e,t,n){for(let r of e)r.call(this,t,n)}}const v=Symbol("defaultMultiPointConferenceStreamId");class A extends I{static get DEFAULT_CONFERENCE_STREAM_ID(){return v}}var R,L,N,O=n(63119);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ALL=1]="ALL",e[e.ADD=2]="ADD",e[e.DELETE=3]="DELETE",e[e.UPDATE=4]="UPDATE"}(R||(R={})),function(e){e[e.QUERY=0]="QUERY",e[e.ANSWER=1]="ANSWER",e[e.NOTIFY=3]="NOTIFY"}(L||(L={}));class y extends O.A{cid;signalingProtocol;constructor(e,t){let n={};super(n),this.cid=t.CID,this.signalingProtocol=e,function(e,t){let n={eventTarget:t,protocolVersion:e.protocolVersion};e.addMessagesCallback(b,"roleEvent",n),e.addMessagesCallback(_,"sendPartsList",n),e.addMessagesCallback(w,"wrStateChanged",n),e.protocolVersion<23&&e.addMessagesCallback(k,"webrtc",n);e.addMessagesCallback(D,"reqInvite",n),e.addMessagesCallback(P,"pinUser",n),e.addMessagesCallback(M,"listenToChannel",n),e.addMessagesCallback(U,"translateToChannel",n)}(e,n)}sendRoleResponse(e,t,n,r){return this.signalingProtocol.sendMessage({method:"answerRole",UserName:t,role:n,result:r,CID:this.cid})}setWaitingRoomState(e,t,n){const r=Array.isArray(t)?t:[t];return this.signalingProtocol.sendMessage({method:"ChangeWRState",Conference:e.toString(),parts:r,WRState:n,CID:this.cid})}setPinned(e,t,n){return this.signalingProtocol.sendMessage({method:"PinUser",Conference:e.toString(),UserName:t,Type:L.QUERY,Pinned:n,CID:this.cid})}stopContentSharing(e,t){return this.signalingProtocol.sendMessage({method:"StopContentSharing",Conference:e.toString(),UserName:t})}sendRoleRequest(e,t,n){return this.signalingProtocol.sendMessage({method:"queryRole",UserName:t,role:n,CID:this.cid})}takePodium(e){return this.changePodiumState(e,!0)}leavePodium(e){return this.changePodiumState(e,!1)}changePodiumState(e,t){return this.signalingProtocol.sendMessage({method:"takePodium",podium:t,CID:this.cid})}kickParticipant(e,t){return this.signalingProtocol.sendMessage({method:"kick",UserName:t,CID:this.cid})}refreshBroadcasterList(e){return this.signalingProtocol.sendMessage({method:"ManageLayout",func:"Get",CID:this.cid})}sendJoinResponse(e,t,n){return this.signalingProtocol.sendMessage({method:"AnswerReqInvite",UserName:t,accept:n,CID:this.cid})}sendListenToChannel(e,t,n){return this.signalingProtocol.sendMessage({method:"listenToChannel",Username:t,Channel:n,Conference:e.toString(),CID:this.cid})}sendTranslateToChannel(e,t,n){return this.signalingProtocol.sendMessage({method:"translateToChannel",Username:t,Channel:n,Conference:e.toString(),CID:this.cid})}}function P(e,t){t.eventTarget.fireEvent("pinStatusChange",{isPinned:e.Pinned??!1,conferenceStreamId:e.Conference,username:e.UserName,type:e.Type,result:e.Result})}function w(e,t){let{WRState:n,callId:r,parts:i,conferenceStreamId:s}=e;t.eventTarget.fireEvent("waitingRoomStateChanged",{conferenceStreamId:s,WRState:n,parts:r})}function b(e,t){switch(e.type){case N.NOTIFY:t.eventTarget.fireEvent("participantRoleChange",{trueConfId:e.UserName,role:e.role,conferenceStreamId:e.conferenceStreamId,podium:e.podium});break;case N.INQUIRY:t.eventTarget.fireEvent("participantRoleRequest",{trueConfId:e.UserName,role:e.role,conferenceStreamId:e.conferenceStreamId});break;case N.ANSWER:t.eventTarget.fireEvent("participantRoleResponse",{trueConfId:e.UserName,role:e.role,answer:e.result,conferenceStreamId:e.conferenceStreamId})}}function _(e,t){let n="participantList",r=t.protocolVersion>=25&&(e.type===R.ALL||e.type===R.DEFAULT);switch(e.type){case R.ADD:n="participantListAdd";break;case R.DELETE:n="participantListDelete";break;case R.UPDATE:n="participantListUpdate"}if(t.eventTarget.fireEvent(n,{list:e.list,conferenceStreamId:e.conferenceStreamId}),!r)return;let i=[];for(let t of e.list)!0===t.podium&&i.push(t.trueconfId);t.eventTarget.fireEvent("broadcasterListUpdate",{list:i,conferenceStreamId:e.conferenceStreamId})}function k(e,t){"layout"===e.type&&function(e,t){let n=[];for(let t of e.list)n.push(t.id);t.eventTarget.fireEvent("broadcasterListUpdate",{list:n,conferenceStreamId:e.conferenceStreamId})}(e,t)}function D(e,t){t.eventTarget.fireEvent("participantJoinRequest",{trueConfId:e.UserName,displayName:e.displayname,conferenceStreamId:e.conferenceStreamId})}function M(e,t){t.eventTarget.fireEvent("listenToChannel",{channel:e.Channel,conference:e.Conference,username:e.Username,result:e.Result})}function U(e,t){t.eventTarget.fireEvent("translateToChannel",{channel:e.Channel,conference:e.Conference,username:e.Username,result:e.Result})}!function(e){e[e.INQUIRY=0]="INQUIRY",e[e.ANSWER=1]="ANSWER",e[e.CONFIRM=2]="CONFIRM",e[e.NOTIFY=3]="NOTIFY"}(N||(N={}));var x,F,B,V,W=n(62258),Y=n(96638),j=n(86148),H=n(2004),q=n(89767),G=n(5290);class K extends G.m8{constructor(e,t){super("TCParticipantPinException",e,t)}}!function(e){e[e.NONE=0]="NONE",e[e.VAD_SUPPORTED=1]="VAD_SUPPORTED",e[e.PINNED=2]="PINNED",e[e.IN_WR=4]="IN_WR",e[e.TRANSLATOR=8]="TRANSLATOR"}(x||(x={}));class z extends O.A{static get JOIN_REQUEST_TIMEOUT(){return 1e5}static get JOIN_REQUEST_STATUS(){return F}webClientUser;signalingHandler;eventTarget;userList;conferenceEntityList;list;operatorList;participantOnPodiumList;clientParticipantList;participantJoinRequestList;participantJoinRequestTimeoutList;protocolVersion;pinDeferredList=new Map;changeWrDeferredList=new Map;constructor(e,t,n,r,i){let s={};super(s),this.signalingHandler=e,this.eventTarget=s,this.webClientUser=r,this.userList=t,this.conferenceEntityList=n,this.protocolVersion=i,this.clientParticipantList=new Map,this.list=new Map,this.operatorList=new Map,this.participantOnPodiumList=new Map,this.participantJoinRequestList=new Map,this.participantJoinRequestTimeoutList=new Map,n.addEventListener("set",(e=>{return n=e,(t=this).list.set(n,new Map),t.operatorList.set(n,new Set),void t.participantOnPodiumList.set(n,new Map);var t,n})),n.addEventListener("delete",(e=>{return n=e,(t=this).list.delete(n),t.operatorList.delete(n),t.clientParticipantList.delete(n),void t.participantOnPodiumList.delete(n);var t,n}));let a={mode:j.p.SYNC|j.p.SYSTEM};this.signalingHandler.addEventListener("participantList",(e=>function(e,t){let n=e.conferenceEntityList.get(t.conferenceStreamId);if(!n)return;let r=e.list.get(t.conferenceStreamId),i=e.operatorList.get(t.conferenceStreamId),s=function(e,t,n,r,i){let s=new Set;for(let a of i)s.add(a.trueconfId),te(e,t,n,r,a);return s}(e,r,i,n,t.list);(function(e,t,n,r,i){for(let[s,a]of t)i.has(s)||ie(e,t,n,r,s,a)})(e,r,i,n,s),function(e,t,n,r){let i=e.get(r.trueconfId);i?t.has(n)||t.set(n,i.instance):t.delete(n)}(r,e.clientParticipantList,n.streamId,e.webClientUser),se(r,e,t)}(this,e)),a),this.signalingHandler.addEventListener("participantListAdd",(e=>ee(this,e)),a),this.signalingHandler.addEventListener("participantListUpdate",(e=>ee(this,e)),a),this.signalingHandler.addEventListener("participantListDelete",(e=>function(e,t){let n=e.conferenceEntityList.get(t.conferenceStreamId);if(!n)return;let r=e.list.get(t.conferenceStreamId),i=e.operatorList.get(t.conferenceStreamId);for(let s of t.list){let t=r.get(s.trueconfId);t&&ie(e,r,i,n,s.trueconfId,t)}}(this,e)),a),this.signalingHandler.addEventListener("participantRoleChange",(e=>function(e,t){let n=e.conferenceEntityList.get(t.conferenceStreamId);if(!n)return;let r=e.list.get(t.conferenceStreamId),i=r.get(t.trueConfId);void 0===i&&(i=ne(e,r,n,t.trueConfId,x.NONE,void 0,t.role));e.protocolVersion>=22&&i.data.isOnPodium!==t.podium&&(i.data.isOnPodium=t.podium,e.eventTarget.fireEvent("broadcastStatusChange",{participant:i.instance}),e.eventTarget.fireCallbackList(n.streamId,"broadcastStatusChange",{participant:i.instance}))}(this,e)),a),this.signalingHandler.addEventListener("broadcasterListUpdate",(e=>function(e,t){let n=e.conferenceEntityList.get(t.conferenceStreamId);if(!n)return;let r=e.list.get(t.conferenceStreamId),i=e.participantOnPodiumList.get(t.conferenceStreamId),s=new Set;for(let a of t.list){let t=r.get(a);t||(t=ne(e,r,n,a,x.NONE)),t.data.isOnPodium||(t.data.isOnPodium=!0),s.add(a),i.set(a,t)}for(let[e,t]of i)s.has(e)||(t.data.isOnPodium=!1,i.delete(e));let a={list:[...i.keys()]};e.eventTarget.fireEvent("broadcasterListUpdate",a),e.eventTarget.fireCallbackList(n.streamId,"broadcasterListUpdate",a)}(this,e)),a),this.signalingHandler.addEventListener("participantJoinRequest",(e=>function(e,t){let{trueConfId:n,conferenceStreamId:r,displayName:i}=t,s=e.conferenceEntityList.get(r);if(!s)return;let a=e.participantJoinRequestList.get(r);a||(a=new Map,e.participantJoinRequestList.set(r,a));let o=a.get(n);if(o)return void function(e,t,n,r){let i=t.get(r);if(!i)return;i.timestamp=Date.now();let s=t.values(),a=s.next().value;if(t.delete(r),t.set(r,i),a===i){let t=e.participantJoinRequestTimeoutList.get(n);t&&window.clearTimeout(t);let i=s.next();Q(e,n,r,i.done?0:i.value.timestamp)}}(e,a,r,n);let c=Symbol("requestId");o={uid:c,timestamp:Date.now()},a.set(n,o),J(e,r,a);let l={user:e.userList.getUser(n,i),conferenceEntity:s,acceptCallback:()=>Z(e,c,r,n,!0),rejectCallback:()=>Z(e,c,r,n,!1)};e.eventTarget.fireEvent("participantJoinRequest",l),e.eventTarget.fireCallbackList(s.streamId,"participantJoinRequest",l)}(this,e)),a),this.signalingHandler.addEventListener("waitingRoomStateChanged",(e=>function(e,t){let{WRState:n,parts:r,conferenceStreamId:i}=t,s=e.conferenceEntityList.get(t.conferenceStreamId);if(!s)return;let a=e.list.get(i);if(!a)return;for(let i of r){let r=a.get(i);if(!r){r=ne(e,a,s,i,x.NONE,n),e.eventTarget.fireEvent("waitingRoomStatusChange",{participant:r.instance}),e.eventTarget.fireCallbackList(t.conferenceStreamId,"waitingRoomStatusChange",{participant:r.instance});continue}if(r.instance.isInWaitingRoom===n)continue;const o=t.conferenceStreamId.toString();r.data.isInWaitingRoom=n;const c=e.changeWrDeferredList.get(o);c&&(c.resolve(),e.changeWrDeferredList.delete(o)),e.eventTarget.fireEvent("waitingRoomStatusChange",{participant:r.instance}),e.eventTarget.fireCallbackList(t.conferenceStreamId,"waitingRoomStatusChange",{participant:r.instance})}}(this,e)),a),this.signalingHandler.addEventListener("pinStatusChange",(e=>function(e,t){let n=t.conferenceStreamId,r=e.conferenceEntityList.get(n);if(!r)return;let i,s=e.list.get(n);if(!s)return;for(let e of s.values()){if(t.result!==q.$.POSITIVE&&void 0!==t.result)break;if(e.instance.getTrueconfId()===t.username&&e.data.isPinned!==t.isPinned){e.data.isPinned=t.isPinned,i=e.instance;break}}let a=e.pinDeferredList.get(t.username);a&&(!function(e,t,n){if(t.type===L.ANSWER&&t.result!==q.$.POSITIVE)return void n.reject(new K(t.result,"Error during pinning participant"));n.resolve()}(0,t,a),e.pinDeferredList.delete(t.username));if(!i)return;let o={conferenceEntity:r,participant:i,isPinned:t.isPinned};e.eventTarget.fireEvent("pinStatusChange",o),e.eventTarget.fireCallbackList(r.streamId,"pinStatusChange",o)}(this,e)),a),this.signalingHandler.addEventListener("listenToChannel",(e=>function(e,t){const n=t.conference,r=e.conferenceEntityList.get(n);if(!r)return;const i=e.list.get(n);if(!i)return;const s=i.get(t.username);if(!s)return;e.eventTarget.fireCallbackList(r.streamId,"listenToChannel",{participant:s.instance,channel:t.channel,result:t.result})}(this,e)),a),this.signalingHandler.addEventListener("translateToChannel",(e=>function(e,t){const n=t.conference,r=e.conferenceEntityList.get(n);if(!r)return;const i=e.list.get(n);if(!i)return;const s=i.get(t.username);if(!s)return;e.eventTarget.fireCallbackList(r.streamId,"translateToChannel",{participant:s.instance,channel:t.channel,result:t.result})}(this,e)),a)}has(e,t){let n;return!!(n=this.list.get(ae(e)))&&n.has(oe(t))}count(e){let t=this.list.get(ae(e));return t?t.size:0}setWebClientUserWaitingStatus(e,t){let n=this.list.get(ae(e));if(!n)return;let r=n.get(this.webClientUser.trueconfId);if(!r){let r=ne(this,n,e,this.webClientUser.trueconfId,x.NONE,t).instance;return this.fireEvent("waitingRoomStatusChange",{participant:r}),void this.eventTarget.fireCallbackList(ae(e),"waitingRoomStatusChange",{participant:r})}r.instance.isInWaitingRoom!==t&&(this.fireEvent("waitingRoomStatusChange",{participant:r.instance}),this.eventTarget.fireCallbackList(ae(e),"waitingRoomStatusChange",{participant:r.instance}))}getParticipant(e,t){let n=this.getParticipantEntry(e,oe(t));return n?n.instance:void 0}getParticipantEntry(e,t){let n=this.list.get(ae(e));if(n)return n.get(oe(t))}getTrueConfIdList(e){let t=[],n=this.list.get(ae(e));if(!n)return t;for(let e of n.keys())t.push(e);return t}getConferenceParticipantEntryList(e){return this.list.get(ae(e))}getConferenceParticipantList(e){let t=this.getConferenceParticipantEntryList(e);if(!t)return;let n=new Set;for(let e of t.values())n.add(e.instance);return n}kick(e,t){let n=ae(e),r=oe(t),i=this.list.get(n);if(!i)return Promise.resolve(!1);let s=this.clientParticipantList.get(n);return s&&s.role===W.A.PARTICIPANT_ROLE.LEADER&&i.has(r)&&r!==this.webClientUser.trueconfId?this.signalingHandler.kickParticipant(n,r).then((()=>!0)):Promise.resolve(!1)}invite(e,t){throw"Not implemented yet!"}async setPinned(e,t,n){let r=ae(e),i=oe(t),s=this.list.get(r);if(!s)return Promise.reject("No conf part list");let a=this.clientParticipantList.get(r);if(!a||a.role!==W.A.PARTICIPANT_ROLE.LEADER)return Promise.reject("Wrong role or not found participant");if(!s.has(i))return Promise.reject("No participant");let o=await H.cY.create();return this.pinDeferredList.set(i,o),await this.signalingHandler.setPinned(r,i,n).catch((e=>o.reject(e))),o.promise}async setWaitingRoomState(e,t,n){const r=ae(e),i=oe(t);let s=await H.cY.create();return this.changeWrDeferredList.set(r.toString(),s),await this.signalingHandler.setWaitingRoomState(r,i,n).catch((e=>s.reject(e))),s.promise}listenToChannel(e,t){const n=ae(e),r=this.webClientUser.trueconfId;return this.list.get(n)?this.signalingHandler.sendListenToChannel(n,r,t):Promise.reject("No conf part list")}translateToChannel(e,t){const n=ae(e),r=this.webClientUser.trueconfId;return this.list.get(n)?this.signalingHandler.sendTranslateToChannel(n,r,t):Promise.reject("No conf part list")}async stopContentSharing(e,t){let n=ae(e),r=oe(t),i=this.list.get(n);return i&&i.has(r)?this.signalingHandler.stopContentSharing(n,r).then((()=>!0)).catch((()=>!1)):Promise.resolve(!1)}addConferenceParticipantEventCallback(e,t){this.eventTarget.addFireCallback(e.streamId,t)}removeConferenceParticipantEventCallback(e,t){this.eventTarget.removeFireCallback(e.streamId,t)}}function J(e,t,n){if(e.participantJoinRequestTimeoutList.has(t))return;if(n||(n=e.participantJoinRequestList.get(t)),!n)return;let r=n.entries().next();r.done||Q(e,t,r.value[0],r.value[1].timestamp)}function Q(e,t,n,r=0){let i=0!==r?z.JOIN_REQUEST_TIMEOUT-(Date.now()-r):z.JOIN_REQUEST_TIMEOUT;if(i<=0)X(e,t);else{let r=window.setTimeout(X,i,e,t,n);e.participantJoinRequestTimeoutList.set(t,r)}}function X(e,t){let n=e.participantJoinRequestList.get(t);if(!n)return;let r=n.keys().next().value;if(!r)return;$(e,n,t,r);let i=e.conferenceEntityList.get(t);if(i){let t={user:e.userList.getUser(r),conferenceEntity:i,reason:z.JOIN_REQUEST_STATUS.TIMEOUT};e.eventTarget.fireEvent("participantJoinRequestCancel",t),e.eventTarget.fireCallbackList(i.streamId,"participantJoinRequestCancel",t)}}function $(e,t,n,r){let i=t.keys().next().value;if(t.delete(r),0===t.size&&e.participantJoinRequestList.delete(n),i===r){let r=e.participantJoinRequestTimeoutList.get(n);r&&(e.participantJoinRequestTimeoutList.delete(n),window.clearTimeout(r)),J(e,n,t)}}function Z(e,t,n,r,i){if(!e.conferenceEntityList.has(n))return Promise.reject(z.JOIN_REQUEST_STATUS.CONFERENCE_NOT_FOUND);let s=e.participantJoinRequestList.get(n);if(!s)return Promise.reject(z.JOIN_REQUEST_STATUS.REQUEST_NOT_FOUND);let a=s.get(r);return a&&a.uid===t?(e.signalingHandler.sendJoinResponse(n,r,i),$(e,s,n,r),Promise.resolve(z.JOIN_REQUEST_STATUS.OK)):Promise.reject(z.JOIN_REQUEST_STATUS.INVALID_REQUEST)}function ee(e,t){let n=e.conferenceEntityList.get(t.conferenceStreamId);if(!n)return;let r=e.list.get(t.conferenceStreamId),i=e.operatorList.get(t.conferenceStreamId);for(let s of t.list)te(e,r,i,n,s);se(r,e,t)}function te(e,t,n,r,i){let{trueconfId:s,displayname:a,IsOperator:o,role:c,Pinned:l,WRState:u,participantFlags:d}=i,h=t.get(s);h&&h.data.isIncomplete?(h.data.isIncomplete=!1,e.userList.refreshUserDisplayName(s,a)):h||(h=re(e,t,r,s,d,u,c,a,l)),h.data.isOperator!==o&&function(e,t,n,r,i){i?(r.data.isOperator=!0,n.add(r.instance)):(r.data.isOperator=!1,n.delete(r.instance));e.eventTarget.fireEvent("operatorStatusChange",{participant:r.instance}),e.eventTarget.fireCallbackList(t,"operatorStatusChange",{participant:r.instance})}(e,r.streamId,n,h,o),void 0!==i.podium&&h.data.isOnPodium!==i.podium&&(h.data.isOnPodium=i.podium,e.eventTarget.fireEvent("broadcastStatusChange",{participant:h.instance}),e.eventTarget.fireCallbackList(r.streamId,"broadcastStatusChange",{participant:h.instance}));const f=Boolean(d&x.TRANSLATOR);f!==h.data.isTranslator&&(h.data.isTranslator=f)}function ne(e,t,n,r,i,s,a){return re(e,t,n,r,i,s,a)}function re(e,t,n,r,i,s,a,o,c){let l=e.userList.getUserObject(r,o);const u=Boolean(i&x.TRANSLATOR);let d={role:a||W.A.PARTICIPANT_ROLE.COMMON,isIncomplete:void 0===o,isOperator:!1,isOnPodium:!1,isPinned:c??!1,isInWaitingRoom:s||!1,conferenceEntity:n,isTranslator:u||!1},h=new W.A(l,d),f={instance:h,data:d};t.set(r,f);let g={conferenceEntity:n,participant:f.instance};return e.eventTarget.fireEvent("participantJoin",g),e.eventTarget.fireCallbackList(n.streamId,"participantJoin",g),function(e,t,n){let r=e.participantJoinRequestList.get(t.streamId);if(r&&r.get(n.trueconfId)){$(e,r,t.streamId,n.trueconfId);let i={user:n,conferenceEntity:t,reason:z.JOIN_REQUEST_STATUS.ALREADY_IN_CONFERENCE};e.eventTarget.fireEvent("participantJoinRequestCancel",i),e.eventTarget.fireCallbackList(t.streamId,"participantJoinRequestCancel",i)}}(e,n,h),f}function ie(e,t,n,r,i,s){s.data.isOperator&&n.delete(s.instance),t.delete(i),s.data.isOnPodium&&(s.data.isOnPodium=!1,e.eventTarget.fireEvent("broadcastStatusChange",{participant:s.instance}),e.eventTarget.fireCallbackList(r.streamId,"broadcastStatusChange",{participant:s.instance}));let a={conferenceEntity:r,participant:s.instance};e.eventTarget.fireEvent("participantLeft",a),e.eventTarget.fireCallbackList(r.streamId,"participantLeft",a)}function se(e,t,n){for(let r of n.list){let i=e.get(r.trueconfId);if(!i)continue;let s=void 0!==r.WRState&&r.WRState;i.instance.isInWaitingRoom!==s&&(i.data.isInWaitingRoom=s,t.eventTarget.fireEvent("waitingRoomStatusChange",{participant:i.instance}),t.eventTarget.fireCallbackList(n.conferenceStreamId,"waitingRoomStatusChange",{participant:i.instance}))}}function ae(e){if(e.streamId)return e.streamId;if("string"==typeof e||"symbol"==typeof e)return e;throw new Error("Invalid conference!")}function oe(e){return e instanceof Y.A?e.trueconfId:e}!function(e){e[e.OK=0]="OK",e[e.INVALID_REQUEST=1]="INVALID_REQUEST",e[e.ALREADY_IN_CONFERENCE=2]="ALREADY_IN_CONFERENCE",e[e.CONFERENCE_NOT_FOUND=3]="CONFERENCE_NOT_FOUND",e[e.CONFERENCE_ENDED=4]="CONFERENCE_ENDED",e[e.REQUEST_NOT_FOUND=5]="REQUEST_NOT_FOUND",e[e.TIMEOUT=6]="TIMEOUT"}(F||(F={}));class ce extends O.A{static get MAX_ROLE_REQUEST_ANSWER_TIMEOUT(){return 1e5}static get ROLE_ERROR(){return B}signalingHandler;webClientUser;eventTarget;conferenceEntityList;list;roleList;roleRequestList;roleRequestTimeoutAnswerIds;constructor(e,t,n,r){let i={};super(i),this.signalingHandler=e,this.webClientUser=r,this.conferenceEntityList=n,this.eventTarget=i,this.list=t,this.roleList=new Map,this.roleRequestList=new Map,this.roleRequestTimeoutAnswerIds=new Map,n.addEventListener("set",(e=>{return n=e,(t=this).roleList.set(n,new Map),void t.roleRequestList.set(n,new Map);var t,n})),n.addEventListener("delete",(e=>{return n=e,(t=this).roleList.delete(n),void t.roleRequestList.delete(n);var t,n})),t.addEventListener("participantLeft",(e=>function(e,t){Ee("onParticipantLeft",null,arguments),le(e,e.roleList.get(t.conferenceEntity.streamId),t.participant,t.participant.role,null);let n=e.roleRequestList.get(t.conferenceEntity.streamId);if(!n)return;let r=n.get(t.participant.trueconfId);if(!r)return;pe(e,t.conferenceEntity.streamId,t.participant.trueconfId)}(this,e))),t.addEventListener("participantJoin",(e=>function(e,t){Ee("onParticipantJoin",null,arguments);let n=t.conferenceEntity.streamId;le(e,e.roleList.get(n),t.participant,null,t.participant.role)}(this,e))),e.addEventListener("participantRoleResponse",(e=>function(e,t){Ee("onParticipantRoleResponse",null,arguments);let n,{trueConfId:r,role:i,answer:s,conferenceStreamId:a}=t,o=e.conferenceEntityList.get(a);if(!o)return;ue(e,o)===W.A.PARTICIPANT_ROLE.LEADER?(Ee("onParticipantRoleResponse","check is another user",arguments),n=r):(Ee("onParticipantRoleResponse","check is me"),n=e.webClientUser.trueconfId);let c=e.roleRequestList.get(a);if(!c)return void Ee("onParticipantRoleResponse","conf not found");let l=c.get(n);if(!l)return void Ee("onParticipantRoleResponse","request not found");let u={requestRole:l.role,role:i,answer:s};window.setTimeout(s===W.A.PARTICIPANT_ROLE_CHANGE_ANSWER.POSITIVE?l.resolve:l.reject,0,u),pe(e,a,n)}(this,e))),e.addEventListener("participantRoleRequest",(e=>function(e,t){Ee("onParticipantRoleRequest",null,arguments);let n=t.trueConfId,r=t.role,i=t.conferenceStreamId,s=e.conferenceEntityList.get(t.conferenceStreamId);if(!s)return;let a=e.list.getParticipantEntry(i,n);if(!a||a.data.role===r)return void Ee("onParticipantRoleRequest","!participantEntry || participantEntry.data.role",arguments);let o=e.roleRequestList.get(i);if(!o)return;let c=o.get(n);c&&(c.reject({requestRole:c.role,role:r,answer:W.A.PARTICIPANT_ROLE_CHANGE_ANSWER.COMMON}),e.eventTarget.fireEvent("roleRequestCancel",{conferenceEntity:s,participant:a.instance,role:c.role}),pe(e,t.conferenceStreamId,t.trueConfId));if(r===W.A.PARTICIPANT_ROLE.LEADER)return Ee("createRoleRequestEntry","auto leader response",arguments),void e.signalingHandler.sendRoleResponse(i,n,r,W.A.PARTICIPANT_ROLE_CHANGE_ANSWER.POSITIVE);if(r!==W.A.PARTICIPANT_ROLE.PODIUM&&r!==W.A.PARTICIPANT_ROLE.REPORTER)return void Ee("createRoleRequestEntry","not supported line",arguments);function l(){Ee("acceptRoleRequest",null),h(W.A.PARTICIPANT_ROLE_CHANGE_ANSWER.POSITIVE,r)}function u(){Ee("rejectRoleRequest",null),h(W.A.PARTICIPANT_ROLE_CHANGE_ANSWER.NEGATIVE,r)}let d=de(i,r,l,u);function h(t,r){Ee("sendResponse",null,arguments);let s=e.roleRequestList.get(i);if(!s)return;let a=s.get(n);s&&a===d?(pe(e,i,n),e.signalingHandler.sendRoleResponse(i,n,r,t)):Ee("sendResponse","its old role request, skip",arguments)}he(e,i,n,d),e.eventTarget.fireEvent("roleRequest",{conferenceEntity:s,participant:a.instance,role:r,acceptCallback:l,rejectCallback:u})}(this,e))),e.addEventListener("participantRoleChange",(e=>function(e,t){Ee("onParticipantRoleChange",null,arguments);let n=e.conferenceEntityList.get(t.conferenceStreamId);if(!n)return;Ee("onParticipantRoleChange","user found, processing...",arguments);let r=e.list.getParticipantEntry(t.conferenceStreamId,t.trueConfId),i=e.roleRequestList.get(t.conferenceStreamId),s=i.get(t.trueConfId);s&&(Ee("onParticipantRoleChange","has role request",arguments),r&&e.eventTarget.fireEvent("roleRequestCancel",{conferenceEntity:n,participant:r.instance,role:s.role}),pe(e,t.conferenceStreamId,t.trueConfId));r&&r.data.role!==t.role&&function(e,t,n,r,i){Ee("onParticipantRoleChange","setNewRole",[r.data.role,i]);let s=r.data.role;le(e,n,r.instance,s,i),r.data.role=i,e.eventTarget.fireEvent("roleChange",{conferenceEntity:t,participant:r.instance,previousRole:s,role:i})}(e,n,e.roleList.get(t.conferenceStreamId),r,t.role)}(this,e)))}hasWithRole(e,t){let n=this.roleList.get(e);if(!n)return!1;let r=n.get(t);return!!r&&r.size>0}canSetRole(e,t,n){return function(e,t,n,r){let i,s=e.list.getParticipantEntry(t,n);if(!s)return B.PARTICIPANT_NOT_FOUND;if(i=e.roleRequestList.get(t.streamId)){if(i.get(n))return B.HAS_ROLE_REQUEST}if(r===W.A.PARTICIPANT_ROLE.REMARK)return B.NOT_SUPPORTED;let a=e.hasWithRole(t.streamId,W.A.PARTICIPANT_ROLE.LEADER);if(ue(e,t)!==W.A.PARTICIPANT_ROLE.LEADER){if(e.webClientUser.trueconfId!==n)return B.ACCESS_DENIED;if(!a&&r!==W.A.PARTICIPANT_ROLE.REMARK&&r!==W.A.PARTICIPANT_ROLE.COMMON)return B.NO_LEADERS}return s.data.isOperator||t.ownerTrueConfId===n?B.ACCESS_DENIED:s.data.role===r?B.NOT_SUPPORTED:B.SUCCESS}(this,e,t instanceof Y.A?t.trueconfId:t,n)}setLeaderRole(e){return this.setRole(e.conferenceEntity,e,W.A.PARTICIPANT_ROLE.LEADER)}setCommonRole(e){return this.setRole(e.conferenceEntity,e,W.A.PARTICIPANT_ROLE.COMMON)}setRemarkRole(e){return this.setRole(e.conferenceEntity,e,W.A.PARTICIPANT_ROLE.REMARK)}setRole(e,t,n){return function(e,t,n,r){let i=e.canSetRole(t,n,r);if(i===B.HAS_ROLE_REQUEST)return function(e,t,n,r){let i=B.HAS_ROLE_REQUEST,s=e.roleRequestList.get(t.streamId);if(!s)return Promise.reject(i);let a=s.get(n);return a&&a.isInboundRequest&&(a.role===W.A.PARTICIPANT_ROLE.REPORTER&&r===W.A.PARTICIPANT_ROLE.PODIUM||a.role===W.A.PARTICIPANT_ROLE.PODIUM&&r===W.A.PARTICIPANT_ROLE.REPORTER||a.role===r)?e.signalingHandler.sendRoleResponse(t.streamId,n,a.role,W.A.PARTICIPANT_ROLE_CHANGE_ANSWER.POSITIVE).then((s=>{if(!a)throw i;pe(e,t.streamId,n);let o=e.list.getParticipantEntry(t,n);return e.eventTarget.fireEvent("roleRequestCancel",{conferenceEntity:t,participant:o.instance,role:r}),{requestRole:a.role,role:s.role,answer:s.result}})):Promise.reject(i)}(e,t,n,r);if(i!==B.SUCCESS)return Promise.reject(i);(r===W.A.PARTICIPANT_ROLE.COMMON||W.A.PARTICIPANT_ROLE.EQUAL)&&(r=3===t.subType?W.A.PARTICIPANT_ROLE.COMMON:W.A.PARTICIPANT_ROLE.EQUAL);return new Promise(((i,s)=>{e.signalingHandler.sendRoleRequest(t.streamId,n,r).then((()=>{let a=de(t.streamId,r,i,s,!1);return he(e,t.streamId,n,a),n}))}))}(this,e,t instanceof Y.A?t.trueconfId:t,n)}setPodiumStatus(e,t){return e.trueconfId===this.webClientUser.trueconfId?function(e,t,n){if(ue(e,t)===W.A.PARTICIPANT_ROLE.LEADER)return e.signalingHandler.changePodiumState(t.streamId,n),Promise.resolve(e.webClientUser.trueconfId);let r=n?W.A.PARTICIPANT_ROLE.PODIUM:W.A.PARTICIPANT_ROLE.COMMON;return e.setRole(t,e.webClientUser.trueconfId,r).then((()=>e.webClientUser.trueconfId))}(this,e.conferenceEntity,t):function(e,t,n,r){let i=r?W.A.PARTICIPANT_ROLE.REPORTER:W.A.PARTICIPANT_ROLE.COMMON;return e.setRole(t,n,i).then((()=>n))}(this,e.conferenceEntity,e.trueconfId,t)}takePodium(e){return this.setPodiumStatus(e,!0)}freePodium(e){return this.setPodiumStatus(e,!1)}getClientRole(e){return ue(this,e)}}function le(e,t,n,r,i){if(null!==r){let e=t.get(r);e&&e.delete(n)}if(null!==i){let e=t.get(i);e||(e=new Set,t.set(i,e)),e.add(n)}}function ue(e,t){let n=e.list.clientParticipantList.get(t.streamId);return n?n.role:3===t.subType?W.A.PARTICIPANT_ROLE.COMMON:W.A.PARTICIPANT_ROLE.EQUAL}function de(e,t,n,r,i=!0){return Ee("createRoleRequestEntry",null,arguments),{role:t,resolve:n,reject:r,conferenceStreamId:e,isInboundRequest:i,timestamp:Date.now()}}function he(e,t,n,r){Ee("addRoleRequest",null,arguments);let i=e.roleRequestList.get(t);i||(i=new Map,e.roleRequestList.set(t,i)),i.set(n,r),1===e.roleRequestList.size&&(Ee("addRoleRequest","startRoleRequestTimeoutAnswer",arguments),fe(e,t,r.timestamp))}function fe(e,t,n){Ee("startRoleRequestTimeoutAnswer",null,arguments);let r=n-Date.now()+ce.MAX_ROLE_REQUEST_ANSWER_TIMEOUT;r<0&&(r=0);let i=window.setTimeout(ge,r,e,t);e.roleRequestTimeoutAnswerIds.set(t,i)}function ge(e,t){Ee("onRoleRequestTimeout",null,arguments);let n=e.roleRequestList.get(t);if(!n)return;let r=n.entries().next();if(r.done)return void Ee("onRoleRequestTimeout","not in a request list");let[i,s]=r.value;if(s.isInboundRequest){e.signalingHandler.sendRoleResponse(s.conferenceStreamId,i,s.role,W.A.PARTICIPANT_ROLE_CHANGE_ANSWER.NEGATIVE);let n=e.conferenceEntityList.get(t);if(n){let t=e.list.getParticipant(n,i);t&&e.eventTarget.fireEvent("roleRequestCancel",{role:s.role,conferenceEntity:n,participant:t})}}else{Ee("onRoleRequestTimeout","isInboundRequest");let e={requestRole:s.role,role:s.role,answer:W.A.PARTICIPANT_ROLE_CHANGE_ANSWER.PARTICIPANT_ABSENT};window.setTimeout(s.reject,0,e)}pe(e,s.conferenceStreamId,i)}function pe(e,t,n){Ee("removeRoleRequest",null,arguments);let r=e.roleRequestList.get(t);if(!r)return;if(!r.has(n))return void Ee("removeRoleRequest","not in a list");let i=r.entries().next().value;if(void 0===i)return void Ee("removeRoleRequest","Request list is empty");let[s]=i;if(s===n){Ee("removeRoleRequest","auto-cancel");let n=e.roleRequestTimeoutAnswerIds.get(t);n&&(window.clearTimeout(n),e.roleRequestTimeoutAnswerIds.delete(t)),window.setTimeout(me,0,e)}r.delete(n)}function me(e,t){let n=e.roleRequestList.get(t);if(!n)return;Ee("checkNeedStartTimeoutAnswer",null);let r=n.entries().next();if(r.done)return;Ee("checkNeedStartTimeoutAnswer","need!");let[,i]=r.value;fe(e,t,i.timestamp)}function Ee(e,t,n){}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.CONFERENCE_NOT_FOUND=1]="CONFERENCE_NOT_FOUND",e[e.PARTICIPANT_NOT_FOUND=2]="PARTICIPANT_NOT_FOUND",e[e.ACCESS_DENIED=3]="ACCESS_DENIED",e[e.NOT_SUPPORTED=4]="NOT_SUPPORTED",e[e.NO_LEADERS=5]="NO_LEADERS",e[e.HAS_ROLE_REQUEST=6]="HAS_ROLE_REQUEST",e[e.HAS_SAME_ROLE_REQUEST=7]="HAS_SAME_ROLE_REQUEST"}(B||(B={}));class Te{protocolVersion;originalSignalingProtocol;messageCallbackList;conferenceEntityList;unconfirmedMessageList;unconfirmedMessageClearTimeoutId;currentConferenceStreamId=A.DEFAULT_CONFERENCE_STREAM_ID;constructor(e,t,n){this.protocolVersion=t,this.originalSignalingProtocol=e,this.conferenceEntityList=n,this.messageCallbackList=new Map,this.unconfirmedMessageList=new Map,this.unconfirmedMessageClearTimeoutId=new Map;let r=e=>this.onSignalingMessage(e);e.addMessagesCallback(r,"roleEvent"),e.addMessagesCallback(r,"deviceStatus"),e.addMessagesCallback(r,"sendPartsList"),e.addMessagesCallback(r,"wrStateChanged"),e.addMessagesCallback(r,"webrtc"),e.addMessagesCallback(r,"reqInvite"),e.addMessagesCallback((e=>this.onPinMessage(e)),"pinUser"),e.addMessagesCallback(r,"listenToChannel"),e.addMessagesCallback(r,"translateToChannel"),e.addMessagesCallback(r,"interpretingChannels"),e.addMessagesCallback(r,"updateFlatVolume"),n.addEventListener("set",(e=>this.onConferenceStreamId(e)))}sendMessage(e){return this.originalSignalingProtocol.sendMessage(e)}addMessagesCallback(e,t,n){let r=this.messageCallbackList.get(t);r||(r=new Set,this.messageCallbackList.set(t,r));let i={callback:e};n&&(i.data=n),r.add(i)}removeMessagesCallback(e,t){let n=this.messageCallbackList.get(t);n&&(this.messageCallbackList.delete(t),0===n.size&&this.messageCallbackList.delete(t))}onConferenceStreamId(e,t){if(this.currentConferenceStreamId===A.DEFAULT_CONFERENCE_STREAM_ID&&!t)return this.onConferenceStreamId(A.DEFAULT_CONFERENCE_STREAM_ID,e);this.currentConferenceStreamId=t||e;let n=this.unconfirmedMessageList.get(e);if(!n)return;let r=this.unconfirmedMessageClearTimeoutId.get(e);r&&(window.clearTimeout(r),this.unconfirmedMessageClearTimeoutId.delete(e));for(let e of n)t&&(e.message.conferenceStreamId=t),this.retransmitMessage(e.message);this.unconfirmedMessageList.delete(e)}onPinMessage(e){this.retransmitMessage(e)}onSignalingMessage(e){if(e.conferenceStreamId=this.currentConferenceStreamId,this.conferenceEntityList.has(e.conferenceStreamId))this.retransmitMessage(e);else{let t=this.unconfirmedMessageList.get(e.conferenceStreamId);t||(t=[],this.unconfirmedMessageList.set(e.conferenceStreamId,t)),t.push({message:e,timestamp:Date.now()}),1===t.length&&this.startUnconfirmedEventClearTimeout(e.conferenceStreamId,15e3)}}startUnconfirmedEventClearTimeout(e,t){let n=window.setTimeout((()=>this.onUnconfirmedEventTimeout(e)),t);this.unconfirmedMessageClearTimeoutId.set(e,n)}onUnconfirmedEventTimeout(e){let t=this.unconfirmedMessageList.get(e);if(!t)return;if(t.shift(),0===t.length)return this.unconfirmedMessageList.delete(e),void this.unconfirmedMessageClearTimeoutId.delete(e);let n=t[0].timestamp-Date.now()+15e3;n<=0?this.onUnconfirmedEventTimeout(e):this.startUnconfirmedEventClearTimeout(e,n)}retransmitMessage(e){let t=this.messageCallbackList.get(e.method);if(t&&0!==t.size)for(let n of t)window.setTimeout((()=>n.callback(e,n.data)),0)}}class Ce extends O.A{signalingProtocol;cid;constructor(e,t){let n={};super(n),this.signalingProtocol=e,this.cid=t,function(e,t){let n={eventTarget:t};e.addMessagesCallback(Se,"deviceStatus",n),e.addMessagesCallback(Ae,"sendPartsList",n),e.originalSignalingProtocol.addMessagesCallback(ve,"setDeviceState",n),e.originalSignalingProtocol.addMessagesCallback(Re,"changeDevice",n),e.originalSignalingProtocol.addCommandMessagesCallback(Ie,"remote",n)}(e,n)}setRemoteDeviceEnabled(e,t,n){let r="remote:"+(t===f.A.TYPE.CAMERA?"cam":"mic")+(n?"_off":"_on");return this.signalingProtocol.originalSignalingProtocol.sendCommandMessage(this.cid,e,r).then((()=>e))}sendDevicesStatus(e){return this.signalingProtocol.sendMessage({method:"DeviceStatus",value:e,CID:this.cid}).then((()=>e))}}function Se(e,t){t.eventTarget.fireEvent("deviceStatus",{status:e.DeviceStatus,trueConfId:e.UserName,conferenceStreamId:e.conferenceStreamId})}function Ie(e,t,n,r){let i=n.substr(0,3),s="on"===n.substr(4),a=f.A.TYPE.UNKNOWN;if("cam"===i)a=f.A.TYPE.CAMERA;else{if("mic"!==i)return;a=f.A.TYPE.MICROPHONE}r.eventTarget.fireEvent("remoteControl",{trueConfId:t,state:s,deviceType:a})}function ve(e,t){let n;switch(e.Type){case"camera":n=f.A.TYPE.CAMERA;break;case"microphone":n=f.A.TYPE.MICROPHONE;break;default:return}t.eventTarget.fireEvent("remoteControl",{trueConfId:"",state:!e.Mute,deviceType:n})}function Ae(e,t){t.eventTarget.fireEvent("deviceStatusList",e)}function Re(e,t){let n;switch(e.Type){case"camera":n="videoinput";break;case"microphone":n="audioinput";break;case"speaker":n="audiooutput";break;default:return}t.eventTarget.fireEvent("remoteDeviceChange",{kind:n,deviceId:e.id,label:e.Name})}class Le{constructor(){throw new TypeError("Illegal constructor")}static isOk(e){return e===Ne.DEVICE_STATUS.OK}static isMuted(e){return e!==Ne.DEVICE_STATUS.OK&&e!==Ne.DEVICE_STATUS.SND_UNKNOWN}static isEnabled(e){return!(e&Ne.DEVICE_STATUS.SND_NOT_CHOSEN||e&Ne.DEVICE_STATUS.SND_NOT_PRESENT)}static createStatus(e,t){return e<<16|t}static getUnknownStatus(){return Le.createStatus(Ne.DEVICE_STATUS.SND_UNKNOWN,Ne.DEVICE_STATUS.SND_UNKNOWN)}static parseVideoDeviceStatus(e){return e>>16}static parseAudioDeviceStatus(e){return 255&e}static parseDeviceStatus(e,t){if(e===f.A.TYPE.CAMERA)return this.parseVideoDeviceStatus(t);if(e===f.A.TYPE.MICROPHONE)return this.parseAudioDeviceStatus(t);throw new Error("Unknown device!")}}class Ne{constructor(e,t,n){Oe.set(this,{deviceList:e,participant:t,deviceType:n})}get participant(){return ye(this).participant}get deviceType(){return ye(this).deviceType}isOk(){let{deviceList:e,deviceType:t}=ye(this);return Le.isOk(e[t])}isMuted(){let{deviceList:e,deviceType:t}=ye(this);return Le.isMuted(e[t])}isEnabled(){let{deviceList:e,deviceType:t}=ye(this);return Le.isEnabled(e[t])}getStatusValue(){let{deviceList:e,deviceType:t}=ye(this);return e[t]}static get DEVICE_STATUS(){return V}}!function(e){e[e.OK=0]="OK",e[e.SND_UNKNOWN=1]="SND_UNKNOWN",e[e.SND_NOT_PRESENT=2]="SND_NOT_PRESENT",e[e.SND_NOT_CHOSEN=4]="SND_NOT_CHOSEN",e[e.SND_NOTWORK=8]="SND_NOTWORK",e[e.SND_PAUSED=16]="SND_PAUSED",e[e.RCV_CONF_RULE_NOT_ALLOW=256]="RCV_CONF_RULE_NOT_ALLOW",e[e.RCV_DECODER_NOTPRESENT=512]="RCV_DECODER_NOTPRESENT",e[e.RCV_TURNED_OF_BY_BAND=1024]="RCV_TURNED_OF_BY_BAND",e[e.RCV_PAUSED=2048]="RCV_PAUSED",e[e.MASK_SN=255]="MASK_SN",e[e.MASK_RCV=65280]="MASK_RCV"}(V||(V={}));const Oe=new WeakMap;function ye(e){let t=Oe.get(e);if(!t)throw new Error("Illegal invocation");return t}class Pe{camera;microphone;participant;constructor(e,t){this.camera=new Ne(e,t,f.A.TYPE.CAMERA),this.microphone=new Ne(e,t,f.A.TYPE.MICROPHONE),this.participant=t}getDeviceStatus(e){return e===f.A.TYPE.CAMERA?this.camera:e===f.A.TYPE.MICROPHONE?this.microphone:null}}const we=[f.A.TYPE.CAMERA,f.A.TYPE.MICROPHONE];class be extends O.A{static get REMOTE_CONTROL_ERROR(){return _e}static get REMOTE_CONTROL_TIMEOUT(){return 5e3}constructor(e,t,n,r){let i={};super(i);let s=new Ce(e,t.CID);Fe.set(this,{eventTarget:i,deviceStatusList:new Map,outgoingRemoteControlRequestList:new Map,clientUser:t,conferenceEntityList:r,participantList:n,signalingHandler:s});let a={mode:j.p.SYNC|j.p.SYSTEM};s.addEventListener("remoteControl",(e=>function(e,t){let{eventTarget:n}=Be(e);n.fireEvent("remoteDeviceControl",{trueConfId:t.trueConfId,state:t.state,deviceType:t.deviceType})}(this,e)),a),s.addEventListener("deviceStatus",(e=>function(e,t){let n=Be(e),r=xe(n.deviceStatusList,t.conferenceStreamId),i=n.outgoingRemoteControlRequestList.get(t.conferenceStreamId);ke(n,r,i,t)}(this,e)),a),s.addEventListener("deviceStatusList",(e=>function(e,t){let n=Be(e),r=xe(n.deviceStatusList,t.conferenceStreamId),i=n.outgoingRemoteControlRequestList.get(t.conferenceStreamId);for(let e of t.list)ke(n,r,i,{trueConfId:e.trueconfId,status:e.DeviceStatus,conferenceStreamId:t.conferenceStreamId})}(this,e)),a),s.addEventListener("remoteDeviceChange",(e=>{this.fireEvent("remoteDeviceChange",e)})),n.addEventListener("participantLeft",(e=>function(e,t){let{deviceStatusList:n,outgoingRemoteControlRequestList:r}=Be(e),i=n.get(t.conferenceEntity.streamId);i&&i.delete(t.participant.trueconfId);let s=r.get(t.conferenceEntity.streamId);s&&s.has(t.participant.trueconfId)&&Ue(s,t.participant.trueconfId,_e.PARTICIPANT_LEAVE)}(this,e)),a),n.addEventListener("participantJoin",(e=>function(e,t){let n=Be(e),r=t.participant.trueconfId,i=t.conferenceEntity.streamId,s=xe(n.deviceStatusList,i);if(s.has(r))return;let a=n.outgoingRemoteControlRequestList.get(i);ke(n,s,a,{trueConfId:r,status:Le.getUnknownStatus(),conferenceStreamId:i})}(this,e)),a),r.addEventListener("set",(e=>function(e,t){let{deviceStatusList:n}=Be(e);n.has(t)||n.set(t,new Map)}(this,e))),r.addEventListener("delete",(e=>function(e,t){let{deviceStatusList:n,outgoingRemoteControlRequestList:r}=Be(e);n.delete(t);let i=r.get(t);if(i)for(let e of i.keys())Ue(i,e,_e.CONFERENCE_FINISHED)}(this,e))),e.originalSignalingProtocol.addInternalMessagesCallback((e=>function(e,t){let n=function(e){let t={audio:Ne.DEVICE_STATUS.SND_NOT_CHOSEN,video:Ne.DEVICE_STATUS.SND_NOT_CHOSEN};for(let n in e.tracks){let r=e.tracks[n];if(t[n]!==Ne.DEVICE_STATUS.OK&&(t[n]=r.enabled?Ne.DEVICE_STATUS.OK:Ne.DEVICE_STATUS.SND_PAUSED,t.audio===Ne.DEVICE_STATUS.OK&&t.video===Ne.DEVICE_STATUS.OK))break}return Le.createStatus(t.video,t.audio)}(t);return Be(e).signalingHandler.sendDevicesStatus(n)}(this,e)),"localTracksCount")}getParticipantDeviceList(e,t){let{deviceStatusList:n}=Be(this),r=n.get(e);if(!r)throw"Conference not found!";let i=r.get(t);if(!i)throw"Participant not found!";return i.deviceListInstance}getParticipantList(e){let{deviceStatusList:t}=Be(this),n=t.get(e);if(!n)throw"Conference not found!";let r=new Set;for(let e of n.values())r.add(e.deviceListInstance);return r}muteDevice(e,t){return Me(this,e,t.participant.trueconfId,t.deviceType,!0)}unmuteDevice(e,t){return Me(this,e,t.participant.trueconfId,t.deviceType,!1)}}var _e;function ke(e,t,n,r){let i=t.get(r.trueConfId);if(i||(i=function(e,t,n){let r=e.participantList.getParticipant(n.conferenceStreamId,n.trueConfId);if(!r)return;let i={[f.A.TYPE.CAMERA]:Le.parseVideoDeviceStatus(n.status),[f.A.TYPE.MICROPHONE]:Le.parseAudioDeviceStatus(n.status)},s={status:i,deviceListInstance:new Pe(i,r)};return t.set(r.trueconfId,s),s}(e,t,r),i))for(let t of we){let s=Le.parseDeviceStatus(t,r.status),a=i.status[t];a!==s&&(i.status[t]=s,De(e.eventTarget,n,i.deviceListInstance.participant,{oldValue:a,currentValue:s,deviceType:t}))}}function De(e,t,n,r){let i=Le.isMuted(r.currentValue);Le.isMuted(r.oldValue)!==i&&e.fireEvent("deviceMutedStateChange",{participant:n,deviceType:r.deviceType,state:i});let s=Le.isEnabled(r.currentValue);if(Le.isEnabled(r.oldValue)!==s&&e.fireEvent("deviceEnabledStateChange",{participant:n,deviceType:r.deviceType,state:s}),t){let e=t.get(n.trueconfId);if(!e)return;if(e.deviceType!==r.deviceType)return;let s=i===e.flag?_e.OK:_e.FAIL;Ue(t,n.trueconfId,s)}}function Me(e,t,n,r,i){let{deviceStatusList:s,participantList:a,clientUser:o,outgoingRemoteControlRequestList:c,signalingHandler:l}=Be(e);if(!a.has(t,n))return Promise.reject(_e.PARTICIPANT_NOT_FOUND);if(0===function(e,t,n,r,i){let s=e.get(t);if(!s)return-1;let a=s.get(n);return a?Le.isEnabled(a.status[r])&&Le.isMuted(a.status[r])!==i?1:0:-1}(s,t,n,r,i))return Promise.reject(_e.INVALID_STATUS);let u=c.get(t);if(u&&u.has(n))return Promise.reject(_e.WAIT_ANSWER);let d=a.clientParticipantList.get(t);return d&&d.role===W.A.PARTICIPANT_ROLE.LEADER?n===o.getTrueconfId()?Promise.resolve():new Promise(((e,s)=>{u||(u=new Map,c.set(t,u));let a=function(e,t){return window.setTimeout((()=>{Ue(t,e,_e.TIMEOUT)}),be.REMOTE_CONTROL_TIMEOUT)}(n,u);return u.set(n,{participantId:n,resolve:e,reject:s,timeoutId:a,flag:i,deviceType:r}),l.setRemoteDeviceEnabled(n,r,i)})):Promise.reject(_e.NOT_HAVE_RIGHTS)}function Ue(e,t,n){let r=e.get(t);r&&(clearTimeout(r.timeoutId),n===_e.OK?r.resolve(r.participantId):r.reject(n),e.delete(r.participantId))}function xe(e,t){let n=e.get(t);return n||(n=new Map,e.set(t,n)),n}!function(e){e[e.OK=0]="OK",e[e.FAIL=1]="FAIL",e[e.PARTICIPANT_NOT_FOUND=2]="PARTICIPANT_NOT_FOUND",e[e.TIMEOUT=3]="TIMEOUT",e[e.INVALID_STATUS=4]="INVALID_STATUS",e[e.WAIT_ANSWER=5]="WAIT_ANSWER",e[e.DEVICE_DISABLED=6]="DEVICE_DISABLED",e[e.NOT_HAVE_RIGHTS=7]="NOT_HAVE_RIGHTS",e[e.CONFERENCE_FINISHED=8]="CONFERENCE_FINISHED",e[e.PARTICIPANT_LEAVE=9]="PARTICIPANT_LEAVE"}(_e||(_e={}));const Fe=new WeakMap;function Be(e){let t=Fe.get(e);if(!t)throw new TypeError("Illegal invocation");return t}function Ve(e,t,n,s,a){let o,c,l=this,u={},d=new A,h=null,f=[],E=null,T=null,C=null,I=null;function v(e){delete u[e],h===e&&(h=null)}Object.defineProperty(this,"deviceManager",{get:()=>I}),Object.defineProperty(this,"participantRoleManager",{get:()=>c}),this.mediaManager=null,this.call=function(i,g){if(!l.isValidCallId(i))return r.A.runListeners(l,f,"onCallFail",i,Ve.REJECT_CAUSE.CONF_NOT_VALID);if(i=i.toLowerCase(),l.isActiveConference(i))throw new Error("Already in conference");if(l.isMultiConferenceCallId(i)){if(null!==h)return void r.A.runListeners(l,f,"onCallFail",i,Ve.REJECT_CAUSE.PARTICIPANT_IS_BUSY);i=i.match(/(?:\\*c\\)?(.+)/i)[1],h=i,function(r,i){let l={callId:r,isP2P:!1,owner:n.getTrueconfId(),canOffering:!0,isIncomingCall:!1,incomingCallParams:null,peerConnectionConfiguration:null,conferenceConfig:C,password:i};u[r]=new p.A(e,l,t,n,T,d,E,o,c,I,s,a)}(i,g)}},this.hangUpAll=function(){for(let e in u)u.hasOwnProperty(e)&&u[e].hangUp()},this.addConferenceListener=function(e){r.A.addListener(i.A,f,e)},this.removeConferenceListener=function(e){r.A.removeListener(f,e)},this.getConferenceListeners=function(){return f},Object.defineProperty(this,"currentConferences",{configurable:!1,get:function(){return Object.assign({},u)}}),this.hasConference=function(){for(let e in u)if(u.hasOwnProperty(e))return!0;return!1},this.isValidCallId=function(e){return("string"==typeof e||e instanceof String==!0)&&0!==e.length},this.isMultiConferenceCallId=function(e){return e.toLowerCase().startsWith("\\c\\")},this.isActiveConference=function(e){if("string"==typeof e)return u.hasOwnProperty(e);if(e instanceof p.A){for(let t in u)if(u.hasOwnProperty(t)&&u[t]===e)return!0;return!1}return!1},function(){T=new m,l.mediaManager=new g(T),E=new i.A,E.onCallSuccess=function(t){let n=t.getParams();e.sendInternalMessage({method:"chat",type:"room",name:n.topic,roomId:n.id,roomType:1,host:n.streamId,participants:t.getParticipants().getTrueConfIdList()}),r.A.runListenersWithArgs(l,f,"onCallSuccess",[t],!1)},E.onCallFail=function(...e){v(e[0]),r.A.runListenersWithArgs(l,f,"onCallFail",e,!1)},E.onHangUp=function(...e){v(e[0]),r.A.runListenersWithArgs(l,f,"onHangUp",e,!1)},E.onRemoteHangUp=function(...e){v(e[0]),r.A.runListenersWithArgs(l,f,"onRemoteHangUp",e.slice(1),!1)},E.onDisconnected=function(...e){r.A.runListenersWithArgs(l,f,"onDisconnected",e,!1)},E.onVadStateChange=function(...e){r.A.runListenersWithArgs(l,f,"onVadStateChange",e,!1)},E.onServerRecordingStateChange=function(...e){r.A.runListenersWithArgs(l,f,"onServerRecordingStateChange",e,!1)},E.onStopContentSharing=function(...e){r.A.runListenersWithArgs(l,f,"onStopContentSharing",e,!1)},E.onInterpretingLanguages=function(...e){r.A.runListenersWithArgs(l,f,"onInterpretingLanguages",e,!1)},E.onUpdateFlatVolume=function(...e){r.A.runListenersWithArgs(l,f,"onUpdateFlatVolume",e,!1)};let a=new Te(e,s,d),u=new y(a,n);o=new z(u,t,d,n,s),c=new ce(u,o,d,n),I=new be(a,n,o,d),C=new S,Object.defineProperty(this,"defaultConfiguration",{get:()=>C})}.call(this)}Ve.REJECT_CAUSE={UNDEFINED_CAUSE:-1,REJECTED_BY_PARTICIPANT:0,CONFERENCE_IS_BUSY:1,PARTICIPANT_IS_BUSY:2,PARTICIPANT_NOT_AVAILABLE_NOW:3,INVALID_CONFERENCE:4,INVALID_PARTICIPANT:5,JOIN_OK:6,REACH_MONEY_LIMIT:7,REJECTED_BY_ACCESS_DENIED:8,REJECTED_BY_LOGOUT:9,REJECTED_BY_RESOURCE_LIMIT:10,REJECTED_BY_LOCAL_RES:11,CONFERENCE_PASSWORD_REQUIRED:12,REJECTED_BY_WRONG_PASSWORD:13,REJECTED_BY_NO_FRIEND:14,REJECTED_BY_BAD_RATING:15,REJECTED_BY_TIMEOUT:16,THIS_IS_CONFERENCE:17,CONF_NOT_FOUND:401,CANT_MAKE_CONF_ID:402,CONF_NOT_VALID:403,CONF_ACCESS_DENIED:405,CONF_NO_MONEY:406,CONF_MAX_PART_NUMBER:407,CONF_NOT_STARTED:408,CONF_EXPIRED:409,CONF_ROUTER_DENIED:410,CONF_LIC_LIMITED:411,CONF_EXISTS:412,VSS_DB_ERROR:1101,VSS_DB_MEM_ERROR:1104,CONNECTION_ERROR:1e4},Ve.CONFERENCE_TYPE={TCP:5,UDP:6},Ve.CONFERENCE_SUBTYPE={UNKNOWN:-1,SYMMETRIC:0,ASYMMETRIC:1,PENDING_ASYMMETRIC:2,ROLE_BASED:3}},89859:function(e,t){const n={runListeners:function(e,t,r){let i=null;if(arguments.length>3){i=[];for(let e=3;e<arguments.length;e++)i.push(arguments[e])}n.runListenersWithArgs(e,t,r,i)},runListenersWithArgs:function(e,t,r,i,s){if(!t||0===t.length){let t="Unknown ("+e.constructor.name+")";return n.browser.isChrome()?console.groupCollapsed("skip: %c"+t+".%c"+r,"color: darkGreen;","color: brown; font-style: italic;"):console.groupCollapsed("skip: "+t+"."+r),void console.groupEnd()}let a=t[Object.keys(t)[0]].constructor.name;n.browser.isChrome()?console.groupCollapsed("run: %c"+a+".%c"+r,"color: darkGreen;","color: brown; font-style: italic;"):console.groupCollapsed("run: "+a+"."+r),console.groupEnd();let o=function(){for(let n of t)n[r].apply(e,i)};!1!==s?setTimeout(o,0):o()},addListener:function(e,t,n){return-1!==t.indexOf(n)||t.push(n),!0},addListenerKeyStorage:function(e,t,r,i){t.hasOwnProperty(r)||(t[r]=[]);try{n.addListener(e,t[r],i)}catch(e){throw 0===t[r].length&&delete t[r],e}return!0},removeListener:function(e,t){let n;return-1!==(n=e.indexOf(t))&&(e.splice(n,1),!0)},removeListenerKeyStorage:function(e,t,r){return!!e.hasOwnProperty(t)&&(!!n.removeListener(e[t],r)&&(0===e[t].length&&delete e[t],!0))},deepFreeze:function(e){let t=Object.getOwnPropertyNames(e);for(let r=0;r<t.length;r++){let i=e[t[r]];"object"==typeof i&&null!==i&&n.deepFreeze(i)}return Object.freeze(e)},clonePrimitiveObject:function(e,t){for(let r in t)t[r]instanceof Object?(e[r]={},n.clonePrimitiveObject(e[r],t[r])):e[r]=t[r];return e}};Object.defineProperty(n,"browser",{value:function(){let e,t=/(Firefox|Chrome|OPR|YaBrowser|Version|Edge)\/(.*?)(?:\s|$)/gi,n={name:"unknown",version:0,isMobile:!1},r=null;for(;null!==(e=t.exec(navigator.userAgent));)r=e;if(r){let e=r[2].split(".");e.toString=function(){return e.join(".")},n.name=r[1].toLowerCase(),"version"===n.name&&(n.name="safari"),n.version=e}let i=/(SamsungBrowser)\/(.*?)(?:\s|$)/gi.exec(navigator.userAgent);if(i){let e=i[2].split(".");e.toString=function(){return e.join(".")},n.name=i[1].toLowerCase(),n.version=e}n.isMobile=/android|iPad|iPhone|iPod/i.test(navigator.userAgent),n.isIOS=/iPad|iPhone|iPod/i.test(navigator.userAgent);let s={};return s.version=n.version,s.isFirefox=function(){return"firefox"===n.name},s.isChrome=function(){return"chrome"===n.name},s.isEdge=function(){return"edge"===n.name},s.isYandexBrowser=function(){return"yabrowser"===n.name},s.isSafari=function(){return"safari"===n.name},s.isOpera=function(){return"opr"===n.name},s.isSamsungBrowser=function(){return"samsungbrowser"===n.name},s.isMobile=function(){return n.isMobile},s.isIOS=function(){return n.isIOS},s}()}),t.A=n},22774:function(e,t,n){n.d(t,{A:function(){return l}});var r=n(89859),i=n(49387),s=n(33087),a=n(25502),o=n(53044),c=n(31456);function l(){if(l.prototype.instance)return l.prototype.instance;const e=this,t=[{width:{exact:1920},height:{exact:1080},frameRate:{exact:30}},{width:{exact:1280},height:{exact:720},frameRate:{exact:30}},{width:{exact:1920},height:{exact:1080},frameRate:{exact:60}},{width:{exact:1280},height:{exact:720},frameRate:{exact:60}},{width:{exact:1920},height:{exact:1080},frameRate:{exact:24}},{width:{exact:1280},height:{exact:720},frameRate:{exact:24}},{width:{exact:960},height:{exact:720},frameRate:{exact:30}},{width:{exact:960},height:{exact:540},frameRate:{exact:30}},{width:{exact:864},height:{exact:480},frameRate:{exact:30}},{width:{exact:640},height:{exact:360},frameRate:{exact:30}},{width:{exact:640},height:{exact:480},frameRate:{exact:30}},{width:{exact:640},height:{exact:360},frameRate:{exact:60}},{width:{exact:640},height:{exact:480},frameRate:{exact:60}},{width:{exact:960},height:{exact:720},frameRate:{exact:24}},{width:{exact:960},height:{exact:540},frameRate:{exact:24}},{width:{exact:864},height:{exact:480},frameRate:{exact:24}},{width:{exact:640},height:{exact:360},frameRate:{exact:24}},{width:{exact:640},height:{exact:480},frameRate:{exact:24}}],n=[{channelCount:1}];let u=[],d=[];function h(e,i,s,a){let o=[!1],c=[!1];if(e){let n=t;o=g(r.A.clonePrimitiveObject([],n),e)}return i&&(c=g(r.A.clonePrimitiveObject([],n),i)),s&&(o=o.push(s)),a&&(c=c.push(a)),f({video:o,audio:c},"getUserMedia")}function f(e,t){return new Promise(((n,r)=>{d.push({constraints:e,rejectCallback:r,resolveCallback:n,captureMethodName:t,retryCount:0}),1===d.length&&p()}))}function g(e,t){if(!t||!t.deviceId)return e;for(let n of e)n.deviceId={exact:t.deviceId};return e}function p(){let e=d[0],t={video:e.constraints.video[e.retryCount],audio:e.constraints.audio[0]};navigator.mediaDevices[e.captureMethodName](t).then((t=>{setTimeout(m,0),e.resolveCallback(t)})).catch((t=>{e.retryCount++,!function(e,t){return t.retryCount<t.constraints.video.length&&e&&("OverconstrainedError"===e.name||"ConstraintNotSatisfiedError"===e.name||"width"===e.constraint||"height"===e.constraint)}(t,e)?(setTimeout(m,0),e.rejectCallback(t)):p()}))}function m(){d.shift(),0!==d.length&&p()}function E(t,...n){r.A.runListenersWithArgs(e,u,t,n,!1)}function T(){const e={mediaSource:"screen",width:{max:1280},height:{max:1280},frameRate:{max:15}};this.getConstraints=function(){return"getDisplayMedia"in navigator.mediaDevices?Promise.resolve({video:!0,audio:!0}):Promise.resolve({video:e})},this.isScreenCapturePluginNeeded=function(){return!1},this.getCaptureMethodName=function(){return"getDisplayMedia"in navigator.mediaDevices?"getDisplayMedia":"getUserMedia"}}function C(){const e=this;let t={};function n(e,n=null){let i=r();return new Promise((function(r,s){t[i]={},t[i].resolve=r,t[i].reject=s,n&&(t[i].timeoutId=setTimeout((()=>{delete t[i],s()}),n)),window.postMessage({id:"trueconf_screen_sharing_extension",type:"request",command:e,token:"userToken",requestId:i},window.location.origin)}))}function r(){let e=Math.floor(Date.now()*Math.random());return t.hasOwnProperty(e)?r():e}function i(e){if(e.origin!==window.location.origin)return;let n=e.data;"object"==typeof n&&"trueconf_screen_sharing_extension"===n.id&&"response"===n.type&&function(e){if(!t.hasOwnProperty(e.requestId))return;let n=t[e.requestId];delete t[e.requestId],n.timeoutId&&clearTimeout(n.timeoutId);e.status?n.resolve(e.message):n.reject()}(n)}this.getConstraints=function(){return this.isScreenCapturePluginNeeded()?e.isPluginInstalled().then((e=>e?n("getMediaConstraints"):Promise.reject())):Promise.resolve({video:{width:{max:1920},height:{max:1080}},audio:!0})},this.isScreenCapturePluginNeeded=function(){return!("getDisplayMedia"in navigator.mediaDevices)},this.getCaptureMethodName=function(){return"getDisplayMedia"in navigator.mediaDevices?"getDisplayMedia":"getUserMedia"},this.isPluginInstalled=function(){return n("isExists",1e3).then((()=>!0)).catch((()=>!1))},window.addEventListener("message",i)}this.screenCapture=new function(){const e=this;let t=null;this.isScreenCaptureSupported=function(){return null!==t},this.isScreenCapturePluginNeeded=function(){return null!==t&&t.isScreenCapturePluginNeeded()},this.isScreenCapturePluginInstalled=function(){return null!==t&&e.isScreenCapturePluginNeeded()?t.isPluginInstalled():Promise.resolve(!1)},this.capture=function(){return t?t.getConstraints().then((e=>f(e,t.getCaptureMethodName()))).then((t=>{let n=function(e){let t={deviceId:"",kind:i.A.TYPE.SCREEN,label:"screen"},n=new c.A(t),r=e.getVideoTracks();if(1!==r.length)throw"Invalid screen capture stream!";let a=new s.A(n,r[0],E),o=e.getAudioTracks();return 0!==o.length&&(a.audioTrack=o[0]),a}(t);return r.A.runListeners(e,u,"onDeviceCaptured",n),n})):Promise.reject()},"getDisplayMedia"in navigator.mediaDevices?t=new C:r.A.browser.isMobile()||(r.A.browser.isFirefox()&&r.A.browser.version[0]>=52?t=new T:r.A.browser.isChrome()&&r.A.browser.version[0]>=53&&(t=new C))},this.captureDevices=function(...t){if(!t.length)return Promise.reject("No devices");let n=function(e){let t=[],n={video:0,audio:0};for(let r of e){let e=r.type===i.A.TYPE.CAMERA?"video":r.type===i.A.TYPE.MICROPHONE?"audio":null;if(null===e)continue;let s=n[e];t[s]||(t[s]={video:null,audio:null}),t[s][e]=r,n[e]++}return t}(t);if(0===n.length)return Promise.reject("Invalid devices");let o=[];function c(t,i,l){n.length<=t?i(new a.A(o)):h(n[t].video,n[t].audio).then((a=>{let d=a.getTracks();for(let i of d){let a=new s.A(n[t][i.kind],i,E);o.push(a),r.A.runListeners(e,u,"onDeviceCaptured",a)}c(++t,i,l)})).catch((e=>l(e)))}return new Promise(((e,t)=>c(0,e,t)))},this.captureDevice=function(t){let n=!1,i=!1;if(t.isCamera()?n=t:t.isMicrophone()&&(i=t),!n&&!i)throw"Invalid device type!";return h(n,i).then((n=>{let i=n.getTracks()[0],a=new s.A(t,i,E);return r.A.runListeners(e,u,"onDeviceCaptured",a),a}))},this.captureFake=function(t){let n=!1,i=!1,a=!1,o=!1;if("videoinput"===t?(a={},n={facingMode:{exact:"user"}}):"audioinput"===t&&(o={},i=!0),!a&&!o)throw"Invalid device type!";return h(a,o,n,i).then((n=>{let i=n.getTracks()[0],a={deviceId:"FAKE_DEVICE_ID",kind:t,label:"fakeDeviceLabel"},o=new c.A(a),l=new s.A(o,i,E);return r.A.runListeners(e,u,"onDeviceCaptured",l),l}))},this.addDeviceListener=function(e){return r.A.addListener(o.A,u,e)},this.removeDeviceListener=function(e){return r.A.removeListener(u,e)},function(){if(!("mediaDevices"in navigator))throw new Error("MediaDevices not supported!");Object.defineProperty(l.prototype,"instance",{value:e})}()}l.getInstance=function(){return new l},l.CAMERA="videoinput",l.MICROPHONE="audioinput",l.SPEAKERS="audiooutput",l.SCREEN="screen"},31456:function(e,t,n){n.d(t,{A:function(){return i}});var r=n(49387);function i(e){Object.defineProperty(this,"label",{get:()=>e.label}),Object.defineProperty(this,"deviceId",{get:()=>e.deviceId}),Object.defineProperty(this,"type",{get:()=>e.kind}),this.isCamera=()=>e.kind===r.A.TYPE.CAMERA,this.isMicrophone=()=>e.kind===r.A.TYPE.MICROPHONE,this.isSpeaker=()=>e.kind===r.A.TYPE.SPEAKER,this.isScreen=()=>e.kind===r.A.TYPE.SCREEN}},49387:function(e,t,n){n.d(t,{A:function(){return c}});var r=n(89859),i=n(11363),s=n(31456),a=n(22774),o=n(53044);function c(){const e=/\s\([0-9a-fA-F]{4}:[0-9a-fA-F]{4}\)$/,t=3e4,n={};if(n[c.TYPE.CAMERA]="onCamerasListUpdated",n[c.TYPE.MICROPHONE]="onMicrophonesListUpdated",n[c.TYPE.SPEAKER]="onSpeakersListUpdated",c.prototype.instancePromise)return c.prototype.instancePromise;if(!("mediaDevices"in navigator))throw new Error("MediaDevices not supported!");let l,u,d=!0,h="ondevicechange"in navigator.mediaDevices&&"addEventListener"in navigator.mediaDevices,f=!1,g={},p=new Set,m=new Map,E=[],T={},C=[];function S(){const e=this;Object.defineProperty(this,"numSpeakers",{get:()=>R(c.TYPE.SPEAKER)}),this.getSpeakers=function(){return e.getList(c.TYPE.SPEAKER)},Object.defineProperty(this,"numMicrophones",{get:()=>R(c.TYPE.MICROPHONE)}),this.getMicrophones=function(){return e.getList(c.TYPE.MICROPHONE)},Object.defineProperty(this,"numCameras",{get:()=>R(c.TYPE.CAMERA)}),this.getCameras=function(){return e.getList(c.TYPE.CAMERA)},this.getList=function(e){return Object.freeze(L(e))},this.addListener=function(e){r.A.addListener(i.A,C,e)},this.removeListener=function(e){r.A.removeListener(C,e)},this.getListeners=function(){return[...C]},this.getDeviceByParams=function(t,n){let r=e.getList(t);for(let e of r)if(e.deviceId===n)return e;return null},Object.freeze(this)}function I(){return navigator.mediaDevices.enumerateDevices().then((i=>{!function(i){let a={},o={},S={};function I(t,n){g[n.kind]||(g[n.kind]={}),g[n.kind][t]?function(t,n){if(0===p.size||!p.has(n))return!1;if(0===t.label.length)return!1;t.kind===c.TYPE.CAMERA?n.label=t.label.replace(e,""):n.label=t.label;let i=m.get(n);p.delete(n),d||r.A.runListeners(l,C,"onDeviceLabelChange",i);return!0}(n,g[n.kind][t])&&(a[n.kind]=!0):(!function(t,n){let i=function(t){let n={};n.deviceId=t.deviceId,n.kind=t.kind;let r=t.label;0!==r.length&&t.kind===c.TYPE.CAMERA&&(r=r.replace(e,""));return n.label=r,n.groupId=t.groupId,n}(n);g[n.kind][t]=i;let a=new s.A(i);m.set(i,a),E.push(a),T[n.kind]||(T[n.kind]=[]);T[n.kind].push(a),0===i.label.length&&p.add(i);d||r.A.runListeners(l,C,"onDeviceConnected",a)}(t,n),a[n.kind]=!0)}for(let e of i){let t=e.deviceId.toLowerCase();o[e.kind]||(o[e.kind]={}),o[e.kind][t]=t,"communications"!==t&&("default"!==t?I(t,e):S[e.kind]=e)}for(let e in S)T[e]&&0!==T[e].length||I("default",S[e]);for(let e in g)if(g.hasOwnProperty(e))for(let t in g[e])g[e].hasOwnProperty(t)&&(o.hasOwnProperty(e)&&o[e].hasOwnProperty(t)||(v(e,t),a[e]=!0));if(function(){if(!h)return;0===p.size||f?0===p.size&&f&&(f=!1,clearTimeout(u)):A(t,!0)}(),d)return;!function(e){let t;for(let i in e){t=!0;let e=n[i],s=Object.freeze(L(i));r.A.runListeners(l,C,e,s)}if(t){let e=Object.freeze(L());r.A.runListeners(l,C,"onDevicesListUpdated",e)}}(a)}(i)}))}function v(e,t){if(!g[e]||!g[e][t])return;let n=g[e][t];delete g[e][t];let i=m.get(n);m.delete(n);let s=E.indexOf(i);E.splice(s,1),s=T[e].indexOf(i),T[e].splice(s,1),0===T[e].length&&delete T[e],p.has(n)&&p.delete(n),d||r.A.runListeners(l,C,"onDeviceDisconnected",i)}function A(e,t){function n(){I().then((()=>{f&&(u=setTimeout(n,e))}))}f=!0,t?u=setTimeout(n,e):n()}function R(e){let t=N(e);return t?t.length:0}function L(e){let t=N(e),n=[];for(let e of t)n.push(e);return n}function N(e){let t=[];return e?T[e]&&(t=T[e]):t=E,t}S.prototype=Object.create(c.prototype);let O=I().then((()=>{!function(){if(0===p.size)return;let e=a.A.getInstance(),t=new o.A;t.onDeviceCaptured=function(){I().then((()=>{0===p.size&&(e.removeDeviceListener(t),e=null,t=null)}))},e.addDeviceListener(t)}(),d=!1,l=new S,h?navigator.mediaDevices.addEventListener("devicechange",I):A(15e3)})).then((()=>l));return Object.defineProperty(c.prototype,"instancePromise",{value:O}),O}c.getInstance=function(){return c()},c.isSupported=function(){return void 0!==navigator.mediaDevices},c.TYPE={SPEAKER:"audiooutput",MICROPHONE:"audioinput",CAMERA:"videoinput",SCREEN:"screen"},c.SOURCE_TYPE={SYSTEM:1,USER:2},c.SYSTEM_TRACK_KIND={UNKNOWN:0,SCREEN_AUDIO:1}},11363:function(e,t,n){n.d(t,{A:function(){return r}});n(31456);function r(){this.onDeviceConnected=function(e){},this.onDeviceDisconnected=function(e){},this.onDeviceLabelChange=function(e){},this.onDevicesListUpdated=function(e){},this.onCamerasListUpdated=function(e){},this.onMicrophonesListUpdated=function(e){},this.onSpeakersListUpdated=function(e){}}},35782:function(e,t,n){n.d(t,{A:function(){return r}});n(31456);function r(){this.onLocalTrackAdded=function(e,t){},this.onLocalTrackRemoved=function(e,t){},this.onRemoteTrackAdded=function(e,t,n,r){},this.onRemoteTrackRemoved=function(e,t,n,r){},this.onRemoteTrackOnline=function(e,t,n){},this.onRemoteTrackOffline=function(e,t,n){},this.onLocalTrackOnline=function(e,t,n){},this.onLocalTrackOffline=function(e,t,n){},this.onTrackStateChange=function(e){},this.onRemoteDeviceChange=function(e){},this.onRemoteDeviceDisabled=function(e){}}},79363:function(e,t,n){function r(){this.onServerRefreshLayout=function(){},this.onLayoutChange=function(e,t,n,r){},this.onParticipantJoined=function(e,t,n,r){},this.onParticipantLeft=function(e){}}n.d(t,{A:function(){return r}})},26876:function(e,t,n){n.d(t,{ChatCore:function(){return V},A:function(){return ee}});var r=n(74343),i=n(71583),s=n(63119);class a{get id(){return c(this).id}get user(){return c(this).user}get currentSlide(){return c(this).currentSlide}constructor(e){o.set(this,e)}}const o=new WeakMap;function c(e){let t=o.get(e);if(!t)throw new TypeError("Illegal invocation");return t}var l=n(96638);class u extends s.A{constructor(e,t){let n={};super(n),e.addEventListener("endSlideshow",(e=>function(e,t){let n=d.get(e);if(!n)return;if(!n.slideshowList.hasOwnProperty(t.from))return;let r=n.slideshowList[t.from];delete n.slideshowList[t.from],n.numSlideshows--,n.eventTargetFriendly.fireEvent("slideshowEnd",{slideshow:r.instance,user:r.data.user})}(this,e))),e.addEventListener("newSlide",(e=>function(e,t){let n,r=d.get(e);if(!r)return;let i=Object.assign({},t.slide);delete i.numSlides,delete i.slideIndex,Object.freeze(i);let s=r.userList.getUser(t.from);if(r.slideshowList.hasOwnProperty(t.from)){let e=r.slideshowList[t.from];e.data.currentSlide=i,n=e.instance}else{let e={id:t.from,user:s,currentSlide:i,slideList:[i]};n=new a(e),r.slideshowList[t.from]={instance:new a(e),data:e},r.eventTargetFriendly.fireEvent("slideshowStart",{slideshow:n,user:s})}r.eventTargetFriendly.fireEvent("newSlide",{slideshow:n,user:s,slide:i})}(this,e))),d.set(this,{eventTargetFriendly:n,slideshowList:{},numSlideshows:0,userList:t})}get numSlideshows(){return h(this).numSlideshows}hasSlideshow(e){return e instanceof l.A?h(this).slideshowList.hasOwnProperty(e.trueconfId):e instanceof a?h(this).slideshowList.hasOwnProperty(e.id):"string"==typeof e&&h(this).slideshowList.hasOwnProperty(e)}getSlideshow(e){let t=null;return e instanceof l.A?t=h(this).slideshowList[e.trueconfId]:"string"==typeof e&&(t=h(this).slideshowList[e]),t?t.instance:null}getSlideshowList(){return Object.values(h(this).slideshowList)}}const d=new WeakMap;function h(e){let t=d.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class f extends s.A{constructor(e){let t={};function n(e,n,r){!function(e,t){t.fireEvent("endSlideshow",{from:e})}(n,t)}super(t),e.addCommandMessagesCallback(((e,n,r)=>function(e,t,n){let r=function(e){let t={},n=e.split(/(\r\n|\n|\r)/);for(let e=0;e<n.length;e++){let r=n[e].indexOf("=");-1!==r&&(t[n[e].substr(0,r)]=n[e].substr(r+1))}return t}(t),i=function(e){return e.URL_PARAM?{url:e.URL_PARAM,type:e.TYPE_PARAM?e.TYPE_PARAM:"jpg",width:e.WIDTH_PARAM?parseInt(e.WIDTH_PARAM):-1,height:e.HEIGHT_PARAM?parseInt(e.HEIGHT_PARAM):-1,size:e.SIZE_PARAM?parseInt(e.SIZE_PARAM):-1,name:e.ABOUT_PARAM?e.ABOUT_PARAM:"",slideIndex:e.SLIDE_N?parseInt(e.SLIDE_N):0,numSlides:e.SLIDE_COUNT?parseInt(e.SLIDE_COUNT):0}:(console.warn("Invalid slide!"),!1)}(r);if(!i)return;n.fireEvent("newSlide",{from:e,slide:i})}(n,r,t)),"SHOW_SLIDE_COMMAND"),e.addCommandMessagesCallback(n,"END_SLIDESHOW_COMMAND"),e.addCommandMessagesCallback(n,"END_SLIDESHOW_COMMAND ")}}var g;!function(e){e[e.COMMON=0]="COMMON",e[e.PARTICIPANT_BUSY=1]="PARTICIPANT_BUSY"}(g||(g={}));var p=n(2004);class m extends s.A{static eventMap={WriteAgain:"recordRequest",OnQuery:"recordRequest",Accept:"acceptRecordRequest",Reject:"rejectRecordRequest",Busy:"participantBusy",OnNotify:"recordingStarted",OffNotify:"recordingStopped"};cid;signalingProtocol;constructor(e,t){super(),this.cid=t,this.signalingProtocol=e,e.addCommandMessagesCallback(((e,t,n)=>this.onPluginCommand(t,n)),"plugin"),e.addCommandMessagesCallback(((e,t,n)=>this.onRecordCommand(t,n)),"VRecord")}sendAcceptRecordQuery(e){let t={to:e,method:"command",CID:this.cid,command:"plugin:Record:Accept"};return this.signalingProtocol.sendMessage(t)}sendRejectRecordQuery(e,t){let n={to:e,method:"command",CID:this.cid,command:""};return t===E.REJECT_CAUSE.PARTICIPANT_BUSY?n.command="VRecord:Busy":n.command="plugin:Record:Reject",this.signalingProtocol.sendMessage(n)}onPluginCommand(e,t){0===t.indexOf("Record:")&&(t=t.slice(7),this.onRecordCommand(e,t))}onRecordCommand(e,t){m.eventMap.hasOwnProperty(t)&&this.fireEvent(m.eventMap[t],{participantId:e})}}class E extends s.A{static DEFAULT_IDLE_TIMEOUT=3e4;signalingHandler;currentRecordingParticipants=new Set;pendingRecordingRequests=new Map;recordingTimeouts=new Map;constructor(e,t){super(),this.signalingHandler=new m(e,t.CID),this.onRecordRequest=this.onRecordRequest.bind(this),this.onRecordingStarted=this.onRecordingStarted.bind(this),this.onRecordingStopped=this.onRecordingStopped.bind(this),this.signalingHandler.addEventListener("recordRequest",this.onRecordRequest),this.signalingHandler.addEventListener("recordingStarted",this.onRecordingStarted),this.signalingHandler.addEventListener("recordingStopped",this.onRecordingStopped)}static get REJECT_CAUSE(){return g}getCurrentRecorders(){return Array.from(this.currentRecordingParticipants)}async onRecordRequest(e){return this.signalingHandler.sendAcceptRecordQuery(e.participantId)}onRecordingStarted(e){this.currentRecordingParticipants.add(e.participantId);const t=this.pendingRecordingRequests.get(e.participantId);void 0!==t&&(this.pendingRecordingRequests.delete(e.participantId),t.resolve()),this.clearRecordingTimeout(e.participantId),this.fireEvent("recordingStarted",{participantId:e.participantId})}onRecordingStopped(e){let t="recordingStopped";this.currentRecordingParticipants.delete(e.participantId),this.pendingRecordingRequests.delete(e.participantId)&&(t="recordingRequestReject"),this.clearRecordingTimeout(e.participantId),this.fireEvent(t,{participantId:e.participantId})}clearRecordingTimeout(e){const t=this.recordingTimeouts.get(e);void 0!==t&&clearTimeout(t)}}const T=/([^:]+)(?::(.*))?/;class C{signalingProtocol;cid;static get MAX_REMOTE_PEER_CHECK_TIME(){return 5e3}constructor(e,t){this.signalingProtocol=e,this.cid=t.CID;let n={callbackList:{},defaultEntrySymbol:Symbol("defaultList"),remotePeerChecklist:{}};A.set(this,n),e.addCommandMessagesCallback(((e,t,n)=>{!function(e,t,n,r){let i=R(e);if("webclient"!==t)return;let s=T.exec(r);if(!s)return;let a,[,o,c]=s;try{a=JSON.parse(c)}catch(e){return}if(!a.method)return;i.callbackList.hasOwnProperty(o)&&i.callbackList[o].hasOwnProperty(a.method)&&function(e,t,n,r,i){window.setTimeout((()=>{for(let s of t)s.call(e,n,i,r)}),0)}(e,i.callbackList[o][a.method],n,o,a)}(this,e,t,n)}),"webclient"),this.addMessageCallback(I,"info","statusResponse"),this.addMessageCallback(S,"info","statusRequest")}addMessageCallback(e,t,n){let r=R(this);r.callbackList.hasOwnProperty(t)||(r.callbackList[t]={});let i=r.callbackList[t];i.hasOwnProperty(n)||(i[n]=[]),i[n].push(e)}sendMessage(e,t,n){let r="webclient:"+t+":";try{r+=JSON.stringify(n)}catch(e){return Promise.reject(e)}let i={method:"command",to:e,command:r,CID:this.cid};return this.signalingProtocol.sendMessage(i)}checkRemotePeerAvailable(e){let t=R(this);return t.remotePeerChecklist.hasOwnProperty(e)?new Promise((n=>{t.remotePeerChecklist[e].resolveCallbackList.push(n)})):function(e,t){return new Promise((n=>{let r=R(e),i=window.setTimeout(v,C.MAX_REMOTE_PEER_CHECK_TIME,e,t);r.remotePeerChecklist[t]={timeoutId:i,resolveCallbackList:[n]},e.sendMessage(t,"info",{method:"statusRequest"}).catch((()=>v(e,t)))}))}(this,e)}}function S(e){return this.sendMessage(e,"info",{method:"statusResponse",version:"2.0",status:!0})}function I(e,t){let n=R(this);if(!n.remotePeerChecklist.hasOwnProperty(e))return;let r=n.remotePeerChecklist[e];delete n.remotePeerChecklist[e];for(let e of r.resolveCallbackList)e(!0)}function v(e,t){let n=R(e);if(!n.remotePeerChecklist.hasOwnProperty(t))return;let r=n.remotePeerChecklist[t];delete n.remotePeerChecklist[t],window.clearTimeout(r.timeoutId);for(let e of r.resolveCallbackList)e(!1)}const A=new WeakMap;function R(e){let t=A.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class L{constructor(e,t,n){N.set(this,{signalingHandler:e,remotePeer:t,initiator:n})}get initiator(){return O(this).initiator}get remotePeer(){return O(this).remotePeer}sendMessage(e){if("string"!=typeof e)throw"Invalid message type!";let t=O(this);return t.signalingHandler.sendTextMessage(t.remotePeer.trueconfId,e)}createDataChannel(e){}}const N=new WeakMap;function O(e){let t=N.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class y extends s.A{signalingProtocol;constructor(e){let t={};super(t),this.signalingProtocol=e,e.addMessageCallback(((e,n)=>function(e,t,n){switch(t.status){case P.REQUEST:n.fireEvent("createRequest",{trueConfId:e});break;case P.ACCEPT:case P.REJECT:n.fireEvent("createResponse",{trueConfId:e,status:t.status===P.ACCEPT})}}(e,n,t)),"dataTransfer","create"),e.addMessageCallback(((e,n)=>function(e,t,n){n.fireEvent("peerMessage",{trueConfId:e,message:t.message})}(e,n,t)),"dataTransfer","message")}sendDataTransferRequest(e){return this.signalingProtocol.sendMessage(e,"dataTransfer",{method:"create",status:P.REQUEST})}sendDataTransferResponse(e,t){return this.signalingProtocol.sendMessage(e,"dataTransfer",{method:"create",status:t?P.ACCEPT:P.REJECT})}sendTextMessage(e,t){return this.signalingProtocol.sendMessage(e,"dataTransfer",{method:"message",message:t})}}var P,w;!function(e){e[e.REQUEST=0]="REQUEST",e[e.ACCEPT=1]="ACCEPT",e[e.REJECT=2]="REJECT"}(P||(P={}));class b extends s.A{static get MAX_DATA_TRANSFER_CREATE_TIMEOUT(){return 3e4}static get CREATE_ERROR(){return w}constructor(e,t,n){let r={};super(r);let i=new y(e);D.set(this,{signalingHandler:i,dataTransferRequestList:{},dataTransferList:{},eventTarget:r,userList:n,webClientUser:t}),i.addEventListener("createRequest",(e=>function(e,t){let n=M(e);n.signalingHandler.sendDataTransferResponse(t.trueConfId,!0).then((()=>{let e=n.userList.getUser(t.trueConfId);_(n,e,e)}))}(this,e))),i.addEventListener("createResponse",(e=>function(e,t){let n=M(e);if(!n.dataTransferRequestList.hasOwnProperty(t.trueConfId))return;let r=n.dataTransferRequestList[t.trueConfId];if(delete n.dataTransferRequestList[t.trueConfId],window.clearTimeout(r.timeoutId),t.status){let i=n.userList.getUser(t.trueConfId),s=_(n,i,n.webClientUser);for(let t of r.resolveCallbackList)t.call(e,s)}else for(let t of r.rejectCallbackList)t.call(e,w.PEER_REJECT)}(this,e))),i.addEventListener("peerMessage",(e=>function(e,t){let{dataTransferList:n,eventTarget:r}=M(e);if(!n[t.trueConfId])return;let i=n[t.trueConfId],s={dataTransfer:i,message:t.message,remotePeer:i.remotePeer};r.fireEvent("message",s)}(this,e)))}async createDataTransfer(e){let{dataTransferList:t,dataTransferRequestList:n,signalingHandler:r}=M(this);if(e instanceof l.A)e=e.trueconfId;else if("string"!=typeof e)return Promise.reject(w.UNKNOWN_ERROR);if(t.hasOwnProperty(e))return Promise.resolve(t[e]);if(n.hasOwnProperty(e))return i=n[e],new Promise(((e,t)=>{i.resolveCallbackList.push(e),i.rejectCallbackList.push(t)}));var i;return await r.signalingProtocol.checkRemotePeerAvailable(e)?function(e,t){let{dataTransferRequestList:n,signalingHandler:r}=M(e),i=window.setTimeout(k,b.MAX_DATA_TRANSFER_CREATE_TIMEOUT,e,t);return new Promise(((e,s)=>(n[t]={timeoutId:i,resolveCallbackList:[e],rejectCallbackList:[s]},r.sendDataTransferRequest(t))))}(this,e):Promise.reject(w.NOT_RESPOND)}canPeerReceiveData(e){return e instanceof l.A&&(e=e.trueconfId),M(this).signalingHandler.signalingProtocol.checkRemotePeerAvailable(e)}}function _(e,t,n){let r=t.trueconfId;if(e.dataTransferList.hasOwnProperty(r))return e.dataTransferList[r];let i=new L(e.signalingHandler,t,n);e.dataTransferList[r]=i;let s={dataTransfer:i,remotePeer:t,initiator:n};return e.eventTarget.fireEvent("open",s),i}function k(e,t){let n=M(e).dataTransferRequestList;if(!n.hasOwnProperty(t))return;let r=n[t];delete n[t];for(let t of r.rejectCallbackList)t.call(e,w.TIMEOUT)}!function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.NOT_RESPOND=1]="NOT_RESPOND",e[e.TIMEOUT=2]="TIMEOUT",e[e.PEER_REJECT=3]="PEER_REJECT"}(w||(w={}));const D=new WeakMap;function M(e){let t=D.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class U extends s.A{constructor(e){let t={};super(t),e.addEventListener("userDisplayNameChange",(e=>t.fireEvent("userDisplayNameChange",e)))}}var x=n(76015),F=n(39391),B=n(42992),V=n(63548),W=n(10462);class Y{promiseRequestQueue=new Map;displayNameCache=new Map;signalingProtocol;callIdFactory=new W.j.v;clientUserCallId;constructor(e,t){this.signalingProtocol=e,this.clientUserCallId=this.callIdFactory.createCallId(t.getTrueconfId()),this.displayNameCache.set(this.clientUserCallId.getIdWithoutInstance(),t.getDisplayName()),this.onDisplayName=this.onDisplayName.bind(this),this.signalingProtocol.addMessagesCallback(this.onDisplayName,"searchAddressBook"),this.onSendPartList=this.onSendPartList.bind(this),this.signalingProtocol.addMessagesCallback(this.onSendPartList,"sendPartsList")}async getDisplayNameById(e){if(-1===e.indexOf("@"))return null;const t=this.displayNameCache.get(e);if(void 0!==t)return t;const n=this.promiseRequestQueue.get(e);if(void 0!==n)return n.promise;const r=this.callIdFactory.createCallId(e);if(this.clientUserCallId.isGuest()&&!r.isGuest())return null;const i=p.cY.createSync();return this.promiseRequestQueue.set(e,i),this.signalingProtocol.sendMessage({method:"SearchAddressBook",callId:e}),i.promise}onDisplayName(e){let t=this.promiseRequestQueue.get(e.callId);void 0!==t&&(this.promiseRequestQueue.delete(e.callId),t.resolve(e.displayName)),this.displayNameCache.set(e.callId,e.displayName)}onSendPartList(e){for(const t of e.list){const e=this.callIdFactory.createCallId(t.trueconfId);this.displayNameCache.set(e.getIdWithoutInstance(),t.displayname)}}}var j=n(66986),H=n(5290),q=n(23067);class G{signalingProtocol;uploadRequestList=new Map;uploader;cid;maxUploadSize;constructor(e,t){this.signalingProtocol=e,this.cid=t;let n=j.I.getInstance();this.uploader=n.getUploader("HTTP"),this.onFileUploadTask=this.onFileUploadTask.bind(this),this.signalingProtocol.addMessagesCallback(this.onFileUploadTask,"createUploadTask"),this.onUploadLimit=this.onUploadLimit.bind(this),this.signalingProtocol.addMessagesCallback(this.onUploadLimit,"fileUploadLimits"),this.maxUploadSize=p.cY.create(),this.signalingProtocol.sendMessage({method:"FileUploadLimits"})}async uploadFile(e){let t=await p.cY.create(),n=e.file.name,r=e.file.size,i=e.file.type,s=crypto.randomUUID();return this.uploadRequestList.set(s,{...e,resolve:t.resolve,reject:t.reject}),this.signalingProtocol.sendMessage({requestId:s,fileName:n,fileSize:r,mimeType:i,method:"createUploadTask"}),t.promise}async getUploadSizeLimit(){return this.maxUploadSize.then((e=>e.promise))}isImage(e){return e.type.toLowerCase().startsWith("image/")}async createPreview(e){if(!this.isImage(e))return null;let t=await this.getLoadedImage(e);if(!t)return null;if(!this.checkNeedCreatePreview(e,t))return null;let n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new H.ZL("No canvas context");let i=t.width>t.height?t.height:t.width;if(0===i)throw new H.nj("Zero side");let s=t.width,a=t.height;const o=48;if(i<o||i>o){let e=o/i;s=Math.round(s*e),a=Math.round(a*e)}let c=24-Math.round(s/2),l=24-Math.round(a/2);n.width=o,n.height=o,r.drawImage(t,c,l,Math.ceil(s),a);let u=await this.getMimeType(),d=await this.canvasToBlob(n,u);return{width:t.width,height:t.height,preview:d}}onUploadLimit(e){this.maxUploadSize.then((t=>t.resolve(e.upload)))}async compressImage(e){if(!this.isImage(e))return null;let t=await this.getLoadedImage(e);if(!t)return null;let n=t.width<t.height?t.height:t.width;if(0===n)return null;if(!this.checkNeedCompressImage(e,n))return e;let r=document.createElement("canvas"),i=r.getContext("2d");if(!i)return null;let s=t.width,a=t.height;if(n>1280){let e=1280/n;s=Math.round(s*e),a=Math.round(a*e)}r.width=s,r.height=a,i.drawImage(t,0,0,s,a);let o=await this.getMimeType();return this.canvasToBlob(r,o).then((e=>new File([e],"",{type:o})))}async getMimeType(){let e="image/webp";return this.canConvertToWebp=await this.checkCanConvertImage(e),this.canConvertToWebp||(e="image/jpeg"),e}checkNeedCompressImage(e,t){return e.size>307200||t>1280||"image/png"!==e.type&&"image/jpeg"!==e.type&&"image/webp"!==e.type}async canvasToBlob(e,t){let n=await p.cY.create();return e.toBlob((async function(e){if(!e)throw new H.ZL("Blob not created from canvas");n.resolve(e)}),t,1),n.promise}checkNeedCreatePreview(e,t){if(e.size>=52428800)return!1;let{width:n,height:r}=t;return!(n/r>=20||r/n>=20)}async getLoadedImage(e){let t=await p.cY.create();if(!this.isImage(e))return t.resolve(null),t.promise;let n=document.createElement("img");return n.src=URL.createObjectURL(e),n.addEventListener("load",(()=>{t.resolve(n)})),n.addEventListener("error",(e=>{t.resolve(null)})),t.promise}async onFileUploadTask(e){let t=this.uploadRequestList.get(e.requestId);if(!t)return;if(t.abortSignal.aborted)return;let n={request_id:e.uploadTaskId,cid:this.cid},r=t.file;if(t.compress){let e=await this.compressImage(r);e?r=e:t.compress=!1}Reflect.set(n,"mime",r.type);let i=t.preview;if(i){let e=await q.o4.fromBlob(i.preview);Reflect.set(n,"width",t.compress?i.width:0),Reflect.set(n,"height",t.compress?i.height:0),Reflect.set(n,"preview",e.toString())}let s=await this.getUploadProcess(r,n);t.abortSignal.addEventListener("abort",(()=>{s.abortAll()})),t.resolve(s)}getUploadProcess(e,t){let n=new j.U(e),r=this.signalingProtocol.connection,i={configRequest:{method:"POST",url:this.createUploadUrl(r),headerList:t,fileName:e.name}};return this.uploader.upload(n,i)}createUploadUrl(e){return(e.secure?"https":"http")+"://"+e.host+":"+e.port+"/bridge/api/client/v1/files"}canConvertToWebp=null;checkCanConvertImage(e,t){if(null!==this.canConvertToWebp&&"image/webp"===e)return Promise.resolve(this.canConvertToWebp);let n=document.createElement("canvas");n.width=1,n.height=1;n.getContext("2d");return new Promise(((r,i)=>{try{n.toBlob((t=>{r(!!t&&t.type===e)}),e,t)}catch(e){r(!1)}}))}}var K=n(66231),z=n(33121),J=n(31262);class Q{internetAddressFactory;configuration;constructor(e){this.internetAddressFactory=new J.M9.uV,this.configuration=e}async getNetworkAdapters(){let e=await p.cY.create(),t=new Map,n=await(new K.aM.gV.gq.h).setRtcConfiguration(this.configuration).build(),r=await(new K.aM.gV.nd).setRtcConfiguration(this.configuration).build(),i=new RTCPeerConnection(this.createRTCPeerConnectionConfiguration(n,r));i.addEventListener("icecandidate",a);let s=this.internetAddressFactory;function a(e){let n=e.candidate;if(!n||!n.candidate)return;let r=z.q0.fromString(n.candidate);if(!r)return;let i,a="relay"===r.type?r.relatedAddress:r.connectionAddress,o=r.networkId;if(!a||!o)return;try{i=s.parseAddress(a)}catch(e){return}let c=t.get(o);c||(c=new X(o,[]),t.set(o,c)),c.addIpAddress(i)}i.addEventListener("icegatheringstatechange",(function n(r){if("complete"!==i.iceGatheringState)return;i.removeEventListener("icegatheringstatechange",n),i.removeEventListener("icecandidate",a),i.close(),e.resolve(t)})),i.createDataChannel("net_info");let o=await i.createOffer();return await i.setLocalDescription(o),e.promise}createRTCPeerConnectionConfiguration(e,t){let n={};return n.iceServers=e.getServersAsWebRTC(),n.iceTransportPolicy=t.getPolicy()===z.G0.RELAY?"relay":"all",n}}class X{adapterId;addresses;constructor(e,t){this.adapterId=e,this.addresses=new Set(t)}getAdapterId(){return this.adapterId}getIpAddresses(){return[...this.addresses.values()]}addIpAddress(e){for(let t of this.addresses.values())if(t[J.ng](e))return;this.addresses.add(e)}}var $=n(74344),Z=n(26518);function ee(e,t,n,s,a,o,c){const l=this;let d=ee.CLIENT_STATE.LOGGED,h=null;this.slideshowManager=null,this.conferenceManager=null,this.conferenceRecording=null,this.settings=null,this.userManager=new U(t),this.fakeAddressBook=new Y(e,n),this.fileManager=new G(e,n.CID),this.networkInfo=null,Object.defineProperty(this,"clientState",{get:()=>d}),this.getAddressBook=function(){return this.fakeAddressBook},this.getFileManager=function(){return this.fileManager},this.getNetworkInformation=function(){if(this.networkInfo)return this.networkInfo;let e=(0,Z.Z)(c),t=new $.A(e,{});return this.networkInfo=new Q(t),this.networkInfo},this.getUser=function(){return n},this.getChatManager=async function(){return null===h&&await async function(){let t=new ReadableStream({start(t){e.addMessagesCallback((e=>{t.enqueue(e)}),"chatV2")}}),r=new WritableStream({write(t){e.sendMessage(t)}}),i=new x.A,s={getWritableStream(){return r},getReadableStream(){return t}},a={getCapabilities:()=>Promise.resolve({minHandlerVersion:0,maxHandlerVersion:65535,exactHandlerVersion:50})};i.addConnection(new F.A(s,a)),await B.bo.createInstance(i).then((async e=>{let t=n.getTrueconfId().substring(0,n.getTrueconfId().lastIndexOf("/"));await V.ChatManager.getInstance(t,e).then((e=>{h=e}))}))}(),h},this.logout=function(){r.A.getInstance().logout(l)},this.disconnect=function(){r.A.getInstance().disconnect(l)},this.getUserId=function(){return n.getId()};let g=new b(new C(e,n));function p(e){d=e}function m(){return e}function T(){return t}this.getDataTransferManager=function(){return g},function(){l.conferenceRecording=new E(e,n),l.conferenceManager=new i.A(e,t,n,o,c),l.slideshowManager=function(){let n=new f(e);return new u(n,t)}(),a.setClientState=p,a.getSignalingProtocol=m,a.getUsersList=T;let r=l.getNetworkInformation();(async function(){!function(t){const n=[];for(const e of t.values()){const t=e.getAdapterId(),r=[];for(const t of e.getIpAddresses()){const e=t.getAddressString(),n=J.M9.U1.IP4?4:6;r.push({address:e,family:n})}n.push({id:t,ipAddressList:r})}e.sendMessage({method:"networkInfo",adapterList:n})}(await r.getNetworkAdapters())}).call(this)}.call(this),Object.freeze(this)}ee.CLIENT_STATE={WAIT_LOGIN:0,LOGGED:1,WAIT_DISCONNECT:2,WAIT_LOGOUT:3,LOGOFF:4,DISCONNECTED:5}},74343:function(e,t,n){n.d(t,{A:function(){return Me}});var r=n(89859),i=n(58237);function s(e){Object.defineProperty(this,"signalingProtocol",{value:e})}function a(){this.onLoginSuccess=function(e,t,n,r){},this.onLoginFail=function(e){},this.onLogoutSuccess=function(e){},this.onAppProperties=function(e){}}var o=function(){function e(e,t){var a=e[0],o=e[1],c=e[2],u=e[3];a=n(a,o,c,u,t[0],7,-680876936),u=n(u,a,o,c,t[1],12,-389564586),c=n(c,u,a,o,t[2],17,606105819),o=n(o,c,u,a,t[3],22,-1044525330),a=n(a,o,c,u,t[4],7,-176418897),u=n(u,a,o,c,t[5],12,1200080426),c=n(c,u,a,o,t[6],17,-1473231341),o=n(o,c,u,a,t[7],22,-45705983),a=n(a,o,c,u,t[8],7,1770035416),u=n(u,a,o,c,t[9],12,-1958414417),c=n(c,u,a,o,t[10],17,-42063),o=n(o,c,u,a,t[11],22,-1990404162),a=n(a,o,c,u,t[12],7,1804603682),u=n(u,a,o,c,t[13],12,-40341101),c=n(c,u,a,o,t[14],17,-1502002290),a=r(a,o=n(o,c,u,a,t[15],22,1236535329),c,u,t[1],5,-165796510),u=r(u,a,o,c,t[6],9,-1069501632),c=r(c,u,a,o,t[11],14,643717713),o=r(o,c,u,a,t[0],20,-373897302),a=r(a,o,c,u,t[5],5,-701558691),u=r(u,a,o,c,t[10],9,38016083),c=r(c,u,a,o,t[15],14,-660478335),o=r(o,c,u,a,t[4],20,-405537848),a=r(a,o,c,u,t[9],5,568446438),u=r(u,a,o,c,t[14],9,-1019803690),c=r(c,u,a,o,t[3],14,-187363961),o=r(o,c,u,a,t[8],20,1163531501),a=r(a,o,c,u,t[13],5,-1444681467),u=r(u,a,o,c,t[2],9,-51403784),c=r(c,u,a,o,t[7],14,1735328473),a=i(a,o=r(o,c,u,a,t[12],20,-1926607734),c,u,t[5],4,-378558),u=i(u,a,o,c,t[8],11,-2022574463),c=i(c,u,a,o,t[11],16,1839030562),o=i(o,c,u,a,t[14],23,-35309556),a=i(a,o,c,u,t[1],4,-1530992060),u=i(u,a,o,c,t[4],11,1272893353),c=i(c,u,a,o,t[7],16,-155497632),o=i(o,c,u,a,t[10],23,-1094730640),a=i(a,o,c,u,t[13],4,681279174),u=i(u,a,o,c,t[0],11,-358537222),c=i(c,u,a,o,t[3],16,-722521979),o=i(o,c,u,a,t[6],23,76029189),a=i(a,o,c,u,t[9],4,-640364487),u=i(u,a,o,c,t[12],11,-421815835),c=i(c,u,a,o,t[15],16,530742520),a=s(a,o=i(o,c,u,a,t[2],23,-995338651),c,u,t[0],6,-198630844),u=s(u,a,o,c,t[7],10,1126891415),c=s(c,u,a,o,t[14],15,-1416354905),o=s(o,c,u,a,t[5],21,-57434055),a=s(a,o,c,u,t[12],6,1700485571),u=s(u,a,o,c,t[3],10,-1894986606),c=s(c,u,a,o,t[10],15,-1051523),o=s(o,c,u,a,t[1],21,-2054922799),a=s(a,o,c,u,t[8],6,1873313359),u=s(u,a,o,c,t[15],10,-30611744),c=s(c,u,a,o,t[6],15,-1560198380),o=s(o,c,u,a,t[13],21,1309151649),a=s(a,o,c,u,t[4],6,-145523070),u=s(u,a,o,c,t[11],10,-1120210379),c=s(c,u,a,o,t[2],15,718787259),o=s(o,c,u,a,t[9],21,-343485551),e[0]=l(a,e[0]),e[1]=l(o,e[1]),e[2]=l(c,e[2]),e[3]=l(u,e[3])}function t(e,t,n,r,i,s){return t=l(l(t,e),l(r,s)),l(t<<i|t>>>32-i,n)}function n(e,n,r,i,s,a,o){return t(n&r|~n&i,e,n,s,a,o)}function r(e,n,r,i,s,a,o){return t(n&i|r&~i,e,n,s,a,o)}function i(e,n,r,i,s,a,o){return t(n^r^i,e,n,s,a,o)}function s(e,n,r,i,s,a,o){return t(r^(n|~i),e,n,s,a,o)}function a(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}var o="0123456789abcdef".split("");function c(e){for(var t="",n=0;n<4;n++)t+=o[e>>8*n+4&15]+o[e>>8*n&15];return t}function l(e,t){return e+t&4294967295}return function(t){return function(e){for(var t=0;t<e.length;t++)e[t]=c(e[t]);return e.join("")}(function(t){var n,r=t.length,i=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=t.length;n+=64)e(i,a(t.substring(n-64,n)));t=t.substring(n-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<t.length;n++)s[n>>2]|=t.charCodeAt(n)<<(n%4<<3);if(s[n>>2]|=128<<(n%4<<3),n>55)for(e(i,s),n=0;n<16;n++)s[n]=0;return s[14]=8*r,e(i,s),i}(t))}}();function c(e){s.call(this,e);var t=this;let n=[];function i(e){e.result===Me.LOGIN_STATE.USER_LOGGEDIN_OK?r.A.runListenersWithArgs(t,n,"onLoginSuccess",[e.CID,e.Key,e.trueconfId,e.displayName,e.Rights]):r.A.runListenersWithArgs(t,n,"onLoginFail",[e.result])}function c(e){r.A.runListenersWithArgs(t,n,"onLogoutSuccess",[e.cause])}function l(e){r.A.runListenersWithArgs(t,n,"onAppProperties",[e])}function u(t){e.sendMessage(t)}this.sendLoginRequest=function(e,t,n,r){let i={AppID:e,method:"loginUser",login:t,chatV2Enabled:!0,browser:navigator.userAgent,version:1};switch(r){case Me.AUTH_TYPE.RAW:i.password=n;break;case Me.AUTH_TYPE.TOKEN:i.md5Password=n;break;case Me.AUTH_TYPE.MD5:default:i.md5Password=o(n);break;case Me.AUTH_TYPE.AUTOLOGIN:i.Key=n}u(i)},this.addSignalingListener=function(e){r.A.addListener(a,n,e)},this.removeSignalingListener=function(e){return r.A.removeListener(n,e)},this.sendLogoutRequest=function(e){u({CID:e,method:"logoutUser"})},this.getProtocolVersion=function(){return new Promise((t=>{const n=r=>{e.removeMessagesCallback(n,"pong"),t(r.version)};e.addMessagesCallback(n,"pong"),e.sendMessage({method:"ping"})}))},e.addMessagesCallback(i,"loginResponse"),e.addMessagesCallback(c,"logoutResponse"),e.addMessagesCallback(l,"setProps")}c.prototype=Object.create(s.prototype);var l=n(96638);class u extends l.A{constructor(e,t){super(e),d.set(this,t)}get CID(){return h(this).CID}get appId(){return h(this).appId}get autoLoginKey(){return h(this).autoLoginKey}get rights(){return h(this).rights}}let d=new WeakMap;function h(e){let t=d.get(e);if(!t)throw new TypeError("Illegal invocation");return t}var f=n(96303),g=n(29054);var p={name:"trueconf_client",version:5,objectStores:[{name:"connections",keyPath:["host","port"],fields:[{name:"server",notNull:!0,type:"String"},{name:"host",notNull:!0,type:"String"},{name:"port",notNull:!0,type:"int"},{name:"secure",defaultValue:!0,type:"boolean"}]},{name:"servers",keyPath:"name",indexes:["name","version"],fields:[{name:"name",type:"String"},{name:"version",type:"String"}]},{name:"users",keyPath:"id",indexes:["id","server","login","type","authStr"],groups:[["login","server"]],fields:[{name:"id",notNull:!0,type:"String"},{name:"server",notNull:!0,type:"String"},{name:"login",notNull:!0,type:"String"},{name:"displayName",notNull:!0,type:"String"},{name:"type",notNull:!0,type:"int"},{name:"appId",notNull:!0,type:"String"},{name:"autoLoginKey",type:"String"},{name:"temporary",defaultValue:!1,type:"boolean"},{name:"authStr",type:"String"}]},{name:"chatList",autoIncrement:!0,hardReset:3,indexes:["type","temporary","createTime"],fields:[{name:"name",type:"String"},{name:"type",notNull:!0,type:"int"},{name:"temporary",defaultValue:!1,type:"boolean"},{name:"createTime",defaultValue:!1,type:"int"},{name:"disableNotifications",defaultValue:!1,type:"boolean"},{name:"icon",type:"object"},{name:"messageLimit",defaultValue:0,type:"int"},{name:"timeLimit",defaultValue:0,type:"int"},{name:"afterLimit",type:"int"},{name:"historyEnabled",defaultValue:!0,type:"boolean"},{name:"allowInvitation",notNull:!0,type:"int"},{name:"allowAttachments",notNull:!0,type:"int"}]},{name:"chatRoom",keyPath:"roomId",indexes:[{name:"chatId",unique:!0},"type"],fields:[{name:"chatId",notNull:!0,type:"int"},{name:"roomId",type:"object"},{name:"type",notNull:!0,type:"int"},{name:"host",type:"String"}]},{name:"chatParticipants",autoIncrement:!0,indexes:["chatId","participantId","role"],groups:[{indexes:["chatId","participantId"],unique:!0}],fields:[{name:"chatId",notNull:!0,type:"int"},{name:"participantId",notNull:!0,type:"String"},{name:"role",notNull:!0,type:"int"},{name:"invitationTime",notNull:!0,type:"int"},{name:"invitationParticipant",type:"String"}]},{name:"chatMessages",autoIncrement:!0,indexes:["chatId","participantId"],groups:[["chatId","participantId"],["chatId","timestamp"]],orderIndexes:[{type:1,indexId:1,groupPosition:1}],fields:[{name:"chatId",notNull:!0,type:"int"},{name:"participantId",notNull:!0,type:"String"},{name:"timestamp",notNull:!0,type:"int"},{name:"message",notNull:!0,type:"String"},{name:"messageType",notNull:!0,type:"int"}]},{name:"chatAttachments",autoIncrement:!0,indexes:["chatId","messageId","participantId","type","size"],groups:[["chatId","participantId"],["chatId","messageId"],["chatId","type"]],fields:[{name:"chatId",notNull:!0,type:"int"},{name:"messageId",notNull:!0,type:"int"},{name:"participantId",notNull:!0,type:"String"},{name:"name",notNull:!0,type:"String"},{name:"description",type:"String"},{name:"downloadUrl",notNull:!0,type:"String"},{name:"previewUrl",type:"String"},{name:"type",notNull:!0,type:"int"},{name:"mimeType",type:"String"},{name:"size",notNull:!0,type:"int"}]}]};class m{key;constructor(e){this.key=e}static get AUTO_KEY_PATH_PREFIX(){return"auto_gen_key_path"}}class E{constructor(e){let t="string"==typeof(n=e)?{name:n,keyPath:n,unique:!1,multiEntry:!1}:{name:n.name,keyPath:n.keyPath?n.keyPath:n.name,unique:!!n.unique,multiEntry:!!n.multiEntry};var n;T.set(this,t)}get name(){return C(this).name}get keyPath(){return C(this).keyPath}get unique(){return C(this).unique}get multiEntry(){return C(this).multiEntry}static makeGroupIndexName(e){return m.AUTO_KEY_PATH_PREFIX+"_"+e.join("_")}}const T=new WeakMap;function C(e){let t=T.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class S{constructor(e){let t=function(e){return"string"==typeof e?{name:e,notNull:!1,defaultValue:null,type:I.ANY}:{name:e.name,notNull:!!e.notNull,defaultValue:e.hasOwnProperty("defaultValue")?e.defaultValue:null,type:v(e.type)}}(e);A.set(this,t)}get notNull(){return R(this).notNull}get defaultValue(){return R(this).defaultValue}get type(){return R(this).type}get name(){return R(this).name}static get FIELD_TYPE(){return I}}var I;function v(e){if("string"!=typeof e)return I.ANY;switch(e.toLowerCase()){case"int":case"integer":return I.INT;case"string":case"str":case"char":return I.STRING;case"float":case"double":return I.DOUBLE;case"boolean":case"bool":return I.BOOLEAN;case"array":return I.ARRAY;case"object":return I.OBJECT;default:return I.ANY}}!function(e){e[e.ANY=0]="ANY",e[e.BOOLEAN=1]="BOOLEAN",e[e.INT=2]="INT",e[e.DOUBLE=3]="DOUBLE",e[e.FLOAT=4]="FLOAT",e[e.STRING=5]="STRING",e[e.ARRAY=6]="ARRAY",e[e.OBJECT=7]="OBJECT"}(I||(I={}));const A=new WeakMap;function R(e){let t=A.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class L{type;indexId;groupPosition;constructor(e){this.type=e.type,this.indexId=e.indexId,this.groupPosition=e.type}static get TYPE(){return N}}var N;!function(e){e[e.COMMON=0]="COMMON",e[e.GROUP=1]="GROUP"}(N||(N={}));class O{constructor(e){let t=function(e){if(!e.name)throw new TypeError("Required attribute 'name' not found");if(!e.fields||e.fields.length<=0)throw new TypeError("Object store must contain one or more field!");let t={name:e.name,autoIncrement:!!e.autoIncrement,keyPath:e.keyPath?e.keyPath:null,hardReset:!!e.hardReset&&e.hardReset,indexes:[],groupIndexes:[],fields:[],orderIndexes:[]};if(e.indexes)for(let n of e.indexes)t.indexes.push(new E(n));if(e.groups)for(let n of e.groups){let e=y(n);t.groupIndexes.push(new E(e))}if(e.orderIndexes)for(let n of e.orderIndexes)t.orderIndexes.push(new L(n));for(let n of e.fields)t.fields.push(new S(n));return t}(e);P.set(this,t)}get name(){return w(this).name}get autoIncrement(){return w(this).autoIncrement}get keyPath(){return w(this).keyPath}get hardReset(){return w(this).hardReset}get indexes(){return w(this).indexes}get groupIndexes(){return w(this).groupIndexes}get orderIndexes(){return w(this).orderIndexes}get fields(){return w(this).fields}hasIndex(e){for(let t of w(this).indexes)if(t.name===e)return!0;return!1}hasIndexInGroup(e){for(let t of w(this).groupIndexes)if(t.keyPath&&t.keyPath instanceof Array&&-1!==t.keyPath.indexOf(e))return!0;return!1}hasGroupWithKeyPath(e){e:for(let t of w(this).groupIndexes)if(t.keyPath&&t.keyPath instanceof Array){if(t.keyPath.length!==e.length)continue;for(let n=0;n<e.length;n++)if(t.keyPath[n]!==e[n])continue e;return!0}return!1}}function y(e){return e instanceof Array?{name:E.makeGroupIndexName(e),keyPath:e}:{name:E.makeGroupIndexName(e.indexes),keyPath:e.indexes,unique:!!e.unique,multiEntry:!!e.multiEntry}}const P=new WeakMap;function w(e){let t=P.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class b{constructor(e){let t=function(e){if(!e.hasOwnProperty("name"))throw new TypeError("Required attribute 'name' not found");if(!e.hasOwnProperty("version"))throw new TypeError("Required attribute 'version' not found");if(!e.objectStores||0===e.objectStores.length)throw new TypeError("Invalid 'objectStores' attribute!");let t={version:Number(e.version),name:e.name,objectStoreNames:[],objectStores:{}};for(let n of e.objectStores){let e=new O(n);t.objectStores[e.name]=e,t.objectStoreNames.push(e.name)}return t}(e);_.set(this,t)}get name(){return k(this).name}get version(){return k(this).version}get objectStores(){return k(this).objectStores}get objectStoreNames(){return k(this).objectStoreNames}get numObjectStores(){return k(this).objectStoreNames.length}objectStore(e){let t=k(this).objectStores;return t.hasOwnProperty(e)?t[e]:null}}const _=new WeakMap;function k(e){let t=_.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class D{searchValue;type;fieldComparatorList=[];constructor(e,t){this.searchValue=e,this.type=t||M.EQUAL}addFieldComparator(e){this.fieldComparatorList.push(e)}addFieldComparatorList(e){for(let t of e)this.fieldComparatorList.push(t)}removeFieldComparator(e){let t;if(-1===(t=this.fieldComparatorList.indexOf(e)))return!1;this.fieldComparatorList.splice(t,1)}getFieldComparators(){return[...this.fieldComparatorList]}get hasFieldComparator(){return this.fieldComparatorList.length>0}static get TYPE(){return M}static get DIRECTION(){return U}}var M,U;!function(e){e[e.EQUAL=0]="EQUAL",e[e.ONLY=1]="ONLY",e[e.BOUND=2]="BOUND",e[e.UPPER_BOUND=3]="UPPER_BOUND"}(M||(M={})),function(e){e.NEXT="next",e.PREV="prev"}(U||(U={}));class x extends D{query;direction;constructor(e,t,n="next",r=!0){super(e,t),this.query=function(e,t,n){switch(t){case D.TYPE.ONLY:return function(e,t){return IDBKeyRange.only(F(e,t))}(e,n);case D.TYPE.BOUND:return function(e,t){if(!(e instanceof Array)||2!==e.length)throw"Invalid search value!";let n=F(e[0],t),r=F(e[1],t);return IDBKeyRange.bound(n,r,!!e[2],!!e[3])}(e,n);case D.TYPE.UPPER_BOUND:return function(e,t){return e instanceof Array?IDBKeyRange.upperBound(F(e[0],t),!!e[1]):IDBKeyRange.upperBound(e)}(e,n);default:return function(e,t){return F(e,t)}(e,n)}}(e,this.type,r),this.direction=n,Object.freeze(this)}getQuery(){return this.query}getDirection(){return this.direction}}function F(e,t){return e instanceof Array&&!t?JSON.stringify(e):e}class B{constructor(e,t,n){const r={db:e,schema:t,dbInfo:n};Q.set(this,r)}getSchema(){return X(this).schema}readList(e,t){let n=X(this);return function(e,t,n,r){return new Promise(((i,s)=>{let a=new Map;W(e,t,((e,t)=>void 0===e||void 0===t?(i(a),!1):!!a.set(e,t)),s,n,r)}))}(X(this).db,n.schema.name,t,e)}readValues(e,t){let n=X(this);return function(e,t,n,r){return new Promise(((i,s)=>{let a=[];W(e,t,((e,t)=>void 0===e||void 0===t?(i(a),!1):!!a.push(t)),s,n,r)}))}(X(this).db,n.schema.name,t,e)}readValue(e,t){let n=X(this);return V(X(this).db,n.schema.name,t,e).then((e=>e?e[1]:null))}readFields(e,t,n){let r=X(this);return function(e,t,n,r,i){return new Promise(((s,a)=>{let o=[];W(e,t,((e,t)=>void 0===e||void 0===t?(s(o),!1):(t.hasOwnProperty(n)&&o.push(t[n]),!0)),a,r,i)}))}(X(this).db,r.schema.name,e,n,t)}readField(e,t,n){let r=X(this);return V(X(this).db,r.schema.name,n,t).then((t=>{if(!t)return null;let n=t[1];return n.hasOwnProperty(e)?n[e]:null}))}readSeq(e,t,n,r){let i=X(this);W(i.db,i.schema.name,e,t,r,n)}readEntry(e,t){let n=X(this);return V(X(this).db,n.schema.name,t,e)}count(e,t){let n=X(this);return function(e,t,n,r){return new Promise(((i,s)=>{let a=e.transaction(t,"readonly");a.onerror=s,a.onabort=s;let o=a.objectStore(t),c=r?r.getQuery():void 0;(n?o.index(J(n)).count(c):o.count(c)).onsuccess=e=>i(e.target.result)}))}(X(this).db,n.schema.name,t,e)}put(e,t){let n=X(this);return H(n.db,n.dbInfo,n.schema,e,t)}putList(e,t){let n=X(this);return j(n.db,n.dbInfo,n.schema,e,t)}add(e,t){let n=X(this);return H(n.db,n.dbInfo,n.schema,e,t,!1)}addList(e,t){let n=X(this);return j(n.db,n.dbInfo,n.schema,e,t,!1)}deleteData(e,t){let n=X(this);return function(e,t,n,r){return new Promise(((i,s)=>{let a=!1,o=e.transaction(t,"readwrite");o.oncomplete=()=>i(!0),o.onerror=o.onabort=e=>{a||s(e),a=!0};let c=o.objectStore(t),l=r?r instanceof x?r.getQuery():r:void 0;(n?c.index(J(n)).openCursor(l):c.openCursor(l)).onsuccess=function(e){let t=e.target.result;if(t){let e=t.delete();e.onsuccess=()=>t.continue(),e.onerror=()=>o.abort()}}}))}(n.db,n.schema.name,t,e)}}function V(e,t,n,r){return new Promise(((i,s)=>W(e,t,((e,t)=>(i(void 0===e||void 0===t?null:[e,t]),!1)),s,n,r)))}function W(e,t,n,r,i,s){if(s&&s instanceof Array)return function(e,t,n,r,i,s){let a=new Set,o=e.transaction(t,"readonly");o.onerror=r,o.onabort=r;let c=o.objectStore(t);function l(e,t){if(e){if(a.has(e))return!0;a.add(e)}return n(e,t)}for(let e of i)Y(c,l,s,e)}(e,t,n,r,s,i);let a=e.transaction(t,"readonly");a.onerror=r,a.onabort=r,Y(a.objectStore(t),n,i,s)}function Y(e,t,n,r){let i,s,a=null;r&&(i=r.getQuery(),s=r.getDirection(),a=r.hasFieldComparator?r.getFieldComparators():null),(n?e.index(J(n)).openCursor(i,s):e.openCursor(i,s)).onsuccess=function(e){let n=e.target.result;if(n){if(a&&!function(e,t){for(let n of e)if(n.test(t))return!0;return!1}(a,n.value))return void n.continue();t(n.primaryKey,n.value)&&n.continue()}else t()}}function j(e,t,n,r,i,s=!0){let a=[],o=[];!function(e,t,n,r,i,s){if(!(e instanceof Array))return!1;if(i&&e.length!==i.length)return!1;for(let a=0;a<e.length;a++){let o={};G(e[a],o,n,r)&&(t.push(o),i&&s&&s.push(i[a]))}}(r,a,n,t,i,o);let c=new Map;return 0===a.length?Promise.resolve(c):new Promise((t=>{let r=e.transaction(n.name,"readwrite");r.oncomplete=r.onerror=r.onabort=()=>t(c);let l=r.objectStore(n.name);for(let e=0;e<a.length;e++){let t,n=a[e];if(i&&o[e]){let n=o[e];t=n instanceof x?n.getQuery():n}q(n,l,t,s).onsuccess=e=>c.set(e.target.result,n)}}))}function H(e,t,n,r,i,s=!0){let a={};return G(r,a,n,t)?new Promise(((t,r)=>{let o,c=!1,l=e.transaction(n.name,"readwrite");l.oncomplete=()=>t(o),l.onerror=l.onabort=e=>{c||r(e),c=!0};let u=l.objectStore(n.name),d=i?i instanceof x?i.getQuery():i:void 0;q(a,u,d,s).onsuccess=e=>o=e.target.result})):Promise.reject(!1)}function q(e,t,n,r=!0){return n?r?t.put(e,n):t.add(e,n):r?t.put(e):t.add(e)}function G(e,t,n,r){if(null==e||!(e instanceof Object))return!1;for(let r of n.fields){let n=r.name,i=e[r.name];if(void 0===i)if(null!==r.defaultValue)i=r.defaultValue;else{if(null!==r.defaultValue||r.notNull)return!1;i=null}else if(null===i){if(r.notNull){if(null===r.defaultValue)return!1;i=r.defaultValue}}else if(i=z(r,i),null===i)return!1;t[n]=i}if(r.useArrayKeyPaths||!(n.keyPath instanceof Array)&&0===n.groupIndexes.length)return!0;if(n.keyPath instanceof Array&&K(t,n.keyPath),n.groupIndexes.length>0)for(let e of n.groupIndexes)e.keyPath instanceof Array&&K(t,e.keyPath);return!0}function K(e,t){let n=m.AUTO_KEY_PATH_PREFIX+"_"+t.join("_"),r=[];for(let n of t)r.push(e.hasOwnProperty(n)?e[n]:null);e[n]=JSON.stringify(r)}function z(e,t){switch(e.type){case S.FIELD_TYPE.BOOLEAN:return!!t;case S.FIELD_TYPE.INT:case S.FIELD_TYPE.DOUBLE:case S.FIELD_TYPE.FLOAT:return"number"==typeof t||t instanceof Number?t:null;case S.FIELD_TYPE.STRING:return"string"==typeof t||t instanceof String?t:null;case S.FIELD_TYPE.ARRAY:return t instanceof Array?t:null;case S.FIELD_TYPE.OBJECT:return t instanceof Object?t:null;default:return t}}function J(e){return e instanceof Array?m.AUTO_KEY_PATH_PREFIX+"_"+e.join("_"):e}const Q=new WeakMap;function X(e){let t=Q.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class ${constructor(e,t,n){const r={db:e,dbInfo:t,schema:n,objectStores:{}};Z.set(this,r)}getObjectStore(e){let t=ee(this);if(!t.objectStores.hasOwnProperty(e)){let n=t.schema.objectStore(e);if(!n)throw"ObjectStore not found!";t.objectStores[e]=new B(t.db,n,t.dbInfo)}return t.objectStores[e]}searchQuery(e,t,n){return new x(e,t,n,ee(this).dbInfo.useArrayKeyPaths)}searchQueryList(e,t,n){let r=[];for(let i of e)r.push(new x(i,t,n,ee(this).dbInfo.useArrayKeyPaths));return r}close(){return ee(this).db.close(),Promise.resolve(!0)}}const Z=new WeakMap;function ee(e){let t=Z.get(e);if(!t)throw new TypeError("Illegal invocation");return t}class te extends m{keyPath;constructor(e,t=!0){super(e),this.keyPath=function(e,t){!e&&t instanceof Array&&(t=m.AUTO_KEY_PATH_PREFIX+"_"+t.join("_"));return t}(t,e)}getKeyPath(){return this.keyPath}static isArrayKeyPathSupported(){try{return IDBKeyRange.only(["one","two"]),!0}catch(e){return!1}}}const ne="IDBDatabaseServiceInformation";class re{constructor(){}hasDiskQuota(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate().then((e=>void 0!==e.quota&&e.quota>5242881)):Promise.resolve(!0)}canOpenDB(e){return new Promise((t=>{let n=!1,r=!1;function i(e,r){if(!n){if(r)try{r.close()}catch(e){}n=!0,t(e)}}try{let t=window.indexedDB.open(e);t.onblocked=()=>i(!1),t.onsuccess=e=>i(!0,e.target.result),t.onerror=()=>{r||i(!1)},t.onupgradeneeded=e=>{let t=e.target.transaction;r=!0,t.abort(),t.onabort=()=>i(!0,t.db)}}catch(e){i(!1)}}))}isDBExists(e){return new Promise((t=>{let n=!1,r=!1;function i(e,r){if(!n){if(r)try{r.close()}catch(e){}n=!0,t(e)}}let s=window.indexedDB.open(e);s.onblocked=()=>i(!0),s.onsuccess=e=>i(!0,e.target.result),s.onerror=()=>{r||i(!1)},s.onupgradeneeded=e=>{let t=e.target.transaction;r=!0,t.abort(),t.onabort=()=>i(0!==e.oldVersion,t.db)}}))}openDB(e){return new Promise(((t,n)=>{let r=window.indexedDB.open(e.name,e.version),i=!1,s=!1;r.onerror=e=>n(e),r.onblocked=e=>{s=!0,n(e)},r.onsuccess=n=>{if(i)return;let r=n.target.result;le(r.transaction(ne,"readonly")).then((n=>t(new $(r,n,e))))},r.onupgradeneeded=n=>{if(s)return;i=!0;let r,a=n.target,o=a.result,c=a.transaction;r=0===n.oldVersion?function(e,t){return new Promise(((n,r)=>{let i=ue();e.addEventListener("complete",(()=>n(i))),e.addEventListener("abort",r),e.addEventListener("error",r),se(e.db,i);for(let n in t.objectStores)t.objectStores.hasOwnProperty(n)&&ie(e.db,t.objectStores[n],i)}))}(c,e):function(e,t,n,r){return new Promise(((r,i)=>{let s=de(e.db.objectStoreNames);(function(e,t){if(t)return le(e);{let t=ue();return se(e.db,t),Promise.resolve(t)}})(e,s.has(ne)).then((a=>{e.addEventListener("complete",(()=>r(a))),e.addEventListener("abort",i),e.addEventListener("error",i),a.useArrayKeyPaths!==te.isArrayKeyPathSupported()&&console.warn("\r\nNEED SWITCH KEY PATH'S TO ARRAY MODE!!!\r\n\r\n");for(let r in t.objectStores){if(!t.objectStores.hasOwnProperty(r))continue;let i=t.objectStores[r];s.has(r)?!1!==i.hardReset&&(!0===i.hardReset||i.hardReset<=n)?(e.db.deleteObjectStore(r),ie(e.db,i,a)):oe(e,i,a):ie(e.db,i,a)}for(let n of s)n!==ne&&(t.objectStores.hasOwnProperty(n)||e.db.deleteObjectStore(n))}))}))}(c,e,n.oldVersion,n.newVersion&&n.newVersion),r.then((n=>t(new $(o,n,e))))}}))}deleteDB(e){return new Promise(((t,n)=>{let r=window.indexedDB.deleteDatabase(e);r.onerror=n,r.onblocked=n,r.onsuccess=()=>t(!0)}))}closeDB(e){return e.close()}}function ie(e,t,n){let r=t.keyPath?new te(t.keyPath,n.useArrayKeyPaths).getKeyPath():t.keyPath,i=e.createObjectStore(t.name,{keyPath:r||void 0,autoIncrement:t.autoIncrement});t.indexes&&ae(i,t.indexes,n),t.groupIndexes&&ae(i,t.groupIndexes,n)}function se(e,t){let n=e.createObjectStore(ne,{autoIncrement:!0,keyPath:"propertyName"});n.createIndex("propertyName","propertyName",{unique:!0}),n.createIndex("propertyValue","propertyValue");for(let e in t)t.hasOwnProperty(e)&&n.put({propertyName:e,propertyValue:t[e]})}function ae(e,t,n){for(let r of t)ce(e,r,n)}function oe(e,t,n){let r=new Set,i=e.objectStore(t.name),s=de(i.indexNames);function a(e){if(e)for(let t of e)s.has(t.name)||ce(i,t,n),r.add(t.name)}a(t.indexes),a(t.groupIndexes);for(let e of s)r.has(e)||i.deleteIndex(e)}function ce(e,t,n){let r=new te(t.keyPath,n.useArrayKeyPaths).getKeyPath();e.createIndex(t.name,r,{multiEntry:t.multiEntry,unique:t.unique})}function le(e){return new Promise(((t,n)=>{let r=ue(),i=e.objectStore(ne).openCursor();i.onerror=n,i.onsuccess=function(e){let n=e.target.result;if(n){let e=n.value;r[e.propertyName]=e.propertyValue,n.continue()}else t(r)}}))}function ue(){return{useArrayKeyPaths:te.isArrayKeyPathSupported()}}function de(e){let t=new Set;for(let n=0;n<e.length;n++){let r=e.item(n);null!==r&&t.add(r)}return t}class he{errorCode;originalError;constructor(e,t){this.errorCode=e,this.originalError=t}}const fe={};class ge{constructor(){throw new TypeError("Cannot construct instances directly")}static async openStorage(e,t=me.INDEXED_DB){if(!(e instanceof b))throw"Invalid Schema!";let n=pe(t);return n.databaseList.hasOwnProperty(e.name)?Promise.resolve(n.databaseList[e.name]):(await n.factory.hasDiskQuota().then((e=>{if(!e)throw new he(Ee.DISK_QUOTA,null)})),await n.factory.canOpenDB(e.name).then((e=>{if(!e)throw new he(Ee.STORAGE_OPEN,null)})),n.factory.openDB(e).then((t=>(n.databaseList[e.name]=t,t))).catch((e=>{throw new he(Ee.UNKNOWN,e)})))}static deleteStorage(e,t=me.INDEXED_DB){return pe(t).factory.deleteDB(e)}static get STORAGE_TYPE(){return me}static get STORAGE_ERROR(){return Ee}}function pe(e){return fe.hasOwnProperty(e)||(fe[e]=function(e){let t=new re;return{factory:t,databaseList:{}}}()),fe[e]}var me,Ee;let Te,Ce;!function(e){e[e.INDEXED_DB=1]="INDEXED_DB"}(me||(me={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.DISK_QUOTA=1]="DISK_QUOTA",e[e.STORAGE_OPEN=2]="STORAGE_OPEN"}(Ee||(Ee={}));class Se{constructor(e){if(Ce)return Ce;Ce=this,Te={db:e}}static getInstance(){if(Ce)return Promise.resolve(Ce);let e=new b(p);return ge.openStorage(e).then((e=>function(e){return e.getObjectStore("users").deleteData(e.searchQuery(l.A.TYPE.GUEST),"type")}(e).then((()=>e)))).then((e=>new Se(e)))}updateClient(e,t){return this.updateServer(e).then((()=>this.updateUser(t))).then((()=>({chatStorage:{updateChat:()=>Promise.resolve(Date.now())}})))}deleteUser(e){let t=ve(this);return t.getObjectStore("users").deleteData(t.searchQuery(e))}getUsersWithAutoLoginKey(e){return this.findServerByConnection(e).then((e=>e?this.getUsersList(e.name).then((e=>{let t=[];for(let n of e)n.autoLoginKey&&t.push(n);return t.length>0?t:null})):null))}findServerByConnection(e){let t=ve(this),n=t.searchQuery([e.host,e.port]);return t.getObjectStore("connections").readValue(n).then((e=>e?t.getObjectStore("servers").readValue(t.searchQuery(e.server)):null))}findUserByLogin(e,t){return this.findServerByConnection(e).then((e=>{if(!e)return null;let n=ve(this),r=n.getObjectStore("users"),i=n.searchQuery([t,e.name]);return r.readValue(i,["login","server"])}))}getUsersList(e){let t=ve(this);return t.getObjectStore("users").readValues(t.searchQuery(e,D.TYPE.ONLY),"server")}clearAutoLoginKey(e){let t=ve(this),n=t.searchQuery(e),r=t.getObjectStore("users");return r.readValue(n).then((e=>!!e&&(e.autoLoginKey=null,r.put(e).then((()=>!0)))))}updateUser(e){return ve(this).getObjectStore("users").put(e)}updateConnection(e,t){return ve(this).getObjectStore("connections").put(Ie(e,t))}updateConnections(e,t){let n=[];for(let r of t)n.push(Ie(e,r));return ve(this).getObjectStore("connections").putList(n)}updateServer(e){let t={name:e.serverName,version:"0"};return ve(this).getObjectStore("servers").put(t).then((t=>this.updateConnections(t,e.connections))).then((()=>e))}}function Ie(e,t){return{host:t.host,port:t.port,secure:!!t.secure,server:e}}function ve(e){return Te.db}var Ae=n(26876),Re=n(27062);class Le{serverName;connections;constructor(e){this.serverName=e,this.connections=new Set,Object.freeze(this)}}var Ne=n(150),Oe=n(63119);let ye;const Pe={},we={close:function(e){(function(e){if(!Pe.hasOwnProperty(e.type)||!Pe[e.type][e.connectionId])return;delete Pe[e.type][e.connectionId]})(e.protocol),be.fireEvent("close",{protocol:e.protocol})},error:function(e){be.fireEvent("error",{protocol:e.protocol,errorCode:e.errorCode})},message:function(e){be.fireEvent("message",{protocol:e.protocol,message:e.message})}},be={};class _e extends Oe.A{constructor(){if(ye)return ye;super(be),ye=this}static getInstance(){return ye}connect(e,t,n=g.A.PROTOCOL_TYPE.WEB_SOCKET){let r,s=function(e,t,n){let r=function(e,t,n){return i.A.makeConnectionId(e,t)}(e,t);if(Pe.hasOwnProperty(n)&&Pe[n].hasOwnProperty(r))return Pe[n][r];return null}(e,t,n);return s?s.readyState!==g.A.READY_STATE.OPEN?Promise.reject("Connection is an invalid state!"):Promise.resolve(s):(r=i.A.connect(e,t,we),r.then((e=>(function(e){Pe.hasOwnProperty(e.type)||(Pe[e.type]={});Pe[e.type][e.connectionId]=e}(e),e))))}}new _e;class ke{static get RIGHTS(){return De}rightsValue;constructor(e){this.rightsValue=e}get canStartMultipointConference(){return!!(this.rightsValue&De.MULTI)}get needPasswordForMultipointConference(){return!!(this.rightsValue&De.PASSWORD_MULTI)}get canCreateMultipointConference(){return!!(this.rightsValue&De.CREATE_MULTI)}get canSearchUsers(){return!!(this.rightsValue&De.SEARCH_EXISTS)}get canEditAddressBook(){return!!(this.rightsValue&De.EDIT_AB)}get canUseFileTransfer(){return!!(this.rightsValue&De.FILE_TRANSFER)}get canUseWhiteBoard(){return!!(this.rightsValue&De.WHITEBOARD)}get canUseSlideshow(){return!!(this.rightsValue&De.SLIDESHOW)}get canRenameUsersInAddressBook(){return!!(this.rightsValue&De.UPDATE_AB)}get canStartConference(){return!!(this.rightsValue&De.CALL)}get canStoreCallHistory(){return!!(this.rightsValue&De.APP_CALL_LOG)}get canUseDesktopSharing(){return!!(this.rightsValue&De.DESKTOP_SHARING)}get canRecordConference(){return!!(this.rightsValue&De.RECORDING)}get canEditAddressBookGroups(){return!!(this.rightsValue&De.EDIT_GROUP)}get canSendHDVideo(){return!!(this.rightsValue&De.HD_VIDEO)}get canChangePassword(){return!!(this.rightsValue&De.CHANGE_PASSWORD)}get canCallToPhone(){return!!(this.rightsValue&De.DIALER)}get canEditPhoneInAddressBook(){return!!(this.rightsValue&De.EDIT_DIAL)}get canUseChat(){return!!(this.rightsValue&De.CHAT)}}const De={APP_MASK:15,APP_COMMUNICATOR:1,APP_ADVISOR:2,NONE:0,LOGIN:16,MULTI:32,PASSWORD_MULTI:64,CREATE_MULTI:128,SEARCH_EXISTS:256,EDIT_AB:512,BROADCAST:1024,FILE_TRANSFER:2048,WHITEBOARD:4096,SLIDESHOW:8192,UPDATE_AB:16384,CALL:32768,APP_CALL_LOG:65536,DESKTOP_SHARING:131072,RECORDING:262144,EDIT_GROUP:524288,HD_VIDEO:1048576,CHANGE_PASSWORD:2097152,DIALER:4194304,EDIT_DIAL:8388608,CHAT:16777216,MOBILE_PRO__ACCOUNT:268435456,PRO_ACCOUNT:536870912};function Me(e={storageEnabled:!0}){if(Me.prototype.instance)return Me.prototype.instance;const t=this;let n=[],i=new Map,s=new Map,d=new Map,h=new Map;const p={};function m(e){(function(e,i){let s=_e.getInstance();return s.addEventListener("close",A),s.connect(e,i).then((e=>(r.A.runListeners(t,n,"onConnectionEstablished",i),e))).catch((e=>(r.A.runListeners(t,n,"onConnectionFailed",i,e),Promise.reject(e))))})(e.connection,e.login).then((t=>{i.set(t,e);let n=function(e){let t=new c(e),n=new a;return n.onLoginSuccess=T,n.onLoginFail=S,n.onLogoutSuccess=I,n.onAppProperties=v,t.addSignalingListener(n),t}(t);n.getProtocolVersion().then((r=>{e.protocolVersion=r,s.set(t,n),n.sendLoginRequest(e.appId,e.authStr,e.password,e.authType)}))}))}function E(e,t){if(e.clientState!==Ae.A.CLIENT_STATE.LOGGED)return;let n=h.get(e);if(!n)return;let r=n.getSignalingProtocol();if(!r)return;e.conferenceManager.hangUpAll();let i=s.get(r);n.setClientState(t?Ae.A.CLIENT_STATE.WAIT_DISCONNECT:Ae.A.CLIENT_STATE.WAIT_LOGOUT),i.sendLogoutRequest(e.getUser().CID)}function T(t,n,r,s,a){const o=this;let c=i.get(o.signalingProtocol);if(!c)return;let d=new Ne.A,h=d.getUserObject(r,s),f={id:r,authStr:c.authStr,login:h.login,server:h.serverName,displayName:s,type:h.type,appId:c.appId,autoLoginKey:n,temporary:h.type===l.A.TYPE.GUEST},g=new Le(h.serverName);g.connections.add(o.signalingProtocol.connection);let p=new u(h,{CID:t,autoLoginKey:n,appId:c.appId,rights:new ke(a)});e.storageEnabled?y().then((e=>e.getUsersList(h.serverName).then((t=>{let n=[];for(let r of t)n.push(e.deleteUser(r.id));return Promise.all(n).then((()=>e))})))).then((e=>e.updateClient(g,f))).then((e=>{C(o,d,p,e,c.protocolVersion)})).catch((e=>{console.error("IDB error : ",e),N(c.login,e instanceof he?P(e):Me.LOGIN_STATE.UNKNOWN_ERROR),o.sendLogoutRequest(t)})):C(o,d,p,null,c.protocolVersion)}function C(e,i,s,a,o){const c={};let l=new Ae.A(e.signalingProtocol,i,s,a,c,o,p);d.set(e.signalingProtocol,l),h.set(l,c),r.A.runListeners(t,n,"onLoginSuccess",l)}function S(t){if(!i.has(this.signalingProtocol))return;let n=i.get(this.signalingProtocol);t===Me.LOGIN_STATE.SILENT_REJECT_LOGIN&&e.storageEnabled&&y().then((e=>e.clearAutoLoginKey(n.trueconfId))),N(n.login,t),R(this.signalingProtocol)}function I(i){let s=d.get(this.signalingProtocol);if(s){let a=s.getUser();s.clientState===Ae.A.CLIENT_STATE.WAIT_LOGOUT&&a.getType()===l.A.TYPE.USER&&e.storageEnabled&&y().then((e=>e.clearAutoLoginKey(a.getTrueconfId()))),r.A.runListeners(t,n,"onLogout",a.getId(),i);let o=h.get(s);o&&o.setClientState(Ae.A.CLIENT_STATE.LOGOFF)}R(this.signalingProtocol)}function v(e){p.turnHost=e["TURN Host"],p.turnUser=e["TURN Username"],p.turnPassword=e["TURN Password"]}function A(e){let a=!0,o=d.get(e.protocol);if(o){o.clientState!==Ae.A.CLIENT_STATE.LOGGED&&o.clientState!==Ae.A.CLIENT_STATE.WAIT_LOGIN||(a=!1);let e=h.get(o);e&&e.setClientState(Ae.A.CLIENT_STATE.DISCONNECTED)}r.A.runListeners(t,n,"onConnectionClosed",e.protocol.userId,a),function(e){let t=d.get(e);if(t){d.delete(e);let n=h.get(t);n&&(n.getUsersList().clearAll(),h.delete(t))}i.delete(e),s.delete(e)}(e.protocol)}function R(e){e.readyState!==g.A.READY_STATE.CONNECTING&&e.readyState!==g.A.READY_STATE.OPEN||e.close()}function L(){return o(navigator.userAgent+Date.now()+Math.random()).toUpperCase()}function N(e,i){r.A.runListeners(t,n,"onLoginFail",e,i)}function O(e){return null===e?Re.A.createFromCurrentContext():function(e){let t=Re.A.createFromCurrentContext();return e.host&&(t.host=e.host),!0!==e.secure&&!1!==e.secure||(t.secure=e.secure),parseInt(e.port)&&(t.port=e.port),e.path&&(t.path=e.path),t}(e)}function y(){return Se.getInstance()}function P(e){switch(e.errorCode){case ge.STORAGE_ERROR.DISK_QUOTA:return Me.LOGIN_STATE.CLIENT_STORAGE_QUOTA_EXCEED;case ge.STORAGE_ERROR.STORAGE_OPEN:return Me.LOGIN_STATE.CLIENT_STORAGE_OPEN_ERROR;default:return Me.LOGIN_STATE.CLIENT_STORAGE}}function w(){for(let e of d)e[1].disconnect()}this.checkConnection=function(e){return g.A.connect(e,null).then((e=>e.close()))},this.canAutoLogin=function(t,n){return t=O(t),e.storageEnabled?y().then((e=>e.getUsersWithAutoLoginKey(t))).then((e=>{if(null===e)return!1;if(void 0===n)return!0;for(let t of e)if(t.id===n)return!0;return!1})).catch((e=>!1)):Promise.resolve(!1)},this.autoLogin=function(t,n){t=O(t),e.storageEnabled?y().then((e=>e.getUsersWithAutoLoginKey(t))).then((e=>{if(!e)return N(null,Me.LOGIN_STATE.NO_USER_LOGGEDIN);let r=void 0===n?e[0]:null;if(null===r)for(let t of e)if(t.id===n){r=t;break}if(null===r)return N(null,Me.LOGIN_STATE.NO_USER_LOGGEDIN);let i={};i.appId=r.appId,i.login=r.login,i.authStr=r.authStr,i.password=r.autoLoginKey,i.connection=t,i.authType=Me.AUTH_TYPE.AUTOLOGIN,i.trueconfId=r.id,m(i)})).catch((e=>{N(null,Me.LOGIN_STATE.CLIENT_STORAGE),console.error(e)})):N(null,Me.LOGIN_STATE.CLIENT_STORAGE)},this.login=async function(t,n,r=null,i=Me.AUTH_TYPE.RAW,s){r=O(r);let a=function(e,t){if("string"!=typeof e||0===e.length)return Me.LOGIN_STATE.INVALID_LOGIN;if("string"!=typeof t||0===t.length)return Me.LOGIN_STATE.INVALID_PASSWORD;return 0}(t,n);if(0!==a)return N(t,a);let o={};o.login=t,o.authStr=t,o.password=n,o.connection=r,o.authType=i;try{s||(s=await function(t,n){let r=localStorage.getItem("tce:endpointId");if(null!==r)return r;if(!e.storageEnabled)return Promise.resolve(L());return y().then((e=>e.findUserByLogin(t,n))).then((e=>e?e.appId:L()))}(r,t)),o.appId=s,m(o)}catch(e){N(t,e instanceof he?P(e):Me.LOGIN_STATE.UNKNOWN_ERROR),console.error(e)}},this.logout=function(e){E(e)},this.disconnect=function(e){E(e,!0)},this.addClientListener=function(e){return r.A.addListener(f.A,n,e)},this.removeClientListener=function(e){return r.A.removeListener(n,e)},this.getClientListeners=function(){return n},Object.defineProperty(Me.prototype,"instance",{value:this}),window.addEventListener("unload",w)}Object.freeze(De),Me.getInstance=function(){return new Me},Me.LOGIN_STATE={UNKNOWN_ERROR:-1,USER_LOGGEDIN_OK:0,USER_ALREADY_LOGGEDIN:1,NO_USER_LOGGEDIN:2,ACCESS_DENIED:3,SILENT_REJECT_LOGIN:4,LICENSE_USER_LIMIT:5,USER_DISABLED:6,RETRY_LOGIN:7,INVALID_CLIENT_TYPE:8,RESERVED:1e3,INVALID_LOGIN:1001,INVALID_PASSWORD:1002,CLIENT_STORAGE:2e3,CLIENT_STORAGE_QUOTA_EXCEED:2001,CLIENT_STORAGE_OPEN_ERROR:2002,SIGNALING_PROTOCOL_ERROR:3e3},Me.LOGOUT_CAUSE={USER_LOGGEDOUT_BY_REQUEST:0,USER_LOGGEDIN:1},Me.AUTH_TYPE={TOKEN:1,RAW:2,MD5:3,AUTOLOGIN:4}},96303:function(e,t,n){function r(){this.onConnectionEstablished=function(e){},this.onConnectionFailed=function(e,t){},this.onConnectionClosed=function(e,t){},this.onLoginSuccess=function(e){},this.alreadyLoggedIn=function(e){},this.onLoginFail=function(e,t){},this.onLogout=function(e){}}n.d(t,{A:function(){return r}})}}]);